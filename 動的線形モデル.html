<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 動的線形モデル | 金融時系列解析</title>
  <meta name="description" content="12 動的線形モデル | 金融時系列解析" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="12 動的線形モデル | 金融時系列解析" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 動的線形モデル | 金融時系列解析" />
  
  
  

<meta name="author" content="林 高樹" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="多変量ボラティリティモデル.html"/>
<link rel="next" href="高頻度データ分析.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> はじめに</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#時系列モデリング"><i class="fa fa-check"></i><b>1.1</b> 時系列モデリング</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#金融時系列データの特徴"><i class="fa fa-check"></i><b>1.2</b> 金融時系列データの特徴</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#金融時系列データの特徴-みずほ-8411-株価データの例"><i class="fa fa-check"></i>金融時系列データの特徴: みずほ (8411) 株価データの例</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#シミュレーションによるサンプルパス生成"><i class="fa fa-check"></i><b>1.3</b> シミュレーションによるサンプルパス生成</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#rにおける時系列オブジェクトクラスおよび関数の例"><i class="fa fa-check"></i><b>1.4</b> Rにおける時系列オブジェクト・クラスおよび関数の例</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#日付時間データに対するクラス"><i class="fa fa-check"></i><b>1.4.1</b> 日付・時間データに対するクラス</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#時系列データに対するクラス1-tsクラス"><i class="fa fa-check"></i><b>1.4.2</b> 時系列データに対するクラス(1): tsクラス</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#時系列データに対するクラス2-zooクラスとxtsクラス"><i class="fa fa-check"></i><b>1.4.3</b> 時系列データに対するクラス(2): zooクラスとxtsクラス</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#時系列データの分解"><i class="fa fa-check"></i><b>1.5</b> 時系列データの分解</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#トレンド抽出-平滑化-smoothing"><i class="fa fa-check"></i><b>1.5.1</b> トレンド抽出, 平滑化 (smoothing)</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#分解モデル"><i class="fa fa-check"></i><b>1.5.2</b> 分解モデル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html"><i class="fa fa-check"></i><b>2</b> 定常性と自己相関関数</a>
<ul>
<li class="chapter" data-level="2.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#確率過程の2次特性-平均関数と自己共分散関数"><i class="fa fa-check"></i><b>2.1</b> 確率過程の2次特性: 平均関数と自己共分散関数</a></li>
<li class="chapter" data-level="2.2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#定常性-stationarity"><i class="fa fa-check"></i><b>2.2</b> 定常性 (stationarity)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#強定常性"><i class="fa fa-check"></i><b>2.2.1</b> 強定常性</a></li>
<li class="chapter" data-level="2.2.2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#弱定常性"><i class="fa fa-check"></i><b>2.2.2</b> 弱定常性</a></li>
<li class="chapter" data-level="2.2.3" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#ホワイトノイズ"><i class="fa fa-check"></i><b>2.2.3</b> ホワイトノイズ</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#標本平均と標本自己共分散関数"><i class="fa fa-check"></i><b>2.3</b> 標本平均と標本自己共分散関数</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#アンサンブル平均-vs-標本平均"><i class="fa fa-check"></i><b>2.3.1</b> アンサンブル平均 vs 標本平均</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#r操作-標本acf"><i class="fa fa-check"></i><b>2.4</b> R操作: 標本ACF</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#白色ノイズ"><i class="fa fa-check"></i><b>2.4.1</b> 白色ノイズ</a></li>
<li class="chapter" data-level="2.4.2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#ランダムウォーク"><i class="fa fa-check"></i><b>2.4.2</b> ランダムウォーク</a></li>
<li class="chapter" data-level="2.4.3" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#非定常成分を含む時系列"><i class="fa fa-check"></i><b>2.4.3</b> 非定常成分を含む時系列</a></li>
<li class="chapter" data-level="2.4.4" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#線形定常時系列モデル"><i class="fa fa-check"></i><b>2.4.4</b> 線形・定常時系列モデル</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#母acf-vs-標本acf"><i class="fa fa-check"></i><b>2.5</b> 母ACF vs 標本ACF</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="armapqモデル.html"><a href="armapqモデル.html"><i class="fa fa-check"></i><b>3</b> ARMA<span class="math inline">\((p,q)\)</span>モデル</a>
<ul>
<li class="chapter" data-level="3.1" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルとは"><i class="fa fa-check"></i><b>3.1</b> ARMA<span class="math inline">\((p,q)\)</span>モデルとは</a>
<ul>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#因果性と反転可能性"><i class="fa fa-check"></i>因果性と反転可能性</a></li>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの意義"><i class="fa fa-check"></i>ARMA<span class="math inline">\((p,q)\)</span>モデルの意義</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルによる予測"><i class="fa fa-check"></i><b>3.2</b> ARMA<span class="math inline">\((p,q)\)</span>モデルによる予測</a></li>
<li class="chapter" data-level="3.3" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの推定"><i class="fa fa-check"></i><b>3.3</b> ARMA<span class="math inline">\((p,q)\)</span>モデルの推定</a></li>
<li class="chapter" data-level="3.4" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの同定-次数の特定"><i class="fa fa-check"></i><b>3.4</b> ARMA<span class="math inline">\((p,q)\)</span>モデルの同定 (次数の特定)</a></li>
<li class="chapter" data-level="3.5" data-path="armapqモデル.html"><a href="armapqモデル.html#r操作"><i class="fa fa-check"></i><b>3.5</b> R操作</a>
<ul>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの同定-acfpacfeacfの利用"><i class="fa fa-check"></i>ARMA<span class="math inline">\((p,q)\)</span>モデルの同定 (ACF/PACF/EACFの利用)</a></li>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの推定診断"><i class="fa fa-check"></i>ARMA<span class="math inline">\((p,q)\)</span>モデルの推定・診断</a></li>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#パッケージforecastの利用"><i class="fa fa-check"></i>パッケージ{forecast}の利用</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="armapqモデル.html"><a href="armapqモデル.html#データ分析例-tsay-ch2より"><i class="fa fa-check"></i><b>3.6</b> データ分析例 (Tsay, Ch2より)</a>
<ul>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#標本acf"><i class="fa fa-check"></i>標本ACF</a></li>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#ar-ma-arma-2.42.6"><i class="fa fa-check"></i>AR, MA, ARMA (2.4–2.6)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html"><i class="fa fa-check"></i><b>4</b> ARIMA/SARIMAモデル</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#arimapdqモデルとは"><i class="fa fa-check"></i><b>4.1</b> ARIMA<span class="math inline">\((p,d,q)\)</span>モデルとは</a></li>
<li class="chapter" data-level="4.2" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#sarimapdqtimes-pdq_sモデル-周期sとは"><i class="fa fa-check"></i><b>4.2</b> SARIMA<span class="math inline">\((p,d,q)\times (P,D,Q)_s\)</span>モデル (周期<span class="math inline">\(s\)</span>)とは</a></li>
<li class="chapter" data-level="4.3" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#sarimaモデルのパス生成-パッケージsarimaの利用"><i class="fa fa-check"></i><b>4.3</b> SARIMAモデルのパス生成: パッケージ<strong>sarima</strong>の利用</a></li>
<li class="chapter" data-level="4.4" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#sarimaモデルの推定診断"><i class="fa fa-check"></i><b>4.4</b> SARIMAモデルの推定・診断</a>
<ul>
<li class="chapter" data-level="" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#パッケージforecastの利用-1"><i class="fa fa-check"></i>パッケージ<strong>forecast</strong>の利用</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#データ分析例"><i class="fa fa-check"></i><b>4.5</b> データ分析例</a>
<ul>
<li class="chapter" data-level="" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#データセット-bonds"><i class="fa fa-check"></i>データセット: bonds</a></li>
<li class="chapter" data-level="" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#データセット-airpassengers"><i class="fa fa-check"></i>データセット: AirPassengers</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="arimasarimaモデル.html"><a href="arimasarimaモデル.html#外生変数があるケース"><i class="fa fa-check"></i><b>4.6</b> 外生変数があるケース</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html"><i class="fa fa-check"></i><b>5</b> 確率的トレンドと単位根検定</a>
<ul>
<li class="chapter" data-level="5.1" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#確率的トレンド-vs-確定的トレンド"><i class="fa fa-check"></i><b>5.1</b> 確率的トレンド vs 確定的トレンド</a></li>
<li class="chapter" data-level="5.2" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#単位根過程と見せかけの回帰"><i class="fa fa-check"></i><b>5.2</b> 単位根過程と見せかけの回帰</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#単位根過程"><i class="fa fa-check"></i><b>5.2.1</b> 単位根過程</a></li>
<li class="chapter" data-level="5.2.2" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#見せかけの回帰"><i class="fa fa-check"></i><b>5.2.2</b> 見せかけの回帰</a></li>
<li class="chapter" data-level="5.2.3" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#見せかけの回帰の判定"><i class="fa fa-check"></i><b>5.2.3</b> 見せかけの回帰の判定</a></li>
<li class="chapter" data-level="5.2.4" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#rで実行可能な主な単位根検定法"><i class="fa fa-check"></i><b>5.2.4</b> Rで実行可能な主な単位根検定法</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#augmented-dicky-fuller-adf-検定"><i class="fa fa-check"></i><b>5.3</b> Augmented Dicky-Fuller (ADF) 検定</a>
<ul>
<li class="chapter" data-level="" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#パッケージfunitroots"><i class="fa fa-check"></i>パッケージ<strong>fUnitRoots</strong></a></li>
<li class="chapter" data-level="" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#パッケージtseries"><i class="fa fa-check"></i>パッケージ<strong>tseries</strong></a></li>
<li class="chapter" data-level="" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#パッケージurca"><i class="fa fa-check"></i>パッケージ<strong>urca</strong></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#adf検定以外の検定法"><i class="fa fa-check"></i><b>5.4</b> ADF検定以外の検定法</a>
<ul>
<li class="chapter" data-level="" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#phillips-perron-pp-検定"><i class="fa fa-check"></i>Phillips-Perron (PP) 検定</a></li>
<li class="chapter" data-level="" data-path="確率的トレンドと単位根検定.html"><a href="確率的トレンドと単位根検定.html#kwiatkowski-phillips-schmidt-shin-kpss-検定"><i class="fa fa-check"></i>Kwiatkowski-Phillips-Schmidt-Shin (KPSS) 検定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="長期記憶過程.html"><a href="長期記憶過程.html"><i class="fa fa-check"></i><b>6</b> 長期記憶過程</a>
<ul>
<li class="chapter" data-level="6.1" data-path="長期記憶過程.html"><a href="長期記憶過程.html#長期記憶過程のシミュレーション"><i class="fa fa-check"></i><b>6.1</b> 長期記憶過程のシミュレーション</a>
<ul>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#パッケージfracdiffの利用"><i class="fa fa-check"></i>パッケージ<strong>fracdiff</strong>の利用</a></li>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#パッケージlongmemoの利用"><i class="fa fa-check"></i>パッケージ<strong>longmemo</strong>の利用</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="長期記憶過程.html"><a href="長期記憶過程.html#hurst指数の推定"><i class="fa fa-check"></i><b>6.2</b> Hurst指数の推定</a>
<ul>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#パッケージpracmaの利用"><i class="fa fa-check"></i>パッケージ<strong>pracma</strong>の利用</a></li>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#パッケージfractalの利用"><i class="fa fa-check"></i>パッケージ<strong>fractal</strong>の利用</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimaモデルの推定"><i class="fa fa-check"></i><b>6.3</b> ARFIMAモデルの推定</a>
<ul>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#パッケージfracdiffの利用-1"><i class="fa fa-check"></i>パッケージ<strong>fracdiff</strong>の利用</a></li>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#パッケージnsarfimaの利用"><i class="fa fa-check"></i>パッケージ<strong>nsarfima</strong>の利用</a></li>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#階差次数dの代替的推定法"><i class="fa fa-check"></i>階差次数<span class="math inline">\(d\)</span>の代替的推定法</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimaモデル-データ分析例-1"><i class="fa fa-check"></i><b>6.4</b> ARFIMAモデル: データ分析例 (1)</a></li>
<li class="chapter" data-level="6.5" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimaモデル-データ分析例-2"><i class="fa fa-check"></i><b>6.5</b> ARFIMAモデル: データ分析例 (2)</a>
<ul>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#最適なarfimaモデルの選択および推定"><i class="fa fa-check"></i>最適なARFIMAモデルの選択および推定</a></li>
<li class="chapter" data-level="" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimaモデルによる外挿予測"><i class="fa fa-check"></i>ARFIMAモデルによる外挿予測</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="レジームスイッチングモデル.html"><a href="レジームスイッチングモデル.html"><i class="fa fa-check"></i><b>7</b> レジーム・スイッチング・モデル</a>
<ul>
<li class="chapter" data-level="7.1" data-path="レジームスイッチングモデル.html"><a href="レジームスイッチングモデル.html#自己回帰マルコフスイッチングモデル-msm-ar"><i class="fa fa-check"></i><b>7.1</b> 自己回帰マルコフ・スイッチング・モデル (MSM-AR)</a></li>
<li class="chapter" data-level="7.2" data-path="レジームスイッチングモデル.html"><a href="レジームスイッチングモデル.html#パッケージnhmsarの利用"><i class="fa fa-check"></i><b>7.2</b> パッケージ<strong>NHMSAR</strong>の利用</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="garchモデル.html"><a href="garchモデル.html"><i class="fa fa-check"></i><b>8</b> GARCHモデル</a>
<ul>
<li class="chapter" data-level="8.1" data-path="garchモデル.html"><a href="garchモデル.html#収益率データとarch効果"><i class="fa fa-check"></i><b>8.1</b> 収益率データとARCH効果</a></li>
<li class="chapter" data-level="8.2" data-path="garchモデル.html"><a href="garchモデル.html#archgarchモデル"><i class="fa fa-check"></i><b>8.2</b> ARCH/GARCHモデル</a>
<ul>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#garchpqモデル"><i class="fa fa-check"></i>GARCH(p,q)モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#garchモデリング"><i class="fa fa-check"></i>GARCHモデリング</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="garchモデル.html"><a href="garchモデル.html#archgarchモデルのシミュレーション"><i class="fa fa-check"></i><b>8.3</b> ARCH/GARCHモデルのシミュレーション</a>
<ul>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#パッケージfgarchの利用"><i class="fa fa-check"></i>パッケージ<strong>fGarch</strong>の利用</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#archpモデル"><i class="fa fa-check"></i>ARCH(p)モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#garchpqモデル-1"><i class="fa fa-check"></i>GARCH(p,q)モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#armapq-garchpqモデル"><i class="fa fa-check"></i>ARMA(p’,q’)-GARCH(p,q)モデル</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="garchモデル.html"><a href="garchモデル.html#archgarchモデルの適合"><i class="fa fa-check"></i><b>8.4</b> ARCH/GARCHモデルの適合</a>
<ul>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#パッケージrugarchの利用"><i class="fa fa-check"></i>パッケージ<strong>rugarch</strong>の利用</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#iarch11"><i class="fa fa-check"></i>IARCH(1,1)</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#gjr-garch11"><i class="fa fa-check"></i>GJR-GARCH(1,1)</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#aparch"><i class="fa fa-check"></i>APARCH</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="garchモデル.html"><a href="garchモデル.html#garchモデル-データ分析例-tsay-ch4"><i class="fa fa-check"></i><b>8.5</b> GARCHモデル: データ分析例 (Tsay, Ch4)</a>
<ul>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#必要な関数やデータセットの入手"><i class="fa fa-check"></i>必要な関数やデータセットの入手</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#integrated-garch-モデル"><i class="fa fa-check"></i>Integrated GARCH モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#garch-m-モデル"><i class="fa fa-check"></i>GARCH-M モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#exponential-garch-model"><i class="fa fa-check"></i>Exponential GARCH Model</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#threshold-garch-モデル"><i class="fa fa-check"></i>Threshold GARCH モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#asymmetric-power-arch-モデル"><i class="fa fa-check"></i>Asymmetric Power ARCH モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#nonsymmetric-garch-モデル"><i class="fa fa-check"></i>Nonsymmetric GARCH モデル</a></li>
<li class="chapter" data-level="" data-path="garchモデル.html"><a href="garchモデル.html#代替的アプリーチ間の比較"><i class="fa fa-check"></i>代替的アプリーチ間の比較</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="varモデル.html"><a href="varモデル.html"><i class="fa fa-check"></i><b>9</b> VARモデル</a>
<ul>
<li class="chapter" data-level="9.1" data-path="varモデル.html"><a href="varモデル.html#varpモデルのシミュレーション"><i class="fa fa-check"></i><b>9.1</b> VAR(<span class="math inline">\(p\)</span>)モデルのシミュレーション</a>
<ul>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#パッケージmts-varsの利用"><i class="fa fa-check"></i>パッケージ<strong>MTS</strong>, <strong>vars</strong>の利用</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="varモデル.html"><a href="varモデル.html#varpモデルの構築"><i class="fa fa-check"></i><b>9.2</b> VAR(<span class="math inline">\(p\)</span>)モデルの構築</a>
<ul>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#varpモデルの次数同定"><i class="fa fa-check"></i>VAR(<span class="math inline">\(p\)</span>)モデルの次数同定</a></li>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#varpモデルの推定"><i class="fa fa-check"></i>VAR(<span class="math inline">\(p\)</span>)モデルの推定</a></li>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#varpモデル予測"><i class="fa fa-check"></i>VAR(<span class="math inline">\(p\)</span>)モデル予測</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="varモデル.html"><a href="varモデル.html#var解析"><i class="fa fa-check"></i><b>9.3</b> VAR解析</a>
<ul>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#varp-モデルの構築-復習"><i class="fa fa-check"></i>VAR(<span class="math inline">\(p\)</span>) モデルの構築 (復習)</a></li>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#グレンジャーの因果性検定"><i class="fa fa-check"></i>グレンジャーの因果性検定</a></li>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#インパルス応答"><i class="fa fa-check"></i>インパルス応答</a></li>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#予測誤差分散分解-forecast-error-variance-decomposition"><i class="fa fa-check"></i>予測誤差分散分解 (forecast error variance decomposition)</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="varモデル.html"><a href="varモデル.html#補足-分散共分散行列のコレスキー分解"><i class="fa fa-check"></i><b>9.4</b> 補足: 分散共分散行列のコレスキー分解</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="共和分分析.html"><a href="共和分分析.html"><i class="fa fa-check"></i><b>10</b> 共和分分析</a>
<ul>
<li class="chapter" data-level="10.1" data-path="共和分分析.html"><a href="共和分分析.html#見せかけの回帰-再掲"><i class="fa fa-check"></i><b>10.1</b> 見せかけの回帰 (再掲)</a>
<ul>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#durbin-watson検定"><i class="fa fa-check"></i>Durbin-Watson検定</a></li>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#rで実行可能な主な単位根検定法-1"><i class="fa fa-check"></i>Rで実行可能な主な単位根検定法</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="共和分分析.html"><a href="共和分分析.html#共和分分析-1"><i class="fa fa-check"></i><b>10.2</b> 共和分分析</a>
<ul>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#englegrangerの方法-philips-ouliaris検定"><i class="fa fa-check"></i>Engle–Grangerの方法 (Philips-Ouliaris検定)</a></li>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#johansenの方法"><i class="fa fa-check"></i>Johansenの方法</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="共和分分析.html"><a href="共和分分析.html#誤差修正モデル-データ分析例-tsay-mts-ch5"><i class="fa fa-check"></i><b>10.3</b> 誤差修正モデル: データ分析例 (Tsay, MTS, Ch5)</a>
<ul>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#共和分検定"><i class="fa fa-check"></i>共和分検定</a></li>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#johansenの方法-1"><i class="fa fa-check"></i>Johansenの方法</a></li>
<li class="chapter" data-level="" data-path="共和分分析.html"><a href="共和分分析.html#誤差修正モデル-ecm-の推定"><i class="fa fa-check"></i>誤差修正モデル (ECM) の推定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html"><i class="fa fa-check"></i><b>11</b> 多変量ボラティリティ・モデル</a>
<ul>
<li class="chapter" data-level="11.1" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#ボラティリティスピルオーバー-volatility-spillover"><i class="fa fa-check"></i><b>11.1</b> ボラティリティ・スピルオーバー (volatility spillover)</a></li>
<li class="chapter" data-level="11.2" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#多変量garchモデル-データ分析例-tsay-mts-ch.7"><i class="fa fa-check"></i><b>11.2</b> 多変量GARCHモデル: データ分析例 (Tsay, MTS, Ch.7)</a>
<ul>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#多変量時系列データの条件付不均一分散性の検定"><i class="fa fa-check"></i>多変量時系列データの条件付不均一分散性の検定</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#指数加重移動平均法-ewma"><i class="fa fa-check"></i>指数加重移動平均法 (EWMA)</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#bekk1-1モデル"><i class="fa fa-check"></i>BEKK(1, 1)モデル</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#cholesky分解を利用したボラティリティモデリングおよび推定"><i class="fa fa-check"></i>Cholesky分解を利用したボラティリティ・モデリングおよび推定</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#dcc-dynamic-conditional-correlation-モデル"><i class="fa fa-check"></i>DCC (Dynamic Conditional Correlation) モデル</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#go-garchモデル"><i class="fa fa-check"></i>GO-GARCHモデル</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#コピュラに基づくアプローチ"><i class="fa fa-check"></i>コピュラに基づくアプローチ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="動的線形モデル.html"><a href="動的線形モデル.html"><i class="fa fa-check"></i><b>12</b> 動的線形モデル</a>
<ul>
<li class="chapter" data-level="12.1" data-path="動的線形モデル.html"><a href="動的線形モデル.html#局所水準-local-level-モデル"><i class="fa fa-check"></i><b>12.1</b> 局所水準 (local level) モデル</a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#フィルタリング"><i class="fa fa-check"></i>フィルタリング</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#スムージング-平滑化"><i class="fa fa-check"></i>スムージング (平滑化)</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#状態予測"><i class="fa fa-check"></i>状態予測</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#モデル診断-1"><i class="fa fa-check"></i>モデル診断</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#モデルパラメータの推定"><i class="fa fa-check"></i>モデル・パラメータの推定</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="動的線形モデル.html"><a href="動的線形モデル.html#local-level-plus-seasonal-componentモデル"><i class="fa fa-check"></i><b>12.2</b> local level plus seasonal componentモデル</a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#状態予測-1"><i class="fa fa-check"></i>状態予測</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="動的線形モデル.html"><a href="動的線形モデル.html#動的回帰モデル"><i class="fa fa-check"></i><b>12.3</b> 動的回帰モデル</a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#スムージング"><i class="fa fa-check"></i>スムージング</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="動的線形モデル.html"><a href="動的線形モデル.html#sur-seemingly-unrelated-regression-モデル-3.3.3"><i class="fa fa-check"></i><b>12.4</b> SUR (Seemingly Unrelated Regression) モデル (3.3.3)</a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#参考文献"><i class="fa fa-check"></i>参考文献</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html"><i class="fa fa-check"></i><b>13</b> 高頻度データ分析</a>
<ul>
<li class="chapter" data-level="13.1" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#ボラティリティ推定"><i class="fa fa-check"></i><b>13.1</b> ボラティリティ推定</a>
<ul>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#データセット1-topix指数データ"><i class="fa fa-check"></i>データセット1: TOPIX指数データ</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#実現ボラティリティの計算"><i class="fa fa-check"></i>実現ボラティリティの計算</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#parkinsonボラティリティの計算"><i class="fa fa-check"></i>Parkinsonボラティリティの計算</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#har-rvモデルによる予測"><i class="fa fa-check"></i>HAR-RVモデルによる予測</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#共分散相関の推定"><i class="fa fa-check"></i><b>13.2</b> 共分散・相関の推定</a>
<ul>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#データセット2-株価指数先物データ"><i class="fa fa-check"></i>データセット2: 株価指数先物データ</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#共分散相関の推定-1"><i class="fa fa-check"></i>共分散・相関の推定</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#acdモデル"><i class="fa fa-check"></i><b>13.3</b> ACDモデル</a>
<ul>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#補足-等間隔データを作成するための方法"><i class="fa fa-check"></i>補足: 等間隔データを作成するための方法</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix 参考文献</b></span></li>
<li class="chapter" data-level="A" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html"><i class="fa fa-check"></i><b>A</b> バブル (生成・崩壊) 検出</a>
<ul>
<li class="chapter" data-level="A.1" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#検定法に関する最近のレビュー論文"><i class="fa fa-check"></i><b>A.1</b> 検定法に関する最近のレビュー論文</a></li>
<li class="chapter" data-level="A.2" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#supreme-adf検定sadf-pwy-2011-generalized-supreme-adf-検定gsadf-psy-2015"><i class="fa fa-check"></i><b>A.2</b> Supreme ADF検定/SADF (PWY, 2011), Generalized supreme ADF 検定/GSADF (PSY, 2015)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#数理ファイナンス-jarrow-protterら"><i class="fa fa-check"></i><b>A.2.1</b> 数理ファイナンス (Jarrow, Protterら)</a></li>
<li class="chapter" data-level="A.2.2" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#経済物理学-sornetteら"><i class="fa fa-check"></i><b>A.2.2</b> 経済物理学 (Sornetteら)</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#実証分析"><i class="fa fa-check"></i><b>A.3</b> 実証分析</a>
<ul>
<li class="chapter" data-level="" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#株式市場の例"><i class="fa fa-check"></i>株式市場の例</a></li>
<li class="chapter" data-level="" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#暗号資産市場の例"><i class="fa fa-check"></i>暗号資産市場の例</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html"><i class="fa fa-check"></i><b>B</b> 長期記憶過程</a>
<ul>
<li class="chapter" data-level="B.1" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#理論概説"><i class="fa fa-check"></i><b>B.1</b> 理論・概説</a></li>
<li class="chapter" data-level="B.2" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#株式市場"><i class="fa fa-check"></i><b>B.2</b> 株式市場</a></li>
<li class="chapter" data-level="B.3" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#外国為替市場"><i class="fa fa-check"></i><b>B.3</b> 外国為替市場</a></li>
<li class="chapter" data-level="B.4" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#コモディティ暗号資産"><i class="fa fa-check"></i><b>B.4</b> コモディティ・暗号資産</a></li>
<li class="chapter" data-level="B.5" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#vix"><i class="fa fa-check"></i><b>B.5</b> VIX</a></li>
<li class="chapter" data-level="B.6" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#高頻度データ-ボラティリティ-注文フロー等"><i class="fa fa-check"></i><b>B.6</b> 高頻度データ (ボラティリティ, 注文フロー等)</a></li>
<li class="chapter" data-level="B.7" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#長期記憶性の発生要因-非長期記憶モデルによる近似"><i class="fa fa-check"></i><b>B.7</b> 長期記憶性の発生要因, 非長期記憶モデルによる近似</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html"><i class="fa fa-check"></i><b>C</b> Markov switching/ regime switchingモデル</a>
<ul>
<li class="chapter" data-level="C.1" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#理論概説-1"><i class="fa fa-check"></i><b>C.1</b> 理論・概説</a></li>
<li class="chapter" data-level="C.2" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#株式市場-1"><i class="fa fa-check"></i><b>C.2</b> 株式市場</a></li>
<li class="chapter" data-level="C.3" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#金利債券市場"><i class="fa fa-check"></i><b>C.3</b> 金利・債券市場</a></li>
<li class="chapter" data-level="C.4" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#外国為替市場-1"><i class="fa fa-check"></i><b>C.4</b> 外国為替市場</a></li>
<li class="chapter" data-level="C.5" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#アセットアロケーション"><i class="fa fa-check"></i><b>C.5</b> アセット・アロケーション</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html"><i class="fa fa-check"></i><b>D</b> ARCH/GARCHモデル</a>
<ul>
<li class="chapter" data-level="D.1" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html#概説"><i class="fa fa-check"></i><b>D.1</b> 概説</a></li>
<li class="chapter" data-level="D.2" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html#arch-model"><i class="fa fa-check"></i><b>D.2</b> ARCH model</a></li>
<li class="chapter" data-level="D.3" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html#garch-model"><i class="fa fa-check"></i><b>D.3</b> GARCH model</a></li>
<li class="chapter" data-level="D.4" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html#arch-m-model"><i class="fa fa-check"></i><b>D.4</b> ARCH-M Model</a></li>
<li class="chapter" data-level="D.5" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html#gjr-model"><i class="fa fa-check"></i><b>D.5</b> GJR model</a></li>
<li class="chapter" data-level="D.6" data-path="archgarchモデル-1.html"><a href="archgarchモデル-1.html#aparch-model"><i class="fa fa-check"></i><b>D.6</b> APARCH model</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">金融時系列解析</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="動的線形モデル" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">12</span> 動的線形モデル<a href="動的線形モデル.html#動的線形モデル" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!--
本章では, 動的線形モデル (Dynamic Linear Models) を扱うRパッケージを幾つか取り上げ, 利用方法を紹介する.
特に, 共通のデータセット (ナイル川の年間流量) に対する共通のモデル (local levelモデル, ランダムウォーク+ノイズ・モデル) を用いて, 各々のパッケージにおける操作 (フィルタリング・平滑化 (スムージング)・予測等) を行い, 使い勝手を比較する.
-->
<p>本章では, 動的線形モデル (Dynamic Linear Models) を取り上る.
Rパッケージとしては, <strong>dlm</strong>を利用する.</p>
<ul>
<li>出所:
<ul>
<li>Petris, Petrone, and Campagnoli (2009). Dynamic Linear Models with R. Springer (“PPC”)</li>
</ul></li>
</ul>
<p><strong>dlm</strong>は, PPCを手元で参照しながらでないと使いこなすことが難しい.
本セクションのRコード実行結果の詳しい解説については, PPCを参照のこと.</p>
<pre><code>Nileデータ
- アスワン (Aswan) におけるナイル川の年間流量の計測量
- 1871--1970年 (単位 10^8立方メートル)
- 1898年付近に変化点が見られる (Cobb(1978), Table 1, p.249）</code></pre>
<div id="パッケージdlm" class="section level4 unnumbered hasAnchor">
<h4>パッケージ<strong>dlm</strong><a href="動的線形モデル.html#パッケージdlm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>動的線形モデル (DLM) のベイズ分析用パッケージ</li>
<li>DLMのパラメータの最尤推定とカルマン・フィルターの関数を含む</li>
</ul>
<pre><code>DLMの特定化に関係する主要な関数
- dlm(): Dynamic Linear Objectsの生成
- dlmModReg(): 線形回帰モデルのDLM表現
- dlmModPoly(): $n$-次多項式DLM表現
- dlmModSeas(): 季節成分のDLM表現
- dlmModTrig(): 周期成分のDLM表現
- dlmModARMA(): (多変量)ARMA過程のDLM表現</code></pre>
<p>状態の推定に先立ち, 動的線形モデル (DLM)
の特定化は, 関数<code>dlmModReg()</code>によって行う.</p>
<pre><code>- dlmModReg()
  - dV: 観測ノイズ$V$
  - dW: システムノイズの共分散行列$W$対角成分
  - m0: 状態ベクトル初期値の期待値$m0$
  - C0: 状態ベクトル初期値の共分散行列$C0$</code></pre>
<!--
- 以下の実行結果の解説, Petris, et al.(2009), Ch.2を参照
-->
<ul>
<li>正規乱数により生成した<span class="math inline">\(10 \times 2\)</span>の説明変数行列<span class="math inline">\(x\)</span>を
<code>dlmModReg()</code>に代入した場合の出力</li>
</ul>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="動的線形モデル.html#cb945-1" tabindex="-1"></a><span class="fu">library</span>(dlm)</span>
<span id="cb945-2"><a href="動的線形モデル.html#cb945-2" tabindex="-1"></a><span class="do">## Linear regression as a DLM</span></span>
<span id="cb945-3"><a href="動的線形モデル.html#cb945-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>),<span class="at">ncol =</span> <span class="dv">2</span>) <span class="co"># 説明変数 (デザイン行列)</span></span>
<span id="cb945-4"><a href="動的線形モデル.html#cb945-4" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">dlmModReg</span>(x)</span>
<span id="cb945-5"><a href="動的線形モデル.html#cb945-5" tabindex="-1"></a><span class="co"># is.dlm(mod)</span></span>
<span id="cb945-6"><a href="動的線形モデル.html#cb945-6" tabindex="-1"></a>mod</span>
<span id="cb945-7"><a href="動的線形モデル.html#cb945-7" tabindex="-1"></a><span class="co">#&gt; $FF</span></span>
<span id="cb945-8"><a href="動的線形モデル.html#cb945-8" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb945-9"><a href="動的線形モデル.html#cb945-9" tabindex="-1"></a><span class="co">#&gt; [1,]    1    1    1</span></span>
<span id="cb945-10"><a href="動的線形モデル.html#cb945-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-11"><a href="動的線形モデル.html#cb945-11" tabindex="-1"></a><span class="co">#&gt; $V</span></span>
<span id="cb945-12"><a href="動的線形モデル.html#cb945-12" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb945-13"><a href="動的線形モデル.html#cb945-13" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb945-14"><a href="動的線形モデル.html#cb945-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-15"><a href="動的線形モデル.html#cb945-15" tabindex="-1"></a><span class="co">#&gt; $GG</span></span>
<span id="cb945-16"><a href="動的線形モデル.html#cb945-16" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb945-17"><a href="動的線形モデル.html#cb945-17" tabindex="-1"></a><span class="co">#&gt; [1,]    1    0    0</span></span>
<span id="cb945-18"><a href="動的線形モデル.html#cb945-18" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1    0</span></span>
<span id="cb945-19"><a href="動的線形モデル.html#cb945-19" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    1</span></span>
<span id="cb945-20"><a href="動的線形モデル.html#cb945-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-21"><a href="動的線形モデル.html#cb945-21" tabindex="-1"></a><span class="co">#&gt; $W</span></span>
<span id="cb945-22"><a href="動的線形モデル.html#cb945-22" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb945-23"><a href="動的線形モデル.html#cb945-23" tabindex="-1"></a><span class="co">#&gt; [1,]    0    0    0</span></span>
<span id="cb945-24"><a href="動的線形モデル.html#cb945-24" tabindex="-1"></a><span class="co">#&gt; [2,]    0    0    0</span></span>
<span id="cb945-25"><a href="動的線形モデル.html#cb945-25" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    0</span></span>
<span id="cb945-26"><a href="動的線形モデル.html#cb945-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-27"><a href="動的線形モデル.html#cb945-27" tabindex="-1"></a><span class="co">#&gt; $JFF</span></span>
<span id="cb945-28"><a href="動的線形モデル.html#cb945-28" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb945-29"><a href="動的線形モデル.html#cb945-29" tabindex="-1"></a><span class="co">#&gt; [1,]    0    1    2</span></span>
<span id="cb945-30"><a href="動的線形モデル.html#cb945-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-31"><a href="動的線形モデル.html#cb945-31" tabindex="-1"></a><span class="co">#&gt; $X</span></span>
<span id="cb945-32"><a href="動的線形モデル.html#cb945-32" tabindex="-1"></a><span class="co">#&gt;      [,1]   [,2]  </span></span>
<span id="cb945-33"><a href="動的線形モデル.html#cb945-33" tabindex="-1"></a><span class="co">#&gt; [1,] -0.965 1.565 </span></span>
<span id="cb945-34"><a href="動的線形モデル.html#cb945-34" tabindex="-1"></a><span class="co">#&gt; [2,] 0.5509 -2.347</span></span>
<span id="cb945-35"><a href="動的線形モデル.html#cb945-35" tabindex="-1"></a><span class="co">#&gt; [3,] ...          </span></span>
<span id="cb945-36"><a href="動的線形モデル.html#cb945-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-37"><a href="動的線形モデル.html#cb945-37" tabindex="-1"></a><span class="co">#&gt; $m0</span></span>
<span id="cb945-38"><a href="動的線形モデル.html#cb945-38" tabindex="-1"></a><span class="co">#&gt; [1] 0 0 0</span></span>
<span id="cb945-39"><a href="動的線形モデル.html#cb945-39" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb945-40"><a href="動的線形モデル.html#cb945-40" tabindex="-1"></a><span class="co">#&gt; $C0</span></span>
<span id="cb945-41"><a href="動的線形モデル.html#cb945-41" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2]  [,3]</span></span>
<span id="cb945-42"><a href="動的線形モデル.html#cb945-42" tabindex="-1"></a><span class="co">#&gt; [1,] 1e+07 0e+00 0e+00</span></span>
<span id="cb945-43"><a href="動的線形モデル.html#cb945-43" tabindex="-1"></a><span class="co">#&gt; [2,] 0e+00 1e+07 0e+00</span></span>
<span id="cb945-44"><a href="動的線形モデル.html#cb945-44" tabindex="-1"></a><span class="co">#&gt; [3,] 0e+00 0e+00 1e+07</span></span>
<span id="cb945-45"><a href="動的線形モデル.html#cb945-45" tabindex="-1"></a><span class="do">## Adding dlm&#39;s</span></span>
<span id="cb945-46"><a href="動的線形モデル.html#cb945-46" tabindex="-1"></a><span class="co"># dlmModPoly() + dlmModSeas(4) # linear trend plus quarterly seasonal component</span></span></code></pre></div>
<p>一方, <span class="math inline">\(n\)</span>-次多項式DLMの場合は, <code>dlmModPoly()</code>を用いる.</p>
<pre><code>- dlmModPoly(): $n$-次多項式DLMの生成
  - order=1: local level(ランダムウォーク+ノイズ)
  - order=2: stochastic linear trend (局所線形トレンドモデル) (デフォルト)</code></pre>
<ul>
<li>観測ノイズ<span class="math inline">\(V=0.3\)</span>, システムノイズ (の分散共分散行列の対角成分)
<span class="math inline">\(W=0.01\)</span>に持つ局所水準 (ランダムウォーク+ノイズ) モデルの特定化の場合の出力</li>
</ul>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="動的線形モデル.html#cb947-1" tabindex="-1"></a><span class="do">## the default</span></span>
<span id="cb947-2"><a href="動的線形モデル.html#cb947-2" tabindex="-1"></a><span class="fu">dlmModPoly</span>()</span>
<span id="cb947-3"><a href="動的線形モデル.html#cb947-3" tabindex="-1"></a><span class="co">#&gt; $FF</span></span>
<span id="cb947-4"><a href="動的線形モデル.html#cb947-4" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb947-5"><a href="動的線形モデル.html#cb947-5" tabindex="-1"></a><span class="co">#&gt; [1,]    1    0</span></span>
<span id="cb947-6"><a href="動的線形モデル.html#cb947-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-7"><a href="動的線形モデル.html#cb947-7" tabindex="-1"></a><span class="co">#&gt; $V</span></span>
<span id="cb947-8"><a href="動的線形モデル.html#cb947-8" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb947-9"><a href="動的線形モデル.html#cb947-9" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb947-10"><a href="動的線形モデル.html#cb947-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-11"><a href="動的線形モデル.html#cb947-11" tabindex="-1"></a><span class="co">#&gt; $GG</span></span>
<span id="cb947-12"><a href="動的線形モデル.html#cb947-12" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb947-13"><a href="動的線形モデル.html#cb947-13" tabindex="-1"></a><span class="co">#&gt; [1,]    1    1</span></span>
<span id="cb947-14"><a href="動的線形モデル.html#cb947-14" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1</span></span>
<span id="cb947-15"><a href="動的線形モデル.html#cb947-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-16"><a href="動的線形モデル.html#cb947-16" tabindex="-1"></a><span class="co">#&gt; $W</span></span>
<span id="cb947-17"><a href="動的線形モデル.html#cb947-17" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb947-18"><a href="動的線形モデル.html#cb947-18" tabindex="-1"></a><span class="co">#&gt; [1,]    0    0</span></span>
<span id="cb947-19"><a href="動的線形モデル.html#cb947-19" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1</span></span>
<span id="cb947-20"><a href="動的線形モデル.html#cb947-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-21"><a href="動的線形モデル.html#cb947-21" tabindex="-1"></a><span class="co">#&gt; $m0</span></span>
<span id="cb947-22"><a href="動的線形モデル.html#cb947-22" tabindex="-1"></a><span class="co">#&gt; [1] 0 0</span></span>
<span id="cb947-23"><a href="動的線形モデル.html#cb947-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-24"><a href="動的線形モデル.html#cb947-24" tabindex="-1"></a><span class="co">#&gt; $C0</span></span>
<span id="cb947-25"><a href="動的線形モデル.html#cb947-25" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2]</span></span>
<span id="cb947-26"><a href="動的線形モデル.html#cb947-26" tabindex="-1"></a><span class="co">#&gt; [1,] 1e+07 0e+00</span></span>
<span id="cb947-27"><a href="動的線形モデル.html#cb947-27" tabindex="-1"></a><span class="co">#&gt; [2,] 0e+00 1e+07</span></span>
<span id="cb947-28"><a href="動的線形モデル.html#cb947-28" tabindex="-1"></a><span class="do">## random walk plus noise</span></span>
<span id="cb947-29"><a href="動的線形モデル.html#cb947-29" tabindex="-1"></a><span class="fu">dlmModPoly</span>(<span class="dv">1</span>, <span class="at">dV =</span> .<span class="dv">3</span>, <span class="at">dW =</span> .<span class="dv">01</span>)</span>
<span id="cb947-30"><a href="動的線形モデル.html#cb947-30" tabindex="-1"></a><span class="co">#&gt; $FF</span></span>
<span id="cb947-31"><a href="動的線形モデル.html#cb947-31" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb947-32"><a href="動的線形モデル.html#cb947-32" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb947-33"><a href="動的線形モデル.html#cb947-33" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-34"><a href="動的線形モデル.html#cb947-34" tabindex="-1"></a><span class="co">#&gt; $V</span></span>
<span id="cb947-35"><a href="動的線形モデル.html#cb947-35" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb947-36"><a href="動的線形モデル.html#cb947-36" tabindex="-1"></a><span class="co">#&gt; [1,]  0.3</span></span>
<span id="cb947-37"><a href="動的線形モデル.html#cb947-37" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-38"><a href="動的線形モデル.html#cb947-38" tabindex="-1"></a><span class="co">#&gt; $GG</span></span>
<span id="cb947-39"><a href="動的線形モデル.html#cb947-39" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb947-40"><a href="動的線形モデル.html#cb947-40" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb947-41"><a href="動的線形モデル.html#cb947-41" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-42"><a href="動的線形モデル.html#cb947-42" tabindex="-1"></a><span class="co">#&gt; $W</span></span>
<span id="cb947-43"><a href="動的線形モデル.html#cb947-43" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb947-44"><a href="動的線形モデル.html#cb947-44" tabindex="-1"></a><span class="co">#&gt; [1,] 0.01</span></span>
<span id="cb947-45"><a href="動的線形モデル.html#cb947-45" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-46"><a href="動的線形モデル.html#cb947-46" tabindex="-1"></a><span class="co">#&gt; $m0</span></span>
<span id="cb947-47"><a href="動的線形モデル.html#cb947-47" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb947-48"><a href="動的線形モデル.html#cb947-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb947-49"><a href="動的線形モデル.html#cb947-49" tabindex="-1"></a><span class="co">#&gt; $C0</span></span>
<span id="cb947-50"><a href="動的線形モデル.html#cb947-50" tabindex="-1"></a><span class="co">#&gt;       [,1]</span></span>
<span id="cb947-51"><a href="動的線形モデル.html#cb947-51" tabindex="-1"></a><span class="co">#&gt; [1,] 1e+07</span></span></code></pre></div>
</div>
<div id="局所水準-local-level-モデル" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> 局所水準 (local level) モデル<a href="動的線形モデル.html#局所水準-local-level-モデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>最も単純なDLMの一つとしてランダムウォーク+ノイズモデル (local level model) をナイル川流量データのモデリングに使用する.</p>
<ul>
<li>local levelモデル. 観測変数 <span class="math inline">\(Y_t\)</span> に対して,
<span class="math display">\[
\begin{align}
Y_t &amp;= \mu_t + v_t, \quad v_t \sim_{i.i.d.} N(0,V), \\
\mu_{t} &amp;= \mu_{t-1} + w_t, \quad w_t \sim_{i.i.d.} N(0,W).
\end{align}
\]</span>
ここで, <span class="math inline">\(\mu_t\)</span>は時点<span class="math inline">\(t\)</span>における状態変数であり, 観測不能 (潜在的な) 水準 (level), <span class="math inline">\(v_t,w_t\)</span>は攪乱項である.
状態変数 <span class="math inline">\(\mu_t\)</span> はKalman filterを用いることで推定できる.
二つのパラメータ<span class="math inline">\(V,W\)</span> (攪乱項の分散) は既知の定数として扱われる.</li>
</ul>
<p>実際には, 通常これらのパラメータは事前に分かっていないため,
データより推定する必要がある. 最尤推定やベイズ推定により求めることができる.</p>
<ul>
<li>cf. <a href="https://kevinkotze.github.io/ts-4-tut/" class="uri">https://kevinkotze.github.io/ts-4-tut/</a></li>
</ul>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="動的線形モデル.html#cb948-1" tabindex="-1"></a><span class="fu">ts.plot</span>(Nile)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile-1.png" width="75%" /></p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="動的線形モデル.html#cb949-1" tabindex="-1"></a><span class="co"># local level model</span></span>
<span id="cb949-2"><a href="動的線形モデル.html#cb949-2" tabindex="-1"></a>NilePoly <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">1468</span>)</span>
<span id="cb949-3"><a href="動的線形モデル.html#cb949-3" tabindex="-1"></a><span class="fu">unlist</span>(NilePoly)</span>
<span id="cb949-4"><a href="動的線形モデル.html#cb949-4" tabindex="-1"></a><span class="co">#&gt;       m0       C0       FF        V       GG        W </span></span>
<span id="cb949-5"><a href="動的線形モデル.html#cb949-5" tabindex="-1"></a><span class="co">#&gt;        0 10000000        1    15100        1     1468</span></span></code></pre></div>
<div id="フィルタリング" class="section level3 unnumbered hasAnchor">
<h3>フィルタリング<a href="動的線形モデル.html#フィルタリング" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>最新の観測値に基づいて, 現在の状態を (“オンライン”で) 推定する.</p>
<ul>
<li>Kalman filterによる, 状態空間ベクトルのフィルター値と, (特異値分解(SVD)に基づいて) 分散共分散行列の計算</li>
</ul>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="動的線形モデル.html#cb950-1" tabindex="-1"></a>NileFilt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, NilePoly)</span>
<span id="cb950-2"><a href="動的線形モデル.html#cb950-2" tabindex="-1"></a><span class="co">#　str(NileFilt, 1)</span></span>
<span id="cb950-3"><a href="動的線形モデル.html#cb950-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(Nile)</span>
<span id="cb950-4"><a href="動的線形モデル.html#cb950-4" tabindex="-1"></a><span class="fu">attach</span>(NileFilt)</span>
<span id="cb950-5"><a href="動的線形モデル.html#cb950-5" tabindex="-1"></a><span class="co">#dlmSvd2var(U.C[[n + 1]], D.C[n + 1, ])</span></span>
<span id="cb950-6"><a href="動的線形モデル.html#cb950-6" tabindex="-1"></a><span class="co"># 特異値分解(SVD)から非負定値行列 (u d^2 u&#39;) 計算</span></span></code></pre></div>
<ul>
<li>S/N比 (<span class="math inline">\(W/V\)</span>), Kalman”ゲイン”を決める重要な要因
<ul>
<li>観測値の変動に対する状態の(事前→事後)更新の感応度合い</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="動的線形モデル.html#cb951-1" tabindex="-1"></a><span class="fu">plot</span>(Nile, <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>),</span>
<span id="cb951-2"><a href="動的線形モデル.html#cb951-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>)</span>
<span id="cb951-3"><a href="動的線形モデル.html#cb951-3" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">755</span>)</span>
<span id="cb951-4"><a href="動的線形モデル.html#cb951-4" tabindex="-1"></a>NileFilt1 <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, mod1)</span>
<span id="cb951-5"><a href="動的線形モデル.html#cb951-5" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(NileFilt1<span class="sc">$</span>m), <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb951-6"><a href="動的線形モデル.html#cb951-6" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">7550</span>)</span>
<span id="cb951-7"><a href="動的線形モデル.html#cb951-7" tabindex="-1"></a>NileFilt2 <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, mod2)</span>
<span id="cb951-8"><a href="動的線形モデル.html#cb951-8" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(NileFilt2<span class="sc">$</span>m), <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb951-9"><a href="動的線形モデル.html#cb951-9" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;filtered,  W/V =&quot;</span>,</span>
<span id="cb951-10"><a href="動的線形モデル.html#cb951-10" tabindex="-1"></a>                       <span class="fu">format</span>(<span class="fu">c</span>(<span class="fu">W</span>(mod1) <span class="sc">/</span> <span class="fu">V</span>(mod1),</span>
<span id="cb951-11"><a href="動的線形モデル.html#cb951-11" tabindex="-1"></a>                                <span class="fu">W</span>(mod2) <span class="sc">/</span> <span class="fu">V</span>(mod2)))))</span>
<span id="cb951-12"><a href="動的線形モデル.html#cb951-12" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> leg,</span>
<span id="cb951-13"><a href="動的線形モデル.html#cb951-13" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb951-14"><a href="動的線形モデル.html#cb951-14" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotdash&quot;</span>),</span>
<span id="cb951-15"><a href="動的線形モデル.html#cb951-15" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_Filter2-1.png" width="75%" /></p>
<p>状態方程式の誤差分散 (dW) の大きさが 755 と 7550 の2つの場合を比較する:</p>
<ul>
<li>dW が大きいほど, 真の状態 (流量の水準) の変動が大きく許容されるモデルとなりフィルター系列 (状態の推定値) もよりデータの急激な変動に追従しやすい</li>
<li>dW が小さいほど, 状態方程式側の変動を小さく仮定しているためフィルター系列は元データよりも滑らかになりやすい</li>
</ul>
</div>
<div id="スムージング-平滑化" class="section level3 unnumbered hasAnchor">
<h3>スムージング (平滑化)<a href="動的線形モデル.html#スムージング-平滑化" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>最新時点までの全観測値を使い, 過去の全時点の状態を (“オフライン”で) 推定する (平滑化推定値の計算)</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="動的線形モデル.html#cb952-1" tabindex="-1"></a>NileSmooth <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(NileFilt)</span>
<span id="cb952-2"><a href="動的線形モデル.html#cb952-2" tabindex="-1"></a><span class="fu">str</span>(NileSmooth, <span class="dv">1</span>)</span>
<span id="cb952-3"><a href="動的線形モデル.html#cb952-3" tabindex="-1"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb952-4"><a href="動的線形モデル.html#cb952-4" tabindex="-1"></a><span class="co">#&gt;  $ s  : Time-Series [1:101] from 1870 to 1970: 1111 1111 1111 1105 1113 ...</span></span>
<span id="cb952-5"><a href="動的線形モデル.html#cb952-5" tabindex="-1"></a><span class="co">#&gt;  $ U.S:List of 101</span></span>
<span id="cb952-6"><a href="動的線形モデル.html#cb952-6" tabindex="-1"></a><span class="co">#&gt;  $ D.S: num [1:101, 1] 74.1 63.5 56.9 53.1 50.9 ...</span></span>
<span id="cb952-7"><a href="動的線形モデル.html#cb952-7" tabindex="-1"></a><span class="fu">attach</span>(NileSmooth)</span></code></pre></div>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="動的線形モデル.html#cb953-1" tabindex="-1"></a><span class="co"># dlmSvd2var() により共分散行列を再構築:</span></span>
<span id="cb953-2"><a href="動的線形モデル.html#cb953-2" tabindex="-1"></a><span class="co"># 各要素を drop() でスカラーに落とす</span></span>
<span id="cb953-3"><a href="動的線形モデル.html#cb953-3" tabindex="-1"></a><span class="co"># U.S, D.S: フィルタ・平滑化結果（状態側）のSVD分解要素</span></span>
<span id="cb953-4"><a href="動的線形モデル.html#cb953-4" tabindex="-1"></a><span class="co"># U.C, D.C は観測側のSVD要素。</span></span>
<span id="cb953-5"><a href="動的線形モデル.html#cb953-5" tabindex="-1"></a><span class="co"># ここでは, 特定の時点 (n+1, n/2+1) の分散を取り出して確認</span></span>
<span id="cb953-6"><a href="動的線形モデル.html#cb953-6" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.S[[n <span class="sc">+</span> <span class="dv">1</span>]], D.S[n <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb953-7"><a href="動的線形モデル.html#cb953-7" tabindex="-1"></a><span class="co">#&gt; [1] 4031.035</span></span>
<span id="cb953-8"><a href="動的線形モデル.html#cb953-8" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.C[[n <span class="sc">+</span> <span class="dv">1</span>]], D.C[n <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb953-9"><a href="動的線形モデル.html#cb953-9" tabindex="-1"></a><span class="co">#&gt; [1] 4031.035</span></span>
<span id="cb953-10"><a href="動的線形モデル.html#cb953-10" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.S[[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>]], D.S[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb953-11"><a href="動的線形モデル.html#cb953-11" tabindex="-1"></a><span class="co">#&gt; [1] 2325.985</span></span>
<span id="cb953-12"><a href="動的線形モデル.html#cb953-12" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.C[[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>]], D.C[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb953-13"><a href="動的線形モデル.html#cb953-13" tabindex="-1"></a><span class="co">#&gt; [1] 4031.035</span></span></code></pre></div>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="動的線形モデル.html#cb954-1" tabindex="-1"></a><span class="co"># 平滑化した状態sの分散をもとに, 95%信頼区間の (半分の) 幅 (hwid)を算出</span></span>
<span id="cb954-2"><a href="動的線形モデル.html#cb954-2" tabindex="-1"></a><span class="co"># qnorm(0.025, lower = FALSE): 片側 (上側) 2.5%点を取得 --&gt; 95%区間に対応</span></span>
<span id="cb954-3"><a href="動的線形モデル.html#cb954-3" tabindex="-1"></a><span class="co"># dlmSvd2var(U.S, D.S) の結果 (unlist()でベクトル化) の平方根 --&gt; 標準偏差</span></span>
<span id="cb954-4"><a href="動的線形モデル.html#cb954-4" tabindex="-1"></a>hwid <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, <span class="at">lower =</span> <span class="cn">FALSE</span>) <span class="sc">*</span></span>
<span id="cb954-5"><a href="動的線形モデル.html#cb954-5" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">unlist</span>(<span class="fu">dlmSvd2var</span>(U.S, D.S)))</span>
<span id="cb954-6"><a href="動的線形モデル.html#cb954-6" tabindex="-1"></a><span class="co"># cbind()により3列からなる行列smooth作成:</span></span>
<span id="cb954-7"><a href="動的線形モデル.html#cb954-7" tabindex="-1"></a><span class="co"># 平滑化推定値(s), 推定値-hwid (下側信頼区間), 推定値+hwid (上側信頼区間)</span></span>
<span id="cb954-8"><a href="動的線形モデル.html#cb954-8" tabindex="-1"></a>smooth <span class="ot">&lt;-</span> <span class="fu">cbind</span>(s, <span class="fu">as.vector</span>(s) <span class="sc">+</span> hwid <span class="sc">%o%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb954-9"><a href="動的線形モデル.html#cb954-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dropFirst</span>(smooth), <span class="at">plot.type =</span> <span class="st">&quot;s&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb954-10"><a href="動的線形モデル.html#cb954-10" tabindex="-1"></a>     <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb954-11"><a href="動的線形モデル.html#cb954-11" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(Nile))</span>
<span id="cb954-12"><a href="動的線形モデル.html#cb954-12" tabindex="-1"></a><span class="fu">lines</span>(Nile, <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb954-13"><a href="動的線形モデル.html#cb954-13" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">2</span>)),</span>
<span id="cb954-14"><a href="動的線形モデル.html#cb954-14" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb954-15"><a href="動的線形モデル.html#cb954-15" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;smoothed level&quot;</span>,</span>
<span id="cb954-16"><a href="動的線形モデル.html#cb954-16" tabindex="-1"></a>       <span class="st">&quot;95% probability limits&quot;</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-3-1.png" width="75%" /></p>
</div>
<div id="状態予測" class="section level3 unnumbered hasAnchor">
<h3>状態予測<a href="動的線形モデル.html#状態予測" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="動的線形モデル.html#cb955-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">window</span>(<span class="fu">cbind</span>(Nile, NileFilt1<span class="sc">$</span>f, NileFilt2<span class="sc">$</span>f),</span>
<span id="cb955-2"><a href="動的線形モデル.html#cb955-2" tabindex="-1"></a>            <span class="at">start =</span> <span class="dv">1880</span>, <span class="at">end =</span> <span class="dv">1920</span>)</span>
<span id="cb955-3"><a href="動的線形モデル.html#cb955-3" tabindex="-1"></a><span class="fu">plot</span>(a[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>,</span>
<span id="cb955-4"><a href="動的線形モデル.html#cb955-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>)</span>
<span id="cb955-5"><a href="動的線形モデル.html#cb955-5" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">2</span>], <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb955-6"><a href="動的線形モデル.html#cb955-6" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">3</span>], <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb955-7"><a href="動的線形モデル.html#cb955-7" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;one-step-ahead forecast,  W/V =&quot;</span>,</span>
<span id="cb955-8"><a href="動的線形モデル.html#cb955-8" tabindex="-1"></a>                       <span class="fu">format</span>(<span class="fu">c</span>(<span class="fu">W</span>(mod1) <span class="sc">/</span> <span class="fu">V</span>(mod1),</span>
<span id="cb955-9"><a href="動的線形モデル.html#cb955-9" tabindex="-1"></a>                                <span class="fu">W</span>(mod2) <span class="sc">/</span> <span class="fu">V</span>(mod2)))))</span>
<span id="cb955-10"><a href="動的線形モデル.html#cb955-10" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> leg,</span>
<span id="cb955-11"><a href="動的線形モデル.html#cb955-11" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb955-12"><a href="動的線形モデル.html#cb955-12" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotdash&quot;</span>),</span>
<span id="cb955-13"><a href="動的線形モデル.html#cb955-13" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_forecast-1.png" width="75%" /></p>
<p>つぎの2つのモデルを比較する.</p>
<ul>
<li>mod0: 通常のローカルレベルモデル</li>
<li>modDam: 1898–1899年にダム建設によって変動が増大した (あるいは別の構造変化があった) ことを想定したモデル</li>
</ul>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="動的線形モデル.html#cb956-1" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">1468</span>)</span>
<span id="cb956-2"><a href="動的線形モデル.html#cb956-2" tabindex="-1"></a><span class="co"># ローカルレベルモデル (order=1) を生成</span></span>
<span id="cb956-3"><a href="動的線形モデル.html#cb956-3" tabindex="-1"></a><span class="co"># dV = 観測誤差の分散, dW = 状態方程式誤差の分散</span></span>
<span id="cb956-4"><a href="動的線形モデル.html#cb956-4" tabindex="-1"></a></span>
<span id="cb956-5"><a href="動的線形モデル.html#cb956-5" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">matrix</span>(mod0<span class="sc">$</span>W, <span class="at">nc =</span> <span class="dv">1</span>, <span class="at">nr =</span> <span class="fu">length</span>(Nile)),</span>
<span id="cb956-6"><a href="動的線形モデル.html#cb956-6" tabindex="-1"></a>        <span class="at">start =</span> <span class="fu">start</span>(Nile))</span>
<span id="cb956-7"><a href="動的線形モデル.html#cb956-7" tabindex="-1"></a><span class="co"># 1列だけの行列 mod0$W を</span></span>
<span id="cb956-8"><a href="動的線形モデル.html#cb956-8" tabindex="-1"></a><span class="co"># Nile と同じ長さ・開始時点を持つ時系列 X に変換</span></span>
<span id="cb956-9"><a href="動的線形モデル.html#cb956-9" tabindex="-1"></a></span>
<span id="cb956-10"><a href="動的線形モデル.html#cb956-10" tabindex="-1"></a><span class="fu">window</span>(X, <span class="dv">1898</span>, <span class="dv">1899</span>) <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">*</span> mod0<span class="sc">$</span>W</span>
<span id="cb956-11"><a href="動的線形モデル.html#cb956-11" tabindex="-1"></a><span class="co"># 1898--1899年のプロセス分散（状態方程式誤差）を12倍</span></span>
<span id="cb956-12"><a href="動的線形モデル.html#cb956-12" tabindex="-1"></a><span class="co"># -&gt; この期間に大きな構造変化があるとみなし, 変動が増す設定</span></span></code></pre></div>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="動的線形モデル.html#cb957-1" tabindex="-1"></a>modDam <span class="ot">&lt;-</span> mod0</span>
<span id="cb957-2"><a href="動的線形モデル.html#cb957-2" tabindex="-1"></a>modDam<span class="sc">$</span>X <span class="ot">&lt;-</span> X</span>
<span id="cb957-3"><a href="動的線形モデル.html#cb957-3" tabindex="-1"></a>modDam<span class="sc">$</span>JW <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb957-4"><a href="動的線形モデル.html#cb957-4" tabindex="-1"></a><span class="co"># modDam: &quot;Dam model&quot; として、</span></span>
<span id="cb957-5"><a href="動的線形モデル.html#cb957-5" tabindex="-1"></a><span class="co"># 上で作成した時系列 X (時間変化する分散) を組み込む</span></span>
<span id="cb957-6"><a href="動的線形モデル.html#cb957-6" tabindex="-1"></a><span class="co"># JWは状態方程式側の分散を X で置き換えるために設定する行列</span></span>
<span id="cb957-7"><a href="動的線形モデル.html#cb957-7" tabindex="-1"></a></span>
<span id="cb957-8"><a href="動的線形モデル.html#cb957-8" tabindex="-1"></a>damFilt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, modDam)</span>
<span id="cb957-9"><a href="動的線形モデル.html#cb957-9" tabindex="-1"></a>mod0Filt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, mod0)</span>
<span id="cb957-10"><a href="動的線形モデル.html#cb957-10" tabindex="-1"></a><span class="co"># Nileデータに対してフィルタリングを実行</span></span>
<span id="cb957-11"><a href="動的線形モデル.html#cb957-11" tabindex="-1"></a><span class="co"># damFilt: ダム建設による影響を考慮したモデル</span></span>
<span id="cb957-12"><a href="動的線形モデル.html#cb957-12" tabindex="-1"></a><span class="co"># mod0Filt: 通常のローカルレベルモデル</span></span></code></pre></div>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="動的線形モデル.html#cb958-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">window</span>(<span class="fu">cbind</span>(Nile, mod0Filt<span class="sc">$</span>f, damFilt<span class="sc">$</span>f),</span>
<span id="cb958-2"><a href="動的線形モデル.html#cb958-2" tabindex="-1"></a>            <span class="at">start =</span> <span class="dv">1880</span>, <span class="at">end =</span> <span class="dv">1920</span>)</span>
<span id="cb958-3"><a href="動的線形モデル.html#cb958-3" tabindex="-1"></a><span class="co"># Nile実測値, mod0(通常モデル)の1ステップ先予測</span></span>
<span id="cb958-4"><a href="動的線形モデル.html#cb958-4" tabindex="-1"></a><span class="co"># modDam(ダム有りモデル)の1ステップ先予測</span></span>
<span id="cb958-5"><a href="動的線形モデル.html#cb958-5" tabindex="-1"></a><span class="co"># を時系列 a としてまとめ, 可視化のため 1880~1920年に切り出す</span></span>
<span id="cb958-6"><a href="動的線形モデル.html#cb958-6" tabindex="-1"></a></span>
<span id="cb958-7"><a href="動的線形モデル.html#cb958-7" tabindex="-1"></a><span class="fu">plot</span>(a[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>,</span>
<span id="cb958-8"><a href="動的線形モデル.html#cb958-8" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>)</span>
<span id="cb958-9"><a href="動的線形モデル.html#cb958-9" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">2</span>], <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb958-10"><a href="動的線形モデル.html#cb958-10" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">3</span>], <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb958-11"><a href="動的線形モデル.html#cb958-11" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1898</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb958-12"><a href="動的線形モデル.html#cb958-12" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;one-step-ahead forecast -&quot;</span>,</span>
<span id="cb958-13"><a href="動的線形モデル.html#cb958-13" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">&quot;mod0&quot;</span>, <span class="st">&quot;modDam&quot;</span>)))</span>
<span id="cb958-14"><a href="動的線形モデル.html#cb958-14" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> leg,</span>
<span id="cb958-15"><a href="動的線形モデル.html#cb958-15" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb958-16"><a href="動的線形モデル.html#cb958-16" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotdash&quot;</span>),</span>
<span id="cb958-17"><a href="動的線形モデル.html#cb958-17" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-6-1.png" width="75%" /></p>
</div>
<div id="モデル診断-1" class="section level3 unnumbered hasAnchor">
<h3>モデル診断<a href="動的線形モデル.html#モデル診断-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="動的線形モデル.html#cb959-1" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(damFilt, <span class="at">sd =</span> <span class="cn">FALSE</span>))</span>
<span id="cb959-2"><a href="動的線形モデル.html#cb959-2" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(damFilt, <span class="at">sd =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_diag-1.png" width="75%" /></p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="動的線形モデル.html#cb960-1" tabindex="-1"></a><span class="fu">tsdiag</span>(damFilt)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_diag-2.png" width="75%" /></p>
</div>
<div id="モデルパラメータの推定" class="section level3 unnumbered hasAnchor">
<h3>モデル・パラメータの推定<a href="動的線形モデル.html#モデルパラメータの推定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>未知のモデル・パラメータ, 例えば,
<code>dlmModPoly()</code> が生成するローカルレベルモデル（あるいはローカルトレンドモデルなど）においては,</p>
<ul>
<li>dV = 観測方程式のノイズ（観測誤差）の分散</li>
<li>dW = 状態方程式のノイズ（状態・トレンドの変動）の分散
を事前に指定する必要がある.</li>
</ul>
<p>これらは, データから最尤推定 (MLE) やベイズ推定により推定することができる.
詳細は, PPC, Ch.4を参照のこと.</p>
<p>具体的には, <strong>dlm</strong>には最尤推定を行うための関数<code>dlmMLE()</code>が用意されている.</p>
<pre><code>dlmMLE(): モデルパラメータの最尤推定</code></pre>
<p>ここでは, ナイルデータに対して, ローカルレベルモデルを仮定し, MLEを使用してdV, dWの最尤推定値を計算する.</p>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb962-1"><a href="動的線形モデル.html#cb962-1" tabindex="-1"></a><span class="co"># p.145</span></span>
<span id="cb962-2"><a href="動的線形モデル.html#cb962-2" tabindex="-1"></a>buildFun <span class="ot">&lt;-</span> <span class="cf">function</span>(parm) {</span>
<span id="cb962-3"><a href="動的線形モデル.html#cb962-3" tabindex="-1"></a>    <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, </span>
<span id="cb962-4"><a href="動的線形モデル.html#cb962-4" tabindex="-1"></a>               <span class="at">dV =</span> <span class="fu">exp</span>(parm[<span class="dv">1</span>]), </span>
<span id="cb962-5"><a href="動的線形モデル.html#cb962-5" tabindex="-1"></a>               <span class="at">dW =</span> <span class="fu">exp</span>(parm[<span class="dv">2</span>]))</span>
<span id="cb962-6"><a href="動的線形モデル.html#cb962-6" tabindex="-1"></a>}</span>
<span id="cb962-7"><a href="動的線形モデル.html#cb962-7" tabindex="-1"></a></span>
<span id="cb962-8"><a href="動的線形モデル.html#cb962-8" tabindex="-1"></a><span class="co"># 初期値を適当に設定して最尤推定</span></span>
<span id="cb962-9"><a href="動的線形モデル.html#cb962-9" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">dlmMLE</span>(Nile, <span class="at">parm =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1000</span>), <span class="fu">log</span>(<span class="dv">1000</span>)), <span class="at">build =</span> buildFun)</span>
<span id="cb962-10"><a href="動的線形モデル.html#cb962-10" tabindex="-1"></a>fit<span class="sc">$</span>conv       <span class="co"># 0 なら収束</span></span>
<span id="cb962-11"><a href="動的線形モデル.html#cb962-11" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb962-12"><a href="動的線形モデル.html#cb962-12" tabindex="-1"></a>fit<span class="sc">$</span>par        <span class="co"># 推定された log(dV), log(dW)</span></span>
<span id="cb962-13"><a href="動的線形モデル.html#cb962-13" tabindex="-1"></a><span class="co">#&gt; [1] 9.622441 7.291932</span></span>
<span id="cb962-14"><a href="動的線形モデル.html#cb962-14" tabindex="-1"></a><span class="fu">exp</span>(fit<span class="sc">$</span>par)   <span class="co"># dV, dW の推定値</span></span>
<span id="cb962-15"><a href="動的線形モデル.html#cb962-15" tabindex="-1"></a><span class="co">#&gt; [1] 15099.857  1468.404</span></span></code></pre></div>
<!-- ~~なお, 未知パラメータのベイズ推定には, **rstan**等の別のパッケージを利用する必要がある.~~
-->
<p>より複雑なDLMに対しても, 上記<code>buidFun()</code>に対応する
自作関数を用意すれば, それを<code>dlmMLE()</code>の引数<code>build</code>に
与えることで未知パラメータの最尤推定ができる.
ただし, この自作関数を適切に作成するには, ある程度
この<strong>dlm</strong>に慣れておく必要がある.</p>
</div>
</div>
<div id="local-level-plus-seasonal-componentモデル" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> local level plus seasonal componentモデル<a href="動的線形モデル.html#local-level-plus-seasonal-componentモデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>次に, 局所水準モデル (ランダムウォーク+ノイズ) に (独立な)
季節性成分が加わったDLMを取り上げる.</p>
<p>データ2: 英国における耐久消費財の消費支出 (四半期ベース), 1957Q1–1967Q4, <em>Time Series Data Library</em>: <a href="https://robjhyndman.com/tsdl/" class="uri">https://robjhyndman.com/tsdl/</a>)</p>
<ul>
<li>出所: Petris, etal (2009), p.64–</li>
</ul>
<!-- 季節性成分を含む時系列に対するDLMの例を取り上げる. -->
<pre><code>- qconsum.dat
  - quarterly consumer expenditure
  - durable goods
  - all other goods and services
  - investment
  - inventory investment
  - imports of goods and services
  - gross domestic product
  - personal disposable income
- Source: (Hyndman (n.d.)</code></pre>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="動的線形モデル.html#cb964-1" tabindex="-1"></a>ifl <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_PPC, <span class="st">&quot;qconsum.dat&quot;</span>)</span>
<span id="cb964-2"><a href="動的線形モデル.html#cb964-2" tabindex="-1"></a>expd <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">read.table</span>(ifl, <span class="at">skip =</span> <span class="dv">4</span>,</span>
<span id="cb964-3"><a href="動的線形モデル.html#cb964-3" tabindex="-1"></a>                      <span class="at">colClasses =</span> <span class="st">&quot;numeric&quot;</span>)[, <span class="dv">1</span>],</span>
<span id="cb964-4"><a href="動的線形モデル.html#cb964-4" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1957</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb964-5"><a href="動的線形モデル.html#cb964-5" tabindex="-1"></a>expd.dlm <span class="ot">&lt;-</span> <span class="fu">dlm</span>(<span class="at">m0 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="at">C0 =</span> <span class="fl">1e8</span> <span class="sc">*</span> <span class="fu">diag</span>(<span class="dv">4</span>),</span>
<span id="cb964-6"><a href="動的線形モデル.html#cb964-6" tabindex="-1"></a>                <span class="at">FF =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nr =</span> <span class="dv">1</span>),</span>
<span id="cb964-7"><a href="動的線形モデル.html#cb964-7" tabindex="-1"></a>                <span class="at">V =</span> <span class="fl">1e-3</span>,</span>
<span id="cb964-8"><a href="動的線形モデル.html#cb964-8" tabindex="-1"></a>                <span class="at">GG =</span> <span class="fu">bdiag</span>(<span class="fu">matrix</span>(<span class="dv">1</span>),</span>
<span id="cb964-9"><a href="動的線形モデル.html#cb964-9" tabindex="-1"></a>                <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb964-10"><a href="動的線形モデル.html#cb964-10" tabindex="-1"></a>                       <span class="at">nr =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb964-11"><a href="動的線形モデル.html#cb964-11" tabindex="-1"></a>                <span class="at">W =</span> <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fl">771.35</span>, <span class="fl">86.48</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nr =</span> <span class="dv">4</span>))</span>
<span id="cb964-12"><a href="動的線形モデル.html#cb964-12" tabindex="-1"></a><span class="fu">plot</span>(expd, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Expenditures&quot;</span>, <span class="at">type =</span> <span class="st">&#39;o&#39;</span>,</span>
<span id="cb964-13"><a href="動的線形モデル.html#cb964-13" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb964-14"><a href="動的線形モデル.html#cb964-14" tabindex="-1"></a><span class="do">### Filter</span></span>
<span id="cb964-15"><a href="動的線形モデル.html#cb964-15" tabindex="-1"></a>expdFilt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(expd, expd.dlm)</span>
<span id="cb964-16"><a href="動的線形モデル.html#cb964-16" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(expdFilt<span class="sc">$</span>m[, <span class="dv">1</span>]), <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb964-17"><a href="動的線形モデル.html#cb964-17" tabindex="-1"></a><span class="do">### Smooth</span></span>
<span id="cb964-18"><a href="動的線形モデル.html#cb964-18" tabindex="-1"></a>expdSmooth <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(expdFilt)</span>
<span id="cb964-19"><a href="動的線形モデル.html#cb964-19" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(expdSmooth<span class="sc">$</span>s[,<span class="dv">1</span>]), <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb964-20"><a href="動的線形モデル.html#cb964-20" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">2</span>)),</span>
<span id="cb964-21"><a href="動的線形モデル.html#cb964-21" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;dotdash&quot;</span>, <span class="st">&quot;longdash&quot;</span>),</span>
<span id="cb964-22"><a href="動的線形モデル.html#cb964-22" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb964-23"><a href="動的線形モデル.html#cb964-23" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;filtered level&quot;</span>, <span class="st">&quot;smoothed level&quot;</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/qconsum-1.png" width="75%" /></p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="動的線形モデル.html#cb965-1" tabindex="-1"></a><span class="do">### Seasonal component</span></span>
<span id="cb965-2"><a href="動的線形モデル.html#cb965-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dropFirst</span>(expdSmooth<span class="sc">$</span>s[, <span class="dv">3</span>]), <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb965-3"><a href="動的線形モデル.html#cb965-3" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Expenditure - Seasonal component&quot;</span>)</span>
<span id="cb965-4"><a href="動的線形モデル.html#cb965-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/qconsum-2.png" width="75%" />
<!-- 注(9/3/22): plotとlineはchunkまたがるとエラーになる!? --></p>
<div id="状態予測-1" class="section level3 unnumbered hasAnchor">
<h3>状態予測<a href="動的線形モデル.html#状態予測-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="動的線形モデル.html#cb966-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb966-2"><a href="動的線形モデル.html#cb966-2" tabindex="-1"></a>expdFore <span class="ot">&lt;-</span> <span class="fu">dlmForecast</span>(expdFilt, <span class="at">nAhead =</span> <span class="dv">12</span>, <span class="at">sampleNew =</span> <span class="dv">10</span>)</span>
<span id="cb966-3"><a href="動的線形モデル.html#cb966-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">window</span>(expd, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1964</span>, <span class="dv">1</span>)), <span class="at">type =</span> <span class="st">&#39;o&#39;</span>,</span>
<span id="cb966-4"><a href="動的線形モデル.html#cb966-4" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1964</span>, <span class="dv">1971</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">350</span>, <span class="dv">850</span>),</span>
<span id="cb966-5"><a href="動的線形モデル.html#cb966-5" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Expenditures&quot;</span>)</span>
<span id="cb966-6"><a href="動的線形モデル.html#cb966-6" tabindex="-1"></a><span class="fu">names</span>(expdFore)</span>
<span id="cb966-7"><a href="動的線形モデル.html#cb966-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a&quot;         &quot;R&quot;         &quot;f&quot;         &quot;Q&quot;         &quot;newStates&quot; &quot;newObs&quot;</span></span>
<span id="cb966-8"><a href="動的線形モデル.html#cb966-8" tabindex="-1"></a><span class="fu">attach</span>(expdFore)</span>
<span id="cb966-9"><a href="動的線形モデル.html#cb966-9" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(newObs, <span class="cf">function</span>(x)</span>
<span id="cb966-10"><a href="動的線形モデル.html#cb966-10" tabindex="-1"></a>                 <span class="fu">lines</span>(x, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>,</span>
<span id="cb966-11"><a href="動的線形モデル.html#cb966-11" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">pch =</span> <span class="dv">4</span>)))</span>
<span id="cb966-12"><a href="動的線形モデル.html#cb966-12" tabindex="-1"></a><span class="fu">lines</span>(f, <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb966-13"><a href="動的線形モデル.html#cb966-13" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fu">time</span>(f)[<span class="dv">1</span>], <span class="fu">time</span>(expd)[<span class="fu">length</span>(expd)])),</span>
<span id="cb966-14"><a href="動的線形モデル.html#cb966-14" tabindex="-1"></a>       <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/qconsum_forecast-1.png" width="75%" /></p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="動的線形モデル.html#cb967-1" tabindex="-1"></a><span class="fu">detach</span>()</span></code></pre></div>
<!---
- その他
  - 未知パラメータの推定(特に, $V,W$)は, dlmMLE()関数により最尤推定が可能
  - 代替法. ベイズ推定
  - 詳細は, Petris, et al.   (2009), Ch.4を参照のこと
--->
</div>
</div>
<div id="動的回帰モデル" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> 動的回帰モデル<a href="動的線形モデル.html#動的回帰モデル" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>1変量の目的変数<span class="math inline">\(Y_t\)</span>に対して,
<span class="math inline">\(p\)</span>個の説明変数<span class="math inline">\(x_t=[x_{1,t} \, \cdots x_{p,t}]&#39;\)</span>が
時間と共に動的に変化する回帰モデルは以下のようにDLM表現可能である:
<span class="math display">\[
\begin{align}
Y_t &amp;=  F \theta_t + v_t, \quad v_t \sim_{i.i.d.} N(0,V_t),\label{eq:Y} \\
\theta_{t} &amp;= G \theta_{t-1} + w_{t}, \quad w_{t} \sim_{i.i.d.} N(0,W_t), \label{eq:mu}
\end{align}
\]</span>
ここで, 回帰的係数<span class="math inline">\(\theta_t = [\theta_{0,t} \,\theta_{1,t} \, \cdots \theta_{p,t}]&#39;\)</span>, (<span class="math inline">\(\theta_{0,t}\)</span>は切片項) が動的に変化する状態変数, また,
観測方程式の係数行列<span class="math inline">\(F = [1 \, x_t], V_t = \sigma_t^2\)</span>である. 一方, 状態推移を記述する状態方程式の係数行列<span class="math inline">\(G\)</span>は, 単位行列<span class="math inline">\({\bf I}_{(p+1) \times (p+1)}\)</span>,
撹乱項<span class="math inline">\(w_t\)</span>の分散共分散行列<span class="math inline">\(W_t\)</span>は対角行列に設定されることが多い. この設定は,
各成分<span class="math inline">\(theta_i\)</span>が互いに独立なランダムウォークに従って推移すると仮定することを意味する.</p>
<p>DLMでは<span class="math inline">\(F,G,V_t,W_t\)</span>は既知であると想定する.
特に, <span class="math inline">\(V_t,W_t\)</span>に関して未知である場合には, データより推定する必要がある.</p>
<p>線形回帰モデルの具体例として,
<span class="math inline">\(Y_t\)</span>をIBM, <span class="math inline">\(X_t\)</span>をMarketの月次超過リターンにおいて,
静的, 動的2種類のCAPMモデルを推定する.</p>
<pre><code>データ3: 米国株式月次収益率
- 1978.1--1987.12, 月次
- Mobile, IBM, Weyer, Citicorp, Market (NY+アメリカン全上場株式の時価加重), 30日T-Bill(無リスク金利)
- 注) 1999年, ExxonとMobile合併 --&gt; Exxon Mobile (XOM)</code></pre>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="動的線形モデル.html#cb969-1" tabindex="-1"></a>ifl <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_PPC, <span class="st">&quot;P.dat&quot;</span>)</span>
<span id="cb969-2"><a href="動的線形モデル.html#cb969-2" tabindex="-1"></a>capm <span class="ot">&lt;-</span> <span class="fu">read.table</span>(ifl, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb969-3"><a href="動的線形モデル.html#cb969-3" tabindex="-1"></a>capm.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(capm, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1978</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb969-4"><a href="動的線形モデル.html#cb969-4" tabindex="-1"></a><span class="fu">colnames</span>(capm)</span>
<span id="cb969-5"><a href="動的線形モデル.html#cb969-5" tabindex="-1"></a><span class="co">#&gt; [1] &quot;MOBIL&quot;  &quot;IBM&quot;    &quot;WEYER&quot;  &quot;CITCRP&quot; &quot;MARKET&quot; &quot;RKFREE&quot;</span></span>
<span id="cb969-6"><a href="動的線形モデル.html#cb969-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb969-7"><a href="動的線形モデル.html#cb969-7" tabindex="-1"></a><span class="fu">require</span>(zoo)</span>
<span id="cb969-8"><a href="動的線形モデル.html#cb969-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.zoo</span>(capm.ts), <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">0.7</span>,</span>
<span id="cb969-9"><a href="動的線形モデル.html#cb969-9" tabindex="-1"></a>     <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">4.1</span>, <span class="dv">0</span>, <span class="fl">1.1</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-8-1.png" width="75%" /></p>
<p>回帰に先立ち, あらかじめ月次リターン系列から無リスク金利を控除し
IBM, Market, それぞれの超過リターンを計算しておく.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="動的線形モデル.html#cb970-1" tabindex="-1"></a><span class="co"># 以下, 1変量 (IBM) に絞って実行</span></span>
<span id="cb970-2"><a href="動的線形モデル.html#cb970-2" tabindex="-1"></a>IBM <span class="ot">&lt;-</span> capm.ts[, <span class="st">&quot;IBM&quot;</span>] <span class="sc">-</span> capm.ts[, <span class="st">&quot;RKFREE&quot;</span>]</span>
<span id="cb970-3"><a href="動的線形モデル.html#cb970-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> capm.ts[, <span class="st">&quot;MARKET&quot;</span>] <span class="sc">-</span> capm.ts[, <span class="st">&quot;RKFREE&quot;</span>]</span>
<span id="cb970-4"><a href="動的線形モデル.html#cb970-4" tabindex="-1"></a>outLM <span class="ot">&lt;-</span> <span class="fu">lm</span>(IBM <span class="sc">~</span> x)</span>
<span id="cb970-5"><a href="動的線形モデル.html#cb970-5" tabindex="-1"></a>outLM<span class="sc">$</span>coef</span>
<span id="cb970-6"><a href="動的線形モデル.html#cb970-6" tabindex="-1"></a><span class="co">#&gt;   (Intercept)             x </span></span>
<span id="cb970-7"><a href="動的線形モデル.html#cb970-7" tabindex="-1"></a><span class="co">#&gt; -0.0004895937  0.4568207721</span></span>
<span id="cb970-8"><a href="動的線形モデル.html#cb970-8" tabindex="-1"></a><span class="fu">summary</span>(outLM)</span>
<span id="cb970-9"><a href="動的線形モデル.html#cb970-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb970-10"><a href="動的線形モデル.html#cb970-10" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb970-11"><a href="動的線形モデル.html#cb970-11" tabindex="-1"></a><span class="co">#&gt; lm(formula = IBM ~ x)</span></span>
<span id="cb970-12"><a href="動的線形モデル.html#cb970-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb970-13"><a href="動的線形モデル.html#cb970-13" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb970-14"><a href="動的線形モデル.html#cb970-14" tabindex="-1"></a><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span id="cb970-15"><a href="動的線形モデル.html#cb970-15" tabindex="-1"></a><span class="co">#&gt; -0.11850 -0.03327 -0.00263  0.03332  0.15042 </span></span>
<span id="cb970-16"><a href="動的線形モデル.html#cb970-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb970-17"><a href="動的線形モデル.html#cb970-17" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb970-18"><a href="動的線形モデル.html#cb970-18" tabindex="-1"></a><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb970-19"><a href="動的線形モデル.html#cb970-19" tabindex="-1"></a><span class="co">#&gt; (Intercept) -0.0004896  0.0046400  -0.106    0.916    </span></span>
<span id="cb970-20"><a href="動的線形モデル.html#cb970-20" tabindex="-1"></a><span class="co">#&gt; x            0.4568208  0.0675477   6.763 5.49e-10 ***</span></span>
<span id="cb970-21"><a href="動的線形モデル.html#cb970-21" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb970-22"><a href="動的線形モデル.html#cb970-22" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb970-23"><a href="動的線形モデル.html#cb970-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb970-24"><a href="動的線形モデル.html#cb970-24" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 0.05055 on 118 degrees of freedom</span></span>
<span id="cb970-25"><a href="動的線形モデル.html#cb970-25" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.2793, Adjusted R-squared:  0.2732 </span></span>
<span id="cb970-26"><a href="動的線形モデル.html#cb970-26" tabindex="-1"></a><span class="co">#&gt; F-statistic: 45.74 on 1 and 118 DF,  p-value: 5.489e-10</span></span>
<span id="cb970-27"><a href="動的線形モデル.html#cb970-27" tabindex="-1"></a><span class="fu">acf</span>(outLM<span class="sc">$</span>res)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-9-1.png" width="75%" /></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="動的線形モデル.html#cb971-1" tabindex="-1"></a><span class="fu">qqnorm</span>(outLM<span class="sc">$</span>res)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-9-2.png" width="75%" /></p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="動的線形モデル.html#cb972-1" tabindex="-1"></a></span>
<span id="cb972-2"><a href="動的線形モデル.html#cb972-2" tabindex="-1"></a><span class="co"># 以下, 追加</span></span>
<span id="cb972-3"><a href="動的線形モデル.html#cb972-3" tabindex="-1"></a><span class="fu">summary</span>(outLM)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb972-4"><a href="動的線形モデル.html#cb972-4" tabindex="-1"></a><span class="co">#&gt; [1] 0.002555574</span></span>
<span id="cb972-5"><a href="動的線形モデル.html#cb972-5" tabindex="-1"></a><span class="co"># --&gt; 0.002555574</span></span>
<span id="cb972-6"><a href="動的線形モデル.html#cb972-6" tabindex="-1"></a><span class="co"># --&gt; 教科書では, dV=0.00254と設定</span></span></code></pre></div>
<div id="静的capm" class="section level4 unnumbered hasAnchor">
<h4>静的CAPM<a href="動的線形モデル.html#静的capm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>通常の線形回帰モデル
<span class="math display">\[
Y_t = \alpha + \beta x_t + v_t, \quad v_t \sim_{i.i.d.} N(0,\sigma^2), \\
\]</span>
は,上記回帰モデルのDLM表現(<span class="math inline">\(\ref{eq:Y}\)</span>,<span class="math inline">\(\ref{eq:mu}\)</span>)において,
回帰係数が時間不変の特殊な場合に位置付けられるすなわち,</p>
<ul>
<li><span class="math inline">\(F_t = [1 \  x_t]\)</span></li>
<li><span class="math inline">\(\theta_t = [\alpha \ \beta]&#39;\)</span></li>
<li><span class="math inline">\(V = \sigma^2\)</span>,</li>
<li><span class="math inline">\(W_t = {\bf 0}_{2 \times 2}\)</span></li>
</ul>
<p>さらに, Bayes推論を行うための事前分布 (平均<span class="math inline">\(m_0\)</span>, 分散共分散行列<span class="math inline">\(C_0\)</span>) を与える.</p>
<ul>
<li><span class="math inline">\([\alpha \ \beta] \sim N(m_0, C_0)\)</span></li>
</ul>
<p>パッケージ<strong>dlm</strong>では, <code>dlmModReg()</code>を使用して, モデルを特定化する.</p>
<p><span class="math inline">\(V,W\)</span>は, 引数<code>dV</code>, <code>dW</code>として与える. 以下のコードでは,
<code>dW=0</code> (デフォルト. <span class="math inline">\(diag(W)=(0,0)\)</span>に対応), <code>dV=0.00254</code>とおいている.
一方, 状態変数<span class="math inline">\([\alpha \ \beta]\)</span>の事前平均および事前分散共分散行列は
<code>m0=c(0,1.5)</code>, <code>C0=diag(c(1e+0.7, 1))</code>と設定している.</p>
<p>これは, <span class="math inline">\(\alpha\)</span>には”vague prior”,
<span class="math inline">\(\beta\)</span>にはN(1.5,1)を指定していることを表す
(1.5→“aggressive investment”, 1→“fairly small variance”).</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="動的線形モデル.html#cb973-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">dlmModReg</span>(x, <span class="at">dV =</span> <span class="fl">0.00254</span>, <span class="at">m0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb973-2"><a href="動的線形モデル.html#cb973-2" tabindex="-1"></a>                 <span class="at">C0 =</span> <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fl">1e+07</span>, <span class="dv">1</span>)))</span>
<span id="cb973-3"><a href="動的線形モデル.html#cb973-3" tabindex="-1"></a><span class="co"># Kalmanフィルター適用</span></span>
<span id="cb973-4"><a href="動的線形モデル.html#cb973-4" tabindex="-1"></a>outF <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(IBM, mod)</span>
<span id="cb973-5"><a href="動的線形モデル.html#cb973-5" tabindex="-1"></a><span class="co"># 状態変数 (theta) のフィルター値</span></span>
<span id="cb973-6"><a href="動的線形モデル.html#cb973-6" tabindex="-1"></a>outF<span class="sc">$</span>m[<span class="dv">1</span> <span class="sc">+</span> <span class="fu">length</span>(IBM), ]</span>
<span id="cb973-7"><a href="動的線形モデル.html#cb973-7" tabindex="-1"></a><span class="co">#&gt; [1] -0.0005232801  0.4615301204</span></span></code></pre></div>
</div>
<div id="動的capm" class="section level4 unnumbered hasAnchor">
<h4>動的CAPM<a href="動的線形モデル.html#動的capm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>次に, 回帰係数が動的に変化する回帰モデルを扱う.</p>
<ul>
<li>回帰係数がランダムウォークするモデル</li>
</ul>
<p><span class="math display">\[
\begin{align}
Y_t &amp;= \alpha_t + \beta_t x_t + v_t, \quad v_t \sim_{i.i.d.} N(0,\sigma^2), \\
\alpha_{t} &amp;= \alpha_{t-1} + w_{1,t}, \quad w_{1,t} \sim_{i.i.d.} N(0,\sigma_{w_1}^2), \\
\beta_{t} &amp;= \beta_{t-1} + w_{2,t}, \quad w_{2,t} \sim_{i.i.d.} N(0,\sigma_{w_2}^2), \\
\end{align}
\]</span></p>
<p>ここでは, 状態変数<span class="math inline">\(\theta_t = (\alpha_t, \beta_t)\)</span>がそれぞれランダムウォークし
動的に変化している.</p>
<p>最尤推定 (MLE) により, 観測方程式&amp;状態方程式の分散 (V,W) を推定する.
それに先立ち, dlmMLE()に渡す関数を定義する
(引数<code>u</code>は推定対象パラメータを格納する数値ベクトル–ここでは3次元.
<code>u</code>を渡すとDLM (<strong>dlm</strong>クラスオブジェクト) を返す).</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="動的線形モデル.html#cb974-1" tabindex="-1"></a>buildCapm <span class="ot">&lt;-</span> <span class="cf">function</span>(u) {</span>
<span id="cb974-2"><a href="動的線形モデル.html#cb974-2" tabindex="-1"></a>    <span class="fu">dlmModReg</span>(x, <span class="at">dV =</span> <span class="fu">exp</span>(u[<span class="dv">1</span>]), <span class="at">dW =</span> <span class="fu">exp</span>(u[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]))</span>
<span id="cb974-3"><a href="動的線形モデル.html#cb974-3" tabindex="-1"></a>}</span>
<span id="cb974-4"><a href="動的線形モデル.html#cb974-4" tabindex="-1"></a><span class="co"># 注) dV, dWは分散なので非負</span></span>
<span id="cb974-5"><a href="動的線形モデル.html#cb974-5" tabindex="-1"></a><span class="co"># dlmMLE():</span></span>
<span id="cb974-6"><a href="動的線形モデル.html#cb974-6" tabindex="-1"></a><span class="co"># 状態空間モデルの特定化における未知パラメータのMLEを返す関数</span></span>
<span id="cb974-7"><a href="動的線形モデル.html#cb974-7" tabindex="-1"></a><span class="co"># (内部で最適化計算を行うoptim()を呼び出して計算)</span></span>
<span id="cb974-8"><a href="動的線形モデル.html#cb974-8" tabindex="-1"></a><span class="co"># parm: 初期パラメータ</span></span>
<span id="cb974-9"><a href="動的線形モデル.html#cb974-9" tabindex="-1"></a>outMLE <span class="ot">&lt;-</span> <span class="fu">dlmMLE</span>(IBM, <span class="at">parm =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="at">build =</span> buildCapm)</span>
<span id="cb974-10"><a href="動的線形モデル.html#cb974-10" tabindex="-1"></a><span class="co"># V,WのMLE</span></span>
<span id="cb974-11"><a href="動的線形モデル.html#cb974-11" tabindex="-1"></a><span class="fu">exp</span>(outMLE<span class="sc">$</span>par)</span>
<span id="cb974-12"><a href="動的線形モデル.html#cb974-12" tabindex="-1"></a><span class="co">#&gt; [1] 2.328401e-03 1.100131e-05 6.496219e-04</span></span>
<span id="cb974-13"><a href="動的線形モデル.html#cb974-13" tabindex="-1"></a><span class="co"># 最適化計算に呼び出されたoptim()の戻り値</span></span>
<span id="cb974-14"><a href="動的線形モデル.html#cb974-14" tabindex="-1"></a><span class="co"># outMLE$value</span></span>
<span id="cb974-15"><a href="動的線形モデル.html#cb974-15" tabindex="-1"></a></span>
<span id="cb974-16"><a href="動的線形モデル.html#cb974-16" tabindex="-1"></a><span class="co"># MLEを使ってDLMを定義 (特定化)</span></span>
<span id="cb974-17"><a href="動的線形モデル.html#cb974-17" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">buildCapm</span>(outMLE<span class="sc">$</span>par)</span></code></pre></div>
</div>
<div id="スムージング" class="section level3 unnumbered hasAnchor">
<h3>スムージング<a href="動的線形モデル.html#スムージング" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="動的線形モデル.html#cb975-1" tabindex="-1"></a><span class="co"># 状態変数のスムージング推定値 (平滑化推定値)</span></span>
<span id="cb975-2"><a href="動的線形モデル.html#cb975-2" tabindex="-1"></a>outS <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(IBM, mod)</span>
<span id="cb975-3"><a href="動的線形モデル.html#cb975-3" tabindex="-1"></a><span class="co"># require(zoo)</span></span>
<span id="cb975-4"><a href="動的線形モデル.html#cb975-4" tabindex="-1"></a><span class="co"># alpha, betaのスムージング推定値のプロット</span></span>
<span id="cb975-5"><a href="動的線形モデル.html#cb975-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.zoo</span>(<span class="fu">dropFirst</span>(outS<span class="sc">$</span>s)), <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.1</span>, <span class="dv">0</span>, <span class="fl">1.1</span>),</span>
<span id="cb975-6"><a href="動的線形モデル.html#cb975-6" tabindex="-1"></a>     <span class="at">oma =</span> <span class="fu">c</span>(<span class="fl">2.1</span>, <span class="dv">0</span>, .<span class="dv">1</span>, .<span class="dv">1</span>), <span class="at">cex.axis =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-12-1.png" width="75%" /></p>
</div>
</div>
<div id="sur-seemingly-unrelated-regression-モデル-3.3.3" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> SUR (Seemingly Unrelated Regression) モデル (3.3.3)<a href="動的線形モデル.html#sur-seemingly-unrelated-regression-モデル-3.3.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>多変量動的回帰モデルの例を取り上げる.
上記, 米国株式4銘柄 (Mobile, IBM, Weyer, Citicorp) の動的CAPM
(<span class="math inline">\(\beta\)</span>) の同時推定を行う. 説明変数<span class="math inline">\(x_t\)</span>は, 一変量の時と同じく,
Marketの超過リターンである.</p>
<p><span class="math display">\[
\begin{align}
Y_{i,t} &amp;= \alpha_{i,t} + \beta_{i,t} x_t + v_{i,t}, \\
\alpha_{i,t} &amp;= \alpha_{i,t-1} + w_{1i,t}, \\
\beta_{i,t} &amp;= \beta_{i,t-1} + w_{2i,t}, \\
\end{align}
\]</span>
切片項や傾きは<span class="math inline">\(m(=4)\)</span>個の株式間で互いに相関があると仮定する (–&gt; SUR, Seemingly Unrelated Regression).</p>
<p>このモデルは, 以下のように表記できる.
<span class="math display">\[
\begin{align}
Y_{t} &amp;= (F_t \otimes I_m) \theta_t + v_{t}, \quad v_t \sim_{i.i.d.}N(0,V)\\
\theta_{t} &amp;= (G \otimes I_m) \theta_{t-1} + w_{t}, \quad w_t \sim_{i.i.d.}N(0,W)\\
\end{align}
\]</span>
但し,
<span class="math display">\[
Y_t = \left[\begin{smallmatrix}
Y_{1,t} \\
\vdots \\
Y_{m,t}
\end{smallmatrix}\right],\
\theta_t = \left[\begin{smallmatrix}
\alpha_{1,t} \\
\vdots \\
\alpha_{m,t}\\
\beta_{1,t} \\
\vdots \\
\beta_{m,t}\\
\end{smallmatrix}\right], \
v_t = \left[\begin{smallmatrix}
v_{1,t} \\
\vdots \\
v_{m,t}\\
\end{smallmatrix}\right], \
w_t = \left[\begin{smallmatrix}
w_{1,t} \\
\vdots \\
w_{2m,t}\\
\end{smallmatrix}\right], \
\]</span>
<span class="math inline">\(F_t = [1 \ x_t]\)</span>, <span class="math inline">\(G={\bf I}_{2 \times 2}\)</span>,
<span class="math display">\[
W=\left[\begin{smallmatrix}
W_{\alpha} &amp; 0\\
0 &amp; W_{\beta}\\
\end{smallmatrix}\right]
\]</span>
である. なお, 上述の銘柄間の相関性は, <span class="math inline">\(V,W\)</span>を非対角行列に取ることで表現される.</p>
<div id="動的capm-1" class="section level4 unnumbered hasAnchor">
<h4>動的CAPM<a href="動的線形モデル.html#動的capm-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>目的変数として個別4銘柄と, 説明変数としてMarketの,
各々の超過リターンを計算する.</p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="動的線形モデル.html#cb976-1" tabindex="-1"></a>ifl <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_PPC, <span class="st">&quot;P.dat&quot;</span>)</span>
<span id="cb976-2"><a href="動的線形モデル.html#cb976-2" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">read.table</span>(ifl,</span>
<span id="cb976-3"><a href="動的線形モデル.html#cb976-3" tabindex="-1"></a>                     <span class="at">header =</span> <span class="cn">TRUE</span>),</span>
<span id="cb976-4"><a href="動的線形モデル.html#cb976-4" tabindex="-1"></a>          <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1978</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb976-5"><a href="動的線形モデル.html#cb976-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> tmp[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">-</span> tmp[, <span class="st">&quot;RKFREE&quot;</span>]</span>
<span id="cb976-6"><a href="動的線形モデル.html#cb976-6" tabindex="-1"></a><span class="fu">colnames</span>(y) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(tmp)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb976-7"><a href="動的線形モデル.html#cb976-7" tabindex="-1"></a>market <span class="ot">&lt;-</span> tmp[, <span class="st">&quot;MARKET&quot;</span>] <span class="sc">-</span> tmp[, <span class="st">&quot;RKFREE&quot;</span>]</span>
<span id="cb976-8"><a href="動的線形モデル.html#cb976-8" tabindex="-1"></a><span class="fu">rm</span>(<span class="st">&quot;tmp&quot;</span>)</span>
<span id="cb976-9"><a href="動的線形モデル.html#cb976-9" tabindex="-1"></a><span class="co"># m &lt;- NCOL(y)</span></span>
<span id="cb976-10"><a href="動的線形モデル.html#cb976-10" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">ncol</span>(y)</span></code></pre></div>
<p>まず, 上記SURモデルのDLM表現を<code>dlmModReg()</code>を用いて行う.
PPCでは,</p>
<ul>
<li>簡単のため, <span class="math inline">\(\alpha\)</span>は定数 (時間固定) (–&gt; 対応する<span class="math inline">\(W_{\alpha}=0\)</span>)</li>
<li>データより別途計算しておいた<span class="math inline">\(W_{\beta},V\)</span>の推定値を使用</li>
</ul>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="動的線形モデル.html#cb977-1" tabindex="-1"></a><span class="co"># Marketを使って初期設定</span></span>
<span id="cb977-2"><a href="動的線形モデル.html#cb977-2" tabindex="-1"></a>CAPM <span class="ot">&lt;-</span> <span class="fu">dlmModReg</span>(market)</span>
<span id="cb977-3"><a href="動的線形モデル.html#cb977-3" tabindex="-1"></a></span>
<span id="cb977-4"><a href="動的線形モデル.html#cb977-4" tabindex="-1"></a><span class="co"># 4変量の特定化のために手入力</span></span>
<span id="cb977-5"><a href="動的線形モデル.html#cb977-5" tabindex="-1"></a>CAPM<span class="sc">$</span>FF <span class="ot">&lt;-</span> CAPM<span class="sc">$</span>FF <span class="sc">%x%</span> <span class="fu">diag</span>(m) <span class="co"># ブロック対角行列</span></span>
<span id="cb977-6"><a href="動的線形モデル.html#cb977-6" tabindex="-1"></a><span class="co"># 注) %x%: クロネッカー積</span></span>
<span id="cb977-7"><a href="動的線形モデル.html#cb977-7" tabindex="-1"></a>CAPM<span class="sc">$</span>GG <span class="ot">&lt;-</span> CAPM<span class="sc">$</span>GG <span class="sc">%x%</span> <span class="fu">diag</span>(m)</span>
<span id="cb977-8"><a href="動的線形モデル.html#cb977-8" tabindex="-1"></a>CAPM<span class="sc">$</span>JFF <span class="ot">&lt;-</span> CAPM<span class="sc">$</span>JFF <span class="sc">%x%</span> <span class="fu">diag</span>(m)</span>
<span id="cb977-9"><a href="動的線形モデル.html#cb977-9" tabindex="-1"></a></span>
<span id="cb977-10"><a href="動的線形モデル.html#cb977-10" tabindex="-1"></a><span class="co"># PPCでは, データより別途計算しておいたW,Vの推定値を使用</span></span>
<span id="cb977-11"><a href="動的線形モデル.html#cb977-11" tabindex="-1"></a>CAPM<span class="sc">$</span>W <span class="ot">&lt;-</span> CAPM<span class="sc">$</span>W <span class="sc">%x%</span> <span class="fu">matrix</span>(<span class="dv">0</span>, m, m)</span>
<span id="cb977-12"><a href="動的線形モデル.html#cb977-12" tabindex="-1"></a>CAPM<span class="sc">$</span>W[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>m), <span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>m)] <span class="ot">&lt;-</span></span>
<span id="cb977-13"><a href="動的線形モデル.html#cb977-13" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fl">8.153e-07</span>,  <span class="sc">-</span><span class="fl">3.172e-05</span>, <span class="sc">-</span><span class="fl">4.267e-05</span>, <span class="sc">-</span><span class="fl">6.649e-05</span>,</span>
<span id="cb977-14"><a href="動的線形モデル.html#cb977-14" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">3.172e-05</span>, <span class="fl">0.001377</span>,   <span class="fl">0.001852</span>,   <span class="fl">0.002884</span>,</span>
<span id="cb977-15"><a href="動的線形モデル.html#cb977-15" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">4.267e-05</span>, <span class="fl">0.001852</span>,   <span class="fl">0.002498</span>,   <span class="fl">0.003884</span>,</span>
<span id="cb977-16"><a href="動的線形モデル.html#cb977-16" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">6.649e-05</span>, <span class="fl">0.002884</span>,   <span class="fl">0.003884</span>,   <span class="fl">0.006057</span>)</span>
<span id="cb977-17"><a href="動的線形モデル.html#cb977-17" tabindex="-1"></a>CAPM<span class="sc">$</span>V <span class="ot">&lt;-</span> CAPM<span class="sc">$</span>V <span class="sc">%x%</span> <span class="fu">matrix</span>(<span class="dv">0</span>, m, m)</span>
<span id="cb977-18"><a href="動的線形モデル.html#cb977-18" tabindex="-1"></a>CAPM<span class="sc">$</span>V[] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">41.06</span>,     <span class="fl">0.01571</span>, <span class="sc">-</span><span class="fl">0.9504</span>, <span class="sc">-</span><span class="fl">2.328</span>,</span>
<span id="cb977-19"><a href="動的線形モデル.html#cb977-19" tabindex="-1"></a>              <span class="fl">0.01571</span>, <span class="fl">24.23</span>,     <span class="fl">5.783</span>,   <span class="fl">3.376</span>,</span>
<span id="cb977-20"><a href="動的線形モデル.html#cb977-20" tabindex="-1"></a>              <span class="sc">-</span><span class="fl">0.9504</span>,   <span class="fl">5.783</span>,   <span class="fl">39.2</span>,     <span class="fl">8.145</span>,</span>
<span id="cb977-21"><a href="動的線形モデル.html#cb977-21" tabindex="-1"></a>              <span class="sc">-</span><span class="fl">2.328</span>,    <span class="fl">3.376</span>,    <span class="fl">8.145</span>,  <span class="fl">39.29</span>)</span>
<span id="cb977-22"><a href="動的線形モデル.html#cb977-22" tabindex="-1"></a>CAPM<span class="sc">$</span>m0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> m)</span>
<span id="cb977-23"><a href="動的線形モデル.html#cb977-23" tabindex="-1"></a>CAPM<span class="sc">$</span>C0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fl">1e7</span>, <span class="at">nr =</span> <span class="dv">2</span> <span class="sc">*</span> m)</span></code></pre></div>
</div>
<div id="スムージング-1" class="section level4 unnumbered hasAnchor">
<h4>スムージング<a href="動的線形モデル.html#スムージング-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="動的線形モデル.html#cb978-1" tabindex="-1"></a><span class="do">## Smooth</span></span>
<span id="cb978-2"><a href="動的線形モデル.html#cb978-2" tabindex="-1"></a><span class="co"># Kalmanスムージング実行</span></span>
<span id="cb978-3"><a href="動的線形モデル.html#cb978-3" tabindex="-1"></a>CAPMsmooth <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(y, CAPM)</span>
<span id="cb978-4"><a href="動的線形モデル.html#cb978-4" tabindex="-1"></a></span>
<span id="cb978-5"><a href="動的線形モデル.html#cb978-5" tabindex="-1"></a><span class="do">## plots</span></span>
<span id="cb978-6"><a href="動的線形モデル.html#cb978-6" tabindex="-1"></a><span class="co"># 4銘柄のbetaのスムージング推定値のplot</span></span>
<span id="cb978-7"><a href="動的線形モデル.html#cb978-7" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb978-8"><a href="動的線形モデル.html#cb978-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dropFirst</span>(CAPMsmooth<span class="sc">$</span>s[, m <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span>m]),</span>
<span id="cb978-9"><a href="動的線形モデル.html#cb978-9" tabindex="-1"></a>     <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;13&quot;</span>, <span class="st">&quot;6413&quot;</span>, <span class="st">&quot;431313&quot;</span>, <span class="st">&quot;B4&quot;</span>),</span>
<span id="cb978-10"><a href="動的線形モデル.html#cb978-10" tabindex="-1"></a>     <span class="at">plot.type =</span> <span class="st">&quot;s&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Beta&quot;</span>)</span>
<span id="cb978-11"><a href="動的線形モデル.html#cb978-11" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb978-12"><a href="動的線形モデル.html#cb978-12" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">colnames</span>(y), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb978-13"><a href="動的線形モデル.html#cb978-13" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;13&quot;</span>, <span class="st">&quot;6413&quot;</span>, <span class="st">&quot;431313&quot;</span>, <span class="st">&quot;B4&quot;</span>), <span class="at">inset =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/unnamed-chunk-15-1.png" width="75%" /></p>
</div>
<div id="参考文献" class="section level3 unnumbered hasAnchor">
<h3>参考文献<a href="動的線形モデル.html#参考文献" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Giovanni Petris (2010). An R Package for Dynamic Linear Models. <em>Journal of Statistical Software</em>, 36(12), 1-16. <a href="http://www.jstatsoft.org/v36/i12/">http://www.jstatsoft.org/v36/i12/</a>.
<!--  - http://definetti.uark.edu/~gpetris/dlm/ (← 12/24/21時点, アクセス不可) --></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="多変量ボラティリティモデル.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="高頻度データ分析.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
