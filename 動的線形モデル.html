<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 動的線形モデル | 金融時系列解析</title>
  <meta name="description" content="14 動的線形モデル | 金融時系列解析" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="14 動的線形モデル | 金融時系列解析" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 動的線形モデル | 金融時系列解析" />
  
  
  

<meta name="author" content="林 高樹" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="スペクトル解析.html"/>
<link rel="next" href="バブル-生成崩壊-検出.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> はじめに</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#時系列モデリング"><i class="fa fa-check"></i><b>1.1</b> 時系列モデリング</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#金融時系列データの特徴"><i class="fa fa-check"></i><b>1.2</b> 金融時系列データの特徴</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#金融時系列データの特徴-みずほ-8411-株価データの例"><i class="fa fa-check"></i>金融時系列データの特徴: みずほ (8411) 株価データの例</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#シミュレーションによるサンプルパス生成"><i class="fa fa-check"></i><b>1.3</b> シミュレーションによるサンプルパス生成</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#rにおける時系列オブジェクトクラスおよび関数の例"><i class="fa fa-check"></i><b>1.4</b> Rにおける時系列オブジェクト・クラスおよび関数の例</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#日付時間データに対するクラス"><i class="fa fa-check"></i><b>1.4.1</b> 日付・時間データに対するクラス</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#時系列データに対するクラス1-tsクラス"><i class="fa fa-check"></i><b>1.4.2</b> 時系列データに対するクラス(1): tsクラス</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#時系列データに対するクラス2-zooクラスとxtsクラス"><i class="fa fa-check"></i><b>1.4.3</b> 時系列データに対するクラス(2): zooクラスとxtsクラス</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#時系列データの分解"><i class="fa fa-check"></i><b>1.5</b> 時系列データの分解</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#トレンド抽出-平滑化smoothing"><i class="fa fa-check"></i><b>1.5.1</b> トレンド抽出, 平滑化(smoothing)</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#時系列の分解"><i class="fa fa-check"></i><b>1.5.2</b> 時系列の分解</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html"><i class="fa fa-check"></i><b>2</b> 定常性と自己相関関数</a>
<ul>
<li class="chapter" data-level="2.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#確率過程の2次特性-平均関数と自己共分散関数"><i class="fa fa-check"></i><b>2.1</b> 確率過程の2次特性: 平均関数と自己共分散関数</a></li>
<li class="chapter" data-level="2.2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#定常性-stationarity"><i class="fa fa-check"></i><b>2.2</b> 定常性 (stationarity)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#強定常性"><i class="fa fa-check"></i><b>2.2.1</b> 強定常性</a></li>
<li class="chapter" data-level="2.2.2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#弱定常性"><i class="fa fa-check"></i><b>2.2.2</b> 弱定常性</a></li>
<li class="chapter" data-level="2.2.3" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#ホワイトノイズ"><i class="fa fa-check"></i><b>2.2.3</b> ホワイトノイズ</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#標本平均と標本自己共分散関数"><i class="fa fa-check"></i><b>2.3</b> 標本平均と標本自己共分散関数</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#アンサンブル平均-vs-標本平均"><i class="fa fa-check"></i><b>2.3.1</b> アンサンブル平均 vs 標本平均</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#標本自己相関関数"><i class="fa fa-check"></i><b>2.4</b> 標本自己相関関数</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#白色ノイズ"><i class="fa fa-check"></i><b>2.4.1</b> 白色ノイズ</a></li>
<li class="chapter" data-level="2.4.2" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#ランダムウォーク"><i class="fa fa-check"></i><b>2.4.2</b> ランダムウォーク</a></li>
<li class="chapter" data-level="2.4.3" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#非定常成分を含む時系列"><i class="fa fa-check"></i><b>2.4.3</b> 非定常成分を含む時系列</a></li>
<li class="chapter" data-level="2.4.4" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#線形時系列モデル"><i class="fa fa-check"></i><b>2.4.4</b> 線形時系列モデル</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#自己相関関数-標本値-vs-理論値"><i class="fa fa-check"></i><b>2.5</b> 自己相関関数 (標本値 vs 理論値)</a>
<ul>
<li class="chapter" data-level="" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#ar2-モデル"><i class="fa fa-check"></i>AR(2) モデル</a></li>
<li class="chapter" data-level="2.5.1" data-path="定常性と自己相関関数.html"><a href="定常性と自己相関関数.html#arma11モデル-1"><i class="fa fa-check"></i><b>2.5.1</b> ARMA(1,1)モデル</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="armapqモデル.html"><a href="armapqモデル.html"><i class="fa fa-check"></i><b>3</b> ARMA<span class="math inline">\((p,q)\)</span>モデル</a>
<ul>
<li class="chapter" data-level="3.1" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルとは"><i class="fa fa-check"></i><b>3.1</b> ARMA<span class="math inline">\((p,q)\)</span>モデルとは</a>
<ul>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#因果性と反転可能性"><i class="fa fa-check"></i>因果性と反転可能性</a></li>
<li class="chapter" data-level="" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの意義"><i class="fa fa-check"></i>ARMA<span class="math inline">\((p,q)\)</span>モデルの意義</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルによる予測"><i class="fa fa-check"></i><b>3.2</b> ARMA<span class="math inline">\((p,q)\)</span>モデルによる予測</a></li>
<li class="chapter" data-level="3.3" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの推定"><i class="fa fa-check"></i><b>3.3</b> ARMA<span class="math inline">\((p,q)\)</span>モデルの推定</a></li>
<li class="chapter" data-level="3.4" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの同定-次数の特定"><i class="fa fa-check"></i><b>3.4</b> ARMA<span class="math inline">\((p,q)\)</span>モデルの同定 (次数の特定)</a></li>
<li class="chapter" data-level="3.5" data-path="armapqモデル.html"><a href="armapqモデル.html#rによる実行例"><i class="fa fa-check"></i><b>3.5</b> Rによる実行例</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの同定-acfpacfeacfの利用"><i class="fa fa-check"></i><b>3.5.1</b> ARMA<span class="math inline">\((p,q)\)</span>モデルの同定 (ACF/PACF/EACFの利用)</a></li>
<li class="chapter" data-level="3.5.2" data-path="armapqモデル.html"><a href="armapqモデル.html#armapqモデルの推定診断"><i class="fa fa-check"></i><b>3.5.2</b> ARMA<span class="math inline">\((p,q)\)</span>モデルの推定・診断</a></li>
<li class="chapter" data-level="3.5.3" data-path="armapqモデル.html"><a href="armapqモデル.html#パッケージforecastの利用"><i class="fa fa-check"></i><b>3.5.3</b> パッケージ{forecast}の利用</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="armapqモデル.html"><a href="armapqモデル.html#armaモデル-データ分析例-tsay-ch2"><i class="fa fa-check"></i><b>3.6</b> ARMAモデル: データ分析例 (Tsay, Ch2)</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="armapqモデル.html"><a href="armapqモデル.html#標本acf"><i class="fa fa-check"></i><b>3.6.1</b> 標本ACF</a></li>
<li class="chapter" data-level="3.6.2" data-path="armapqモデル.html"><a href="armapqモデル.html#ar-ma-arma-2.42.6"><i class="fa fa-check"></i><b>3.6.2</b> AR, MA, ARMA (2.4–2.6)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="arimaモデルsarimaモデル.html"><a href="arimaモデルsarimaモデル.html"><i class="fa fa-check"></i><b>4</b> ARIMAモデル/SARIMAモデル</a>
<ul>
<li class="chapter" data-level="4.1" data-path="arimaモデルsarimaモデル.html"><a href="arimaモデルsarimaモデル.html#arimapdqモデルとは"><i class="fa fa-check"></i><b>4.1</b> ARIMA<span class="math inline">\((p,d,q)\)</span>モデルとは</a></li>
<li class="chapter" data-level="4.2" data-path="arimaモデルsarimaモデル.html"><a href="arimaモデルsarimaモデル.html#sarimapdqtimes-pdq_sモデル-周期sとは"><i class="fa fa-check"></i><b>4.2</b> SARIMA<span class="math inline">\((p,d,q)\times (P,D,Q)_s\)</span>モデル (周期<span class="math inline">\(s\)</span>)とは</a></li>
<li class="chapter" data-level="4.3" data-path="arimaモデルsarimaモデル.html"><a href="arimaモデルsarimaモデル.html#sarimaモデルのパス発生-sarimaパッケージの利用"><i class="fa fa-check"></i><b>4.3</b> SARIMAモデルのパス発生 ({sarima}パッケージの利用)</a></li>
<li class="chapter" data-level="4.4" data-path="arimaモデルsarimaモデル.html"><a href="arimaモデルsarimaモデル.html#sarimaモデルの推定診断"><i class="fa fa-check"></i><b>4.4</b> SARIMAモデルの推定・診断</a></li>
<li class="chapter" data-level="4.5" data-path="arimaモデルsarimaモデル.html"><a href="arimaモデルsarimaモデル.html#パッケージforecastの利用-1"><i class="fa fa-check"></i><b>4.5</b> パッケージ{forecast}の利用</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html"><i class="fa fa-check"></i><b>5</b> 単位根過程と単位根検定</a>
<ul>
<li class="chapter" data-level="5.1" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#単位根過程と見せかけの回帰"><i class="fa fa-check"></i><b>5.1</b> 単位根過程と見せかけの回帰</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#単位根過程"><i class="fa fa-check"></i><b>5.1.1</b> 単位根過程</a></li>
<li class="chapter" data-level="5.1.2" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#見せかけの回帰"><i class="fa fa-check"></i><b>5.1.2</b> 見せかけの回帰</a></li>
<li class="chapter" data-level="5.1.3" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#見せかけの回帰の判定"><i class="fa fa-check"></i><b>5.1.3</b> 見せかけの回帰の判定</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#主な単位根検定法"><i class="fa fa-check"></i><b>5.2</b> 主な単位根検定法</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#augmented-dicky-fuller-adf-検定の実行例"><i class="fa fa-check"></i><b>5.2.1</b> Augmented Dicky-Fuller (ADF) 検定の実行例</a></li>
<li class="chapter" data-level="5.2.2" data-path="単位根過程と単位根検定.html"><a href="単位根過程と単位根検定.html#adf検定以外の検定法"><i class="fa fa-check"></i><b>5.2.2</b> ADF検定以外の検定法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="長期記憶過程.html"><a href="長期記憶過程.html"><i class="fa fa-check"></i><b>6</b> 長期記憶過程</a>
<ul>
<li class="chapter" data-level="6.1" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimapdq過程のシミュレーション"><i class="fa fa-check"></i><b>6.1</b> ARFIMA(p,d,q)過程のシミュレーション</a></li>
<li class="chapter" data-level="6.2" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfima-fractional-gaussian過程のシミュレーション"><i class="fa fa-check"></i><b>6.2</b> ARFIMA, fractional Gaussian過程のシミュレーション</a></li>
<li class="chapter" data-level="6.3" data-path="長期記憶過程.html"><a href="長期記憶過程.html#hurst指数の推定"><i class="fa fa-check"></i><b>6.3</b> Hurst指数の推定</a></li>
<li class="chapter" data-level="6.4" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimaモデルの推定"><i class="fa fa-check"></i><b>6.4</b> ARFIMAモデルの推定</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="長期記憶過程.html"><a href="長期記憶過程.html#最尤法"><i class="fa fa-check"></i><b>6.4.1</b> 最尤法</a></li>
<li class="chapter" data-level="6.4.2" data-path="長期記憶過程.html"><a href="長期記憶過程.html#階差次数dの代替的推定法"><i class="fa fa-check"></i><b>6.4.2</b> 階差次数<span class="math inline">\(d\)</span>の代替的推定法</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="長期記憶過程.html"><a href="長期記憶過程.html#arfimaモデル-データ分析例-tsay-2.11-pp.119120"><i class="fa fa-check"></i><b>6.5</b> ARFIMAモデル: データ分析例 (Tsay, 2.11, pp.119–120)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="レジームスイッチングモデル.html"><a href="レジームスイッチングモデル.html"><i class="fa fa-check"></i><b>7</b> レジーム・スイッチング・モデル</a>
<ul>
<li class="chapter" data-level="7.1" data-path="レジームスイッチングモデル.html"><a href="レジームスイッチングモデル.html#自己相関マルコフスイッチングモデル-msm-ar"><i class="fa fa-check"></i><b>7.1</b> 自己相関マルコフ・スイッチング・モデル (MSM-AR)</a></li>
<li class="chapter" data-level="7.2" data-path="レジームスイッチングモデル.html"><a href="レジームスイッチングモデル.html#msm-arモデルの適合"><i class="fa fa-check"></i><b>7.2</b> MSM-ARモデルの適合</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="garchモデル.html"><a href="garchモデル.html"><i class="fa fa-check"></i><b>8</b> GARCHモデル</a>
<ul>
<li class="chapter" data-level="8.1" data-path="garchモデル.html"><a href="garchモデル.html#garchモデル-1"><i class="fa fa-check"></i><b>8.1</b> GARCHモデル</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="garchモデル.html"><a href="garchモデル.html#garchpqモデルのサンプルパス生成"><i class="fa fa-check"></i><b>8.1.1</b> GARCH(p,q)モデルのサンプルパス生成</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="garchモデル.html"><a href="garchモデル.html#garchモデルの推定"><i class="fa fa-check"></i><b>8.2</b> GARCHモデルの推定</a></li>
<li class="chapter" data-level="8.3" data-path="garchモデル.html"><a href="garchモデル.html#garchモデルのバリエーション"><i class="fa fa-check"></i><b>8.3</b> GARCHモデルのバリエーション</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="garchモデル.html"><a href="garchモデル.html#iarch11"><i class="fa fa-check"></i><b>8.3.1</b> IARCH(1,1)</a></li>
<li class="chapter" data-level="8.3.2" data-path="garchモデル.html"><a href="garchモデル.html#gjr-garch11"><i class="fa fa-check"></i><b>8.3.2</b> GJR-GARCH(1,1)</a></li>
<li class="chapter" data-level="8.3.3" data-path="garchモデル.html"><a href="garchモデル.html#aparch"><i class="fa fa-check"></i><b>8.3.3</b> APARCH</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="garchモデル.html"><a href="garchモデル.html#garchモデル-データ分析例-tsay-ch4"><i class="fa fa-check"></i><b>8.4</b> GARCHモデル: データ分析例 (Tsay, Ch4)</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="garchモデル.html"><a href="garchモデル.html#必要な関数やデータセットの入手"><i class="fa fa-check"></i><b>8.4.1</b> 必要な関数やデータセットの入手</a></li>
<li class="chapter" data-level="8.4.2" data-path="garchモデル.html"><a href="garchモデル.html#integrated-garch-モデル"><i class="fa fa-check"></i><b>8.4.2</b> Integrated GARCH モデル</a></li>
<li class="chapter" data-level="8.4.3" data-path="garchモデル.html"><a href="garchモデル.html#garch-m-モデル"><i class="fa fa-check"></i><b>8.4.3</b> GARCH-M モデル</a></li>
<li class="chapter" data-level="8.4.4" data-path="garchモデル.html"><a href="garchモデル.html#exponential-garch-model"><i class="fa fa-check"></i><b>8.4.4</b> Exponential GARCH Model</a></li>
<li class="chapter" data-level="8.4.5" data-path="garchモデル.html"><a href="garchモデル.html#threshold-garch-モデル"><i class="fa fa-check"></i><b>8.4.5</b> Threshold GARCH モデル</a></li>
<li class="chapter" data-level="8.4.6" data-path="garchモデル.html"><a href="garchモデル.html#asymmetric-power-arch-モデル"><i class="fa fa-check"></i><b>8.4.6</b> Asymmetric Power ARCH モデル</a></li>
<li class="chapter" data-level="8.4.7" data-path="garchモデル.html"><a href="garchモデル.html#nonsymmetric-garch-モデル"><i class="fa fa-check"></i><b>8.4.7</b> Nonsymmetric GARCH モデル</a></li>
<li class="chapter" data-level="8.4.8" data-path="garchモデル.html"><a href="garchモデル.html#代替的アプリーチ間の比較"><i class="fa fa-check"></i><b>8.4.8</b> 代替的アプリーチ間の比較</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="varモデル.html"><a href="varモデル.html"><i class="fa fa-check"></i><b>9</b> VARモデル</a>
<ul>
<li class="chapter" data-level="9.1" data-path="varモデル.html"><a href="varモデル.html#varモデル-1"><i class="fa fa-check"></i><b>9.1</b> VARモデル</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="varモデル.html"><a href="varモデル.html#varpモデルのシミュレーション"><i class="fa fa-check"></i><b>9.1.1</b> VAR(<span class="math inline">\(p\)</span>)モデルのシミュレーション</a></li>
<li class="chapter" data-level="9.1.2" data-path="varモデル.html"><a href="varモデル.html#varpモデルの次数同定"><i class="fa fa-check"></i><b>9.1.2</b> VAR(<span class="math inline">\(p\)</span>)モデルの次数同定</a></li>
<li class="chapter" data-level="9.1.3" data-path="varモデル.html"><a href="varモデル.html#varpモデルの推定"><i class="fa fa-check"></i><b>9.1.3</b> VAR(<span class="math inline">\(p\)</span>)モデルの推定</a></li>
<li class="chapter" data-level="9.1.4" data-path="varモデル.html"><a href="varモデル.html#varpモデル予測"><i class="fa fa-check"></i><b>9.1.4</b> VAR(<span class="math inline">\(p\)</span>)モデル予測</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="varモデル.html"><a href="varモデル.html#var解析"><i class="fa fa-check"></i><b>9.2</b> VAR解析</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="varモデル.html"><a href="varモデル.html#varpモデルの推定復習"><i class="fa fa-check"></i><b>9.2.1</b> VAR(<span class="math inline">\(p\)</span>)モデルの推定(復習)</a></li>
<li class="chapter" data-level="9.2.2" data-path="varモデル.html"><a href="varモデル.html#グレンジャーの因果性検定"><i class="fa fa-check"></i><b>9.2.2</b> グレンジャーの因果性検定</a></li>
<li class="chapter" data-level="9.2.3" data-path="varモデル.html"><a href="varモデル.html#インパルス応答"><i class="fa fa-check"></i><b>9.2.3</b> インパルス応答</a></li>
<li class="chapter" data-level="9.2.4" data-path="varモデル.html"><a href="varモデル.html#予測誤差分散分解-forecast-error-variance-decomposition"><i class="fa fa-check"></i><b>9.2.4</b> 予測誤差分散分解 (forecast error variance decomposition)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="varモデル.html"><a href="varモデル.html#var解析-データ分析例"><i class="fa fa-check"></i><b>9.3</b> VAR解析 (データ分析例)</a>
<ul>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#事例1-ソフトバンク9434-vs-ソフトバンクグループ9984"><i class="fa fa-check"></i>事例1: ソフトバンク(9434) vs ソフトバンクグループ(9984)</a></li>
<li class="chapter" data-level="" data-path="varモデル.html"><a href="varモデル.html#事例2-米英日3株式市場-sp500-ftse-日経平均"><i class="fa fa-check"></i>事例2: 米英日3株式市場 (S&amp;P500, FTSE, 日経平均)</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="varモデル.html"><a href="varモデル.html#補足-分散共分散行列のコレスキー分解"><i class="fa fa-check"></i><b>9.4</b> 補足: 分散共分散行列のコレスキー分解</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html"><i class="fa fa-check"></i><b>10</b> 共和分分析・誤差修正モデル</a>
<ul>
<li class="chapter" data-level="10.1" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#見せかけの回帰-1"><i class="fa fa-check"></i><b>10.1</b> 見せかけの回帰</a>
<ul>
<li class="chapter" data-level="" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#durbin-watson検定"><i class="fa fa-check"></i>Durbin-Watson検定</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#共和分検定"><i class="fa fa-check"></i><b>10.2</b> 共和分検定</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#engle-grangerの方法"><i class="fa fa-check"></i><b>10.2.1</b> Engle-Grangerの方法</a></li>
<li class="chapter" data-level="10.2.2" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#johansenの方法"><i class="fa fa-check"></i><b>10.2.2</b> Johansenの方法</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#誤差修正モデル-データ分析例-tsay-mts-ch5"><i class="fa fa-check"></i><b>10.3</b> 誤差修正モデル: データ分析例 (Tsay, MTS, Ch5)</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#共和分検定-1"><i class="fa fa-check"></i><b>10.3.1</b> 共和分検定</a></li>
<li class="chapter" data-level="10.3.2" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#johansenの方法-johansen-procedure"><i class="fa fa-check"></i><b>10.3.2</b> Johansenの方法 (Johansen-Procedure)</a></li>
<li class="chapter" data-level="10.3.3" data-path="共和分分析誤差修正モデル.html"><a href="共和分分析誤差修正モデル.html#誤差修正モデルecmの推定"><i class="fa fa-check"></i><b>10.3.3</b> 誤差修正モデル(ECM)の推定</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html"><i class="fa fa-check"></i><b>11</b> 多変量ボラティリティ・モデル</a>
<ul>
<li class="chapter" data-level="11.1" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#多変量時系列データの条件付不均一分散性の検定"><i class="fa fa-check"></i><b>11.1</b> 多変量時系列データの条件付不均一分散性の検定</a>
<ul>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#分析例"><i class="fa fa-check"></i>分析例</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#指数加重移動平均法-ewma"><i class="fa fa-check"></i><b>11.2</b> 指数加重移動平均法 (EWMA)</a></li>
<li class="chapter" data-level="11.3" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#bekk1-1モデル"><i class="fa fa-check"></i><b>11.3</b> BEKK(1, 1)モデル</a></li>
<li class="chapter" data-level="11.4" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#cholesky分解を利用したボラティリティ推定"><i class="fa fa-check"></i><b>11.4</b> Cholesky分解を利用したボラティリティ推定</a></li>
<li class="chapter" data-level="11.5" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#dcc-dynamic-conditional-correlation-モデル"><i class="fa fa-check"></i><b>11.5</b> DCC (Dynamic Conditional Correlation) モデル</a>
<ul>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#tse-and-tsui-2002-モデル"><i class="fa fa-check"></i>Tse and Tsui (2002) モデル</a></li>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#engle-2002-モデル"><i class="fa fa-check"></i>Engle (2002) モデル</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#go-garchモデル"><i class="fa fa-check"></i><b>11.6</b> Go-GARCHモデル</a></li>
<li class="chapter" data-level="11.7" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#コピュラに基づくアプローチ"><i class="fa fa-check"></i><b>11.7</b> コピュラに基づくアプローチ</a>
<ul>
<li class="chapter" data-level="" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#多変量-t-copula-ボラティリティモデル"><i class="fa fa-check"></i>多変量 t-Copula ボラティリティ・モデル</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="多変量ボラティリティモデル.html"><a href="多変量ボラティリティモデル.html#主成分分析に基づくアプローチ-pvc"><i class="fa fa-check"></i><b>11.8</b> 主成分分析に基づくアプローチ (PVC)</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html"><i class="fa fa-check"></i><b>12</b> 高頻度データ分析</a>
<ul>
<li class="chapter" data-level="12.1" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#ボラティリティ推定"><i class="fa fa-check"></i><b>12.1</b> ボラティリティ推定</a>
<ul>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#データセット1-topix指数データ"><i class="fa fa-check"></i>データセット1: TOPIX指数データ</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#実現ボラティリティの計算"><i class="fa fa-check"></i>実現ボラティリティの計算</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#parkinsonボラティリティの計算"><i class="fa fa-check"></i>Parkinsonボラティリティの計算</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#har-rvモデルによる予測"><i class="fa fa-check"></i>HAR-RVモデルによる予測</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#共分散相関の推定"><i class="fa fa-check"></i><b>12.2</b> 共分散・相関の推定</a>
<ul>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#データセット2-株価指数先物データ"><i class="fa fa-check"></i>データセット2: 株価指数先物データ</a></li>
<li class="chapter" data-level="" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#共分散相関の推定-1"><i class="fa fa-check"></i>共分散・相関の推定</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="高頻度データ分析.html"><a href="高頻度データ分析.html#acdモデル"><i class="fa fa-check"></i><b>12.3</b> ACDモデル</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="スペクトル解析.html"><a href="スペクトル解析.html"><i class="fa fa-check"></i><b>13</b> スペクトル解析</a>
<ul>
<li class="chapter" data-level="13.1" data-path="スペクトル解析.html"><a href="スペクトル解析.html#armaモデルのスペクトル密度"><i class="fa fa-check"></i><b>13.1</b> ARMAモデルのスペクトル密度</a></li>
<li class="chapter" data-level="13.2" data-path="スペクトル解析.html"><a href="スペクトル解析.html#周期変動時系列のスペクトル密度"><i class="fa fa-check"></i><b>13.2</b> 周期変動時系列のスペクトル密度</a></li>
<li class="chapter" data-level="13.3" data-path="スペクトル解析.html"><a href="スペクトル解析.html#データ分析例-1"><i class="fa fa-check"></i><b>13.3</b> データ分析例 (1)</a>
<ul>
<li class="chapter" data-level="" data-path="スペクトル解析.html"><a href="スペクトル解析.html#データセット1-sunspots"><i class="fa fa-check"></i>データセット1: sunspots</a></li>
<li class="chapter" data-level="" data-path="スペクトル解析.html"><a href="スペクトル解析.html#データセット2-soi"><i class="fa fa-check"></i>データセット2: SOI</a></li>
<li class="chapter" data-level="" data-path="スペクトル解析.html"><a href="スペクトル解析.html#データセット3-銀行プライムローン金利"><i class="fa fa-check"></i>データセット3: 銀行プライムローン金利</a></li>
<li class="chapter" data-level="" data-path="スペクトル解析.html"><a href="スペクトル解析.html#データセット4-事故死者数"><i class="fa fa-check"></i>データセット4: 事故死者数</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="スペクトル解析.html"><a href="スペクトル解析.html#データ分析例-2"><i class="fa fa-check"></i><b>13.4</b> データ分析例 (2)</a>
<ul>
<li class="chapter" data-level="" data-path="スペクトル解析.html"><a href="スペクトル解析.html#為替水準に対する分解-スペクトル解析"><i class="fa fa-check"></i>為替水準に対する分解 &amp; スペクトル解析</a></li>
<li class="chapter" data-level="" data-path="スペクトル解析.html"><a href="スペクトル解析.html#為替リターンに対する分解-スペクトル解析"><i class="fa fa-check"></i>為替リターンに対する分解 &amp; スペクトル解析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="動的線形モデル.html"><a href="動的線形モデル.html"><i class="fa fa-check"></i><b>14</b> 動的線形モデル</a>
<ul>
<li class="chapter" data-level="14.1" data-path="動的線形モデル.html"><a href="動的線形モデル.html#パッケージdlm"><i class="fa fa-check"></i><b>14.1</b> パッケージ<strong>dlm</strong></a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#local-levelモデル"><i class="fa fa-check"></i>local levelモデル</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#local-level-plus-seasonal-componentモデル"><i class="fa fa-check"></i>local level plus seasonal componentモデル</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="動的線形モデル.html"><a href="動的線形モデル.html#パッケージstatespacer"><i class="fa fa-check"></i><b>14.2</b> パッケージ<strong>statespacer</strong></a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#local-levelモデル-1"><i class="fa fa-check"></i>local levelモデル</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#季節性への対応説明変数の追加従属変数が複数ある場合への対応"><i class="fa fa-check"></i>季節性への対応・説明変数の追加・従属変数が複数ある場合への対応</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="動的線形モデル.html"><a href="動的線形モデル.html#パッケージbssm"><i class="fa fa-check"></i><b>14.3</b> パッケージ<strong>bssm</strong></a>
<ul>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#local-levelモデル-2"><i class="fa fa-check"></i>local levelモデル</a></li>
<li class="chapter" data-level="" data-path="動的線形モデル.html"><a href="動的線形モデル.html#確率的季節性成分を持つドリフト有りランダムウォークモデル"><i class="fa fa-check"></i>確率的季節性成分を持つドリフト有りランダムウォーク・モデル</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix 参考文献</b></span></li>
<li class="chapter" data-level="A" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html"><i class="fa fa-check"></i><b>A</b> バブル (生成・崩壊) 検出</a>
<ul>
<li class="chapter" data-level="A.1" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#検定法に関する最近のレビュー論文"><i class="fa fa-check"></i><b>A.1</b> 検定法に関する最近のレビュー論文</a></li>
<li class="chapter" data-level="A.2" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#supreme-adf検定sadf-pwy-2011-generalized-supreme-adf-検定gsadf-psy-2015"><i class="fa fa-check"></i><b>A.2</b> Supreme ADF検定/SADF (PWY, 2011), Generalized supreme ADF 検定/GSADF (PSY, 2015)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#数理ファイナンス-jarrow-protterら"><i class="fa fa-check"></i><b>A.2.1</b> 数理ファイナンス (Jarrow, Protterら)</a></li>
<li class="chapter" data-level="A.2.2" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#経済物理学-sornetteら"><i class="fa fa-check"></i><b>A.2.2</b> 経済物理学 (Sornetteら)</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#実証分析"><i class="fa fa-check"></i><b>A.3</b> 実証分析</a>
<ul>
<li class="chapter" data-level="" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#株式市場の例"><i class="fa fa-check"></i>株式市場の例</a></li>
<li class="chapter" data-level="" data-path="バブル-生成崩壊-検出.html"><a href="バブル-生成崩壊-検出.html#暗号資産市場の例"><i class="fa fa-check"></i>暗号資産市場の例</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html"><i class="fa fa-check"></i><b>B</b> 長期記憶過程</a>
<ul>
<li class="chapter" data-level="B.1" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#理論概説"><i class="fa fa-check"></i><b>B.1</b> 理論・概説</a></li>
<li class="chapter" data-level="B.2" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#株式市場"><i class="fa fa-check"></i><b>B.2</b> 株式市場</a></li>
<li class="chapter" data-level="B.3" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#外国為替市場"><i class="fa fa-check"></i><b>B.3</b> 外国為替市場</a></li>
<li class="chapter" data-level="B.4" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#コモディティ暗号資産"><i class="fa fa-check"></i><b>B.4</b> コモディティ・暗号資産</a></li>
<li class="chapter" data-level="B.5" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#vix"><i class="fa fa-check"></i><b>B.5</b> VIX</a></li>
<li class="chapter" data-level="B.6" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#高頻度データ-ボラティリティ-注文フロー等"><i class="fa fa-check"></i><b>B.6</b> 高頻度データ (ボラティリティ, 注文フロー等)</a></li>
<li class="chapter" data-level="B.7" data-path="長期記憶過程-1.html"><a href="長期記憶過程-1.html#長期記憶性の発生要因-非長期記憶モデルによる近似"><i class="fa fa-check"></i><b>B.7</b> 長期記憶性の発生要因, 非長期記憶モデルによる近似</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html"><i class="fa fa-check"></i><b>C</b> Markov switching/ regime switchingモデル</a>
<ul>
<li class="chapter" data-level="C.1" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#理論概説-1"><i class="fa fa-check"></i><b>C.1</b> 理論・概説</a></li>
<li class="chapter" data-level="C.2" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#株式市場-1"><i class="fa fa-check"></i><b>C.2</b> 株式市場</a></li>
<li class="chapter" data-level="C.3" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#金利債券市場"><i class="fa fa-check"></i><b>C.3</b> 金利・債券市場</a></li>
<li class="chapter" data-level="C.4" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#外国為替市場-1"><i class="fa fa-check"></i><b>C.4</b> 外国為替市場</a></li>
<li class="chapter" data-level="C.5" data-path="markov-switching-regime-switchingモデル.html"><a href="markov-switching-regime-switchingモデル.html#アセットアロケーション"><i class="fa fa-check"></i><b>C.5</b> アセット・アロケーション</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="archgarchモデル.html"><a href="archgarchモデル.html"><i class="fa fa-check"></i><b>D</b> ARCH/GARCHモデル</a>
<ul>
<li class="chapter" data-level="D.1" data-path="archgarchモデル.html"><a href="archgarchモデル.html#概説"><i class="fa fa-check"></i><b>D.1</b> 概説</a></li>
<li class="chapter" data-level="D.2" data-path="archgarchモデル.html"><a href="archgarchモデル.html#arch-model"><i class="fa fa-check"></i><b>D.2</b> ARCH model</a></li>
<li class="chapter" data-level="D.3" data-path="archgarchモデル.html"><a href="archgarchモデル.html#garch-model"><i class="fa fa-check"></i><b>D.3</b> GARCH model</a></li>
<li class="chapter" data-level="D.4" data-path="archgarchモデル.html"><a href="archgarchモデル.html#arch-m-model"><i class="fa fa-check"></i><b>D.4</b> ARCH-M Model</a></li>
<li class="chapter" data-level="D.5" data-path="archgarchモデル.html"><a href="archgarchモデル.html#gjr-model"><i class="fa fa-check"></i><b>D.5</b> GJR model</a></li>
<li class="chapter" data-level="D.6" data-path="archgarchモデル.html"><a href="archgarchモデル.html#aparch-model"><i class="fa fa-check"></i><b>D.6</b> APARCH model</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html"><i class="fa fa-check"></i><b>E</b> 共和分/ 誤差修正モデル</a>
<ul>
<li class="chapter" data-level="E.1" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html#株式市場とマクロ変数-国際株式市場間の分析"><i class="fa fa-check"></i><b>E.1</b> 株式市場とマクロ変数, 国際株式市場間の分析</a></li>
<li class="chapter" data-level="E.2" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html#個別株式の複数取引所株価間の分析"><i class="fa fa-check"></i><b>E.2</b> 個別株式の複数取引所株価間の分析</a></li>
<li class="chapter" data-level="E.3" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html#高頻度データ-bidask価格-の分析"><i class="fa fa-check"></i><b>E.3</b> 高頻度データ (bid/ask価格) の分析</a></li>
<li class="chapter" data-level="E.4" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html#統計的アービトラージ-ペアトレード"><i class="fa fa-check"></i><b>E.4</b> 統計的アービトラージ / ペアトレード</a></li>
<li class="chapter" data-level="E.5" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html#国際株式市場間のヘッジ"><i class="fa fa-check"></i><b>E.5</b> 国際株式市場間のヘッジ</a></li>
<li class="chapter" data-level="E.6" data-path="共和分-誤差修正モデル.html"><a href="共和分-誤差修正モデル.html#クレジットスプレッド-株式-cds-債券-の分析"><i class="fa fa-check"></i><b>E.6</b> クレジット・スプレッド (株式, CDS, 債券) の分析</a></li>
</ul></li>
<li class="chapter" data-level="F" data-path="今後の学習のために.html"><a href="今後の学習のために.html"><i class="fa fa-check"></i><b>F</b> 今後の学習のために</a>
<ul>
<li class="chapter" data-level="F.1" data-path="今後の学習のために.html"><a href="今後の学習のために.html#ai機械学習と時系列解析"><i class="fa fa-check"></i><b>F.1</b> AI/機械学習と時系列解析</a></li>
<li class="chapter" data-level="F.2" data-path="今後の学習のために.html"><a href="今後の学習のために.html#カテゴリーデータや整数値データ等に対する時系列解析"><i class="fa fa-check"></i><b>F.2</b> カテゴリーデータや整数値データ等に対する時系列解析</a></li>
<li class="chapter" data-level="F.3" data-path="今後の学習のために.html"><a href="今後の学習のために.html#状態空間モデル動的線形モデル"><i class="fa fa-check"></i><b>F.3</b> 状態空間モデル・動的線形モデル</a></li>
<li class="chapter" data-level="F.4" data-path="今後の学習のために.html"><a href="今後の学習のために.html#その他"><i class="fa fa-check"></i><b>F.4</b> その他</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">金融時系列解析</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="動的線形モデル" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">14</span> 動的線形モデル<a href="動的線形モデル.html#動的線形モデル" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では, 動的線形モデル (Dynamic Linear Models) を扱うRパッケージを幾つか取り上げ, 利用方法を紹介する.
特に, 共通のデータセット (ナイル川の年間流量) に対する共通のモデル (local levelモデル, ランダムウォーク+ノイズ・モデル) を用いて, 各々のパッケージにおける操作 (フィルタリング・平滑化 (スムージング)・予測等) を行い, 使い勝手を比較する.</p>
<pre><code>- Nileデータセット
  - アスワン (Aswan) におけるナイル川の年間流量の計測量
  - 1871--1970年 (単位 10^8立方メートル)
  - 1898年付近に変化点が見られる (Cobb(1978), Table 1, p.249）</code></pre>
<div id="パッケージdlm" class="section level2 hasAnchor" number="14.1">
<h2><span class="header-section-number">14.1</span> パッケージ<strong>dlm</strong><a href="動的線形モデル.html#パッケージdlm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>出所:
<ul>
<li>Petris, Petrone, and Campagnoli (2009). Dynamic Linear Models with R. Springer.</li>
</ul></li>
</ul>
<p>パッケージ<strong>dlm</strong>について:
- 動的線形モデル (DLM) のベイズ分析用パッケージ
- DLMのパラメータの最尤推定とカルマン・フィルターの関数を含む</p>
<pre><code>- dlm()関数: Dynamic Linear Objectsの生成
  - dlmModReg()関数: 線形回帰モデルのDLM表現
  
  - dlmModPoly()関数: $n$-次多項式DLM表現
    - order=1: local level(ランダムウォーク+ノイズ)
    - order=2: stochastic linear trend (局所線形トレンドモデル)(デフォルト)
    
  - dlmModSeas()関数: 季節成分のDLM表現
  - dlmModTrig()関数: 周期成分のDLM表現
  - dlmModARMA()関数: (多変量)ARMA過程のDLM表現</code></pre>
<pre><code>- dlmModReg()関数
    - dV: 観測ノイズ$V$
    - dW: システムノイズの共分散行列$W$対角成分
    - m0: 状態ベクトル初期値の期待値$m0$
    - C0: 状態ベクトル初期値の共分散行列$C0$</code></pre>
<ul>
<li>以下の実行結果の解説, Petris, et al.(2009), Ch.2を参照</li>
</ul>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="動的線形モデル.html#cb982-1" tabindex="-1"></a><span class="fu">library</span>(dlm)</span>
<span id="cb982-2"><a href="動的線形モデル.html#cb982-2" tabindex="-1"></a><span class="do">## Linear regression as a DLM</span></span>
<span id="cb982-3"><a href="動的線形モデル.html#cb982-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>),<span class="at">ncol =</span> <span class="dv">2</span>) <span class="co"># 説明変数 (デザイン行列)</span></span>
<span id="cb982-4"><a href="動的線形モデル.html#cb982-4" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">dlmModReg</span>(x)</span>
<span id="cb982-5"><a href="動的線形モデル.html#cb982-5" tabindex="-1"></a><span class="co"># is.dlm(mod)</span></span>
<span id="cb982-6"><a href="動的線形モデル.html#cb982-6" tabindex="-1"></a>mod</span>
<span id="cb982-7"><a href="動的線形モデル.html#cb982-7" tabindex="-1"></a><span class="do">## $FF</span></span>
<span id="cb982-8"><a href="動的線形モデル.html#cb982-8" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb982-9"><a href="動的線形モデル.html#cb982-9" tabindex="-1"></a><span class="do">## [1,]    1    1    1</span></span>
<span id="cb982-10"><a href="動的線形モデル.html#cb982-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-11"><a href="動的線形モデル.html#cb982-11" tabindex="-1"></a><span class="do">## $V</span></span>
<span id="cb982-12"><a href="動的線形モデル.html#cb982-12" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb982-13"><a href="動的線形モデル.html#cb982-13" tabindex="-1"></a><span class="do">## [1,]    1</span></span>
<span id="cb982-14"><a href="動的線形モデル.html#cb982-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-15"><a href="動的線形モデル.html#cb982-15" tabindex="-1"></a><span class="do">## $GG</span></span>
<span id="cb982-16"><a href="動的線形モデル.html#cb982-16" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb982-17"><a href="動的線形モデル.html#cb982-17" tabindex="-1"></a><span class="do">## [1,]    1    0    0</span></span>
<span id="cb982-18"><a href="動的線形モデル.html#cb982-18" tabindex="-1"></a><span class="do">## [2,]    0    1    0</span></span>
<span id="cb982-19"><a href="動的線形モデル.html#cb982-19" tabindex="-1"></a><span class="do">## [3,]    0    0    1</span></span>
<span id="cb982-20"><a href="動的線形モデル.html#cb982-20" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-21"><a href="動的線形モデル.html#cb982-21" tabindex="-1"></a><span class="do">## $W</span></span>
<span id="cb982-22"><a href="動的線形モデル.html#cb982-22" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb982-23"><a href="動的線形モデル.html#cb982-23" tabindex="-1"></a><span class="do">## [1,]    0    0    0</span></span>
<span id="cb982-24"><a href="動的線形モデル.html#cb982-24" tabindex="-1"></a><span class="do">## [2,]    0    0    0</span></span>
<span id="cb982-25"><a href="動的線形モデル.html#cb982-25" tabindex="-1"></a><span class="do">## [3,]    0    0    0</span></span>
<span id="cb982-26"><a href="動的線形モデル.html#cb982-26" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-27"><a href="動的線形モデル.html#cb982-27" tabindex="-1"></a><span class="do">## $JFF</span></span>
<span id="cb982-28"><a href="動的線形モデル.html#cb982-28" tabindex="-1"></a><span class="do">##      [,1] [,2] [,3]</span></span>
<span id="cb982-29"><a href="動的線形モデル.html#cb982-29" tabindex="-1"></a><span class="do">## [1,]    0    1    2</span></span>
<span id="cb982-30"><a href="動的線形モデル.html#cb982-30" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-31"><a href="動的線形モデル.html#cb982-31" tabindex="-1"></a><span class="do">## $X</span></span>
<span id="cb982-32"><a href="動的線形モデル.html#cb982-32" tabindex="-1"></a><span class="do">##      [,1]   [,2]   </span></span>
<span id="cb982-33"><a href="動的線形モデル.html#cb982-33" tabindex="-1"></a><span class="do">## [1,] 0.2349 -0.5491</span></span>
<span id="cb982-34"><a href="動的線形モデル.html#cb982-34" tabindex="-1"></a><span class="do">## [2,] -2.06  -1.161 </span></span>
<span id="cb982-35"><a href="動的線形モデル.html#cb982-35" tabindex="-1"></a><span class="do">## [3,] ...           </span></span>
<span id="cb982-36"><a href="動的線形モデル.html#cb982-36" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-37"><a href="動的線形モデル.html#cb982-37" tabindex="-1"></a><span class="do">## $m0</span></span>
<span id="cb982-38"><a href="動的線形モデル.html#cb982-38" tabindex="-1"></a><span class="do">## [1] 0 0 0</span></span>
<span id="cb982-39"><a href="動的線形モデル.html#cb982-39" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb982-40"><a href="動的線形モデル.html#cb982-40" tabindex="-1"></a><span class="do">## $C0</span></span>
<span id="cb982-41"><a href="動的線形モデル.html#cb982-41" tabindex="-1"></a><span class="do">##       [,1]  [,2]  [,3]</span></span>
<span id="cb982-42"><a href="動的線形モデル.html#cb982-42" tabindex="-1"></a><span class="do">## [1,] 1e+07 0e+00 0e+00</span></span>
<span id="cb982-43"><a href="動的線形モデル.html#cb982-43" tabindex="-1"></a><span class="do">## [2,] 0e+00 1e+07 0e+00</span></span>
<span id="cb982-44"><a href="動的線形モデル.html#cb982-44" tabindex="-1"></a><span class="do">## [3,] 0e+00 0e+00 1e+07</span></span>
<span id="cb982-45"><a href="動的線形モデル.html#cb982-45" tabindex="-1"></a><span class="do">## Adding dlm&#39;s</span></span>
<span id="cb982-46"><a href="動的線形モデル.html#cb982-46" tabindex="-1"></a><span class="co"># dlmModPoly() + dlmModSeas(4) # linear trend plus quarterly seasonal component</span></span></code></pre></div>
<pre><code>- dlmModPoly()関数: $n$-次多項式DLMの生成
  - order=1: local level(ランダムウォーク+ノイズ)
  - order=2: stochastic linear trend (局所線形トレンドモデル)(デフォルト)</code></pre>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="動的線形モデル.html#cb984-1" tabindex="-1"></a><span class="do">## the default</span></span>
<span id="cb984-2"><a href="動的線形モデル.html#cb984-2" tabindex="-1"></a><span class="fu">dlmModPoly</span>()</span>
<span id="cb984-3"><a href="動的線形モデル.html#cb984-3" tabindex="-1"></a><span class="do">## $FF</span></span>
<span id="cb984-4"><a href="動的線形モデル.html#cb984-4" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb984-5"><a href="動的線形モデル.html#cb984-5" tabindex="-1"></a><span class="do">## [1,]    1    0</span></span>
<span id="cb984-6"><a href="動的線形モデル.html#cb984-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-7"><a href="動的線形モデル.html#cb984-7" tabindex="-1"></a><span class="do">## $V</span></span>
<span id="cb984-8"><a href="動的線形モデル.html#cb984-8" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb984-9"><a href="動的線形モデル.html#cb984-9" tabindex="-1"></a><span class="do">## [1,]    1</span></span>
<span id="cb984-10"><a href="動的線形モデル.html#cb984-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-11"><a href="動的線形モデル.html#cb984-11" tabindex="-1"></a><span class="do">## $GG</span></span>
<span id="cb984-12"><a href="動的線形モデル.html#cb984-12" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb984-13"><a href="動的線形モデル.html#cb984-13" tabindex="-1"></a><span class="do">## [1,]    1    1</span></span>
<span id="cb984-14"><a href="動的線形モデル.html#cb984-14" tabindex="-1"></a><span class="do">## [2,]    0    1</span></span>
<span id="cb984-15"><a href="動的線形モデル.html#cb984-15" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-16"><a href="動的線形モデル.html#cb984-16" tabindex="-1"></a><span class="do">## $W</span></span>
<span id="cb984-17"><a href="動的線形モデル.html#cb984-17" tabindex="-1"></a><span class="do">##      [,1] [,2]</span></span>
<span id="cb984-18"><a href="動的線形モデル.html#cb984-18" tabindex="-1"></a><span class="do">## [1,]    0    0</span></span>
<span id="cb984-19"><a href="動的線形モデル.html#cb984-19" tabindex="-1"></a><span class="do">## [2,]    0    1</span></span>
<span id="cb984-20"><a href="動的線形モデル.html#cb984-20" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-21"><a href="動的線形モデル.html#cb984-21" tabindex="-1"></a><span class="do">## $m0</span></span>
<span id="cb984-22"><a href="動的線形モデル.html#cb984-22" tabindex="-1"></a><span class="do">## [1] 0 0</span></span>
<span id="cb984-23"><a href="動的線形モデル.html#cb984-23" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-24"><a href="動的線形モデル.html#cb984-24" tabindex="-1"></a><span class="do">## $C0</span></span>
<span id="cb984-25"><a href="動的線形モデル.html#cb984-25" tabindex="-1"></a><span class="do">##       [,1]  [,2]</span></span>
<span id="cb984-26"><a href="動的線形モデル.html#cb984-26" tabindex="-1"></a><span class="do">## [1,] 1e+07 0e+00</span></span>
<span id="cb984-27"><a href="動的線形モデル.html#cb984-27" tabindex="-1"></a><span class="do">## [2,] 0e+00 1e+07</span></span>
<span id="cb984-28"><a href="動的線形モデル.html#cb984-28" tabindex="-1"></a><span class="do">## random walk plus noise</span></span>
<span id="cb984-29"><a href="動的線形モデル.html#cb984-29" tabindex="-1"></a><span class="fu">dlmModPoly</span>(<span class="dv">1</span>, <span class="at">dV =</span> .<span class="dv">3</span>, <span class="at">dW =</span> .<span class="dv">01</span>)</span>
<span id="cb984-30"><a href="動的線形モデル.html#cb984-30" tabindex="-1"></a><span class="do">## $FF</span></span>
<span id="cb984-31"><a href="動的線形モデル.html#cb984-31" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb984-32"><a href="動的線形モデル.html#cb984-32" tabindex="-1"></a><span class="do">## [1,]    1</span></span>
<span id="cb984-33"><a href="動的線形モデル.html#cb984-33" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-34"><a href="動的線形モデル.html#cb984-34" tabindex="-1"></a><span class="do">## $V</span></span>
<span id="cb984-35"><a href="動的線形モデル.html#cb984-35" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb984-36"><a href="動的線形モデル.html#cb984-36" tabindex="-1"></a><span class="do">## [1,]  0.3</span></span>
<span id="cb984-37"><a href="動的線形モデル.html#cb984-37" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-38"><a href="動的線形モデル.html#cb984-38" tabindex="-1"></a><span class="do">## $GG</span></span>
<span id="cb984-39"><a href="動的線形モデル.html#cb984-39" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb984-40"><a href="動的線形モデル.html#cb984-40" tabindex="-1"></a><span class="do">## [1,]    1</span></span>
<span id="cb984-41"><a href="動的線形モデル.html#cb984-41" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-42"><a href="動的線形モデル.html#cb984-42" tabindex="-1"></a><span class="do">## $W</span></span>
<span id="cb984-43"><a href="動的線形モデル.html#cb984-43" tabindex="-1"></a><span class="do">##      [,1]</span></span>
<span id="cb984-44"><a href="動的線形モデル.html#cb984-44" tabindex="-1"></a><span class="do">## [1,] 0.01</span></span>
<span id="cb984-45"><a href="動的線形モデル.html#cb984-45" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-46"><a href="動的線形モデル.html#cb984-46" tabindex="-1"></a><span class="do">## $m0</span></span>
<span id="cb984-47"><a href="動的線形モデル.html#cb984-47" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb984-48"><a href="動的線形モデル.html#cb984-48" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb984-49"><a href="動的線形モデル.html#cb984-49" tabindex="-1"></a><span class="do">## $C0</span></span>
<span id="cb984-50"><a href="動的線形モデル.html#cb984-50" tabindex="-1"></a><span class="do">##       [,1]</span></span>
<span id="cb984-51"><a href="動的線形モデル.html#cb984-51" tabindex="-1"></a><span class="do">## [1,] 1e+07</span></span></code></pre></div>
<div id="local-levelモデル" class="section level3 unnumbered hasAnchor">
<h3>local levelモデル<a href="動的線形モデル.html#local-levelモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>cf. <a href="https://kevinkotze.github.io/ts-4-tut/" class="uri">https://kevinkotze.github.io/ts-4-tut/</a></li>
<li>local level modelの例</li>
</ul>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="動的線形モデル.html#cb985-1" tabindex="-1"></a><span class="fu">ts.plot</span>(Nile)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile-1.png" width="75%" /></p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="動的線形モデル.html#cb986-1" tabindex="-1"></a>NilePoly <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">1468</span>)</span>
<span id="cb986-2"><a href="動的線形モデル.html#cb986-2" tabindex="-1"></a><span class="fu">unlist</span>(NilePoly)</span>
<span id="cb986-3"><a href="動的線形モデル.html#cb986-3" tabindex="-1"></a><span class="do">##       m0       C0       FF        V       GG        W </span></span>
<span id="cb986-4"><a href="動的線形モデル.html#cb986-4" tabindex="-1"></a><span class="do">##        0 10000000        1    15100        1     1468</span></span></code></pre></div>
<ul>
<li>フィルタリング
<ul>
<li>最新の観測値に基づいて, 現在の状態を推定</li>
<li>Kalman filterによる, 状態空間ベクトルのフィルター値と, 分散共分散行列の計算</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="動的線形モデル.html#cb987-1" tabindex="-1"></a>NileFilt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, NilePoly)</span>
<span id="cb987-2"><a href="動的線形モデル.html#cb987-2" tabindex="-1"></a><span class="co">#str(NileFilt, 1)</span></span>
<span id="cb987-3"><a href="動的線形モデル.html#cb987-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(Nile)</span>
<span id="cb987-4"><a href="動的線形モデル.html#cb987-4" tabindex="-1"></a><span class="fu">attach</span>(NileFilt)</span>
<span id="cb987-5"><a href="動的線形モデル.html#cb987-5" tabindex="-1"></a><span class="co">#dlmSvd2var(U.C[[n + 1]], D.C[n + 1, ])</span></span></code></pre></div>
<ul>
<li>S/N比 (<span class="math inline">\(W/V\)</span>), Kalman”ゲイン”を決める重要な要因
<ul>
<li>観測値の変動に対する状態の(事前→事後)更新の感応度合い</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="動的線形モデル.html#cb988-1" tabindex="-1"></a><span class="fu">plot</span>(Nile, <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>),</span>
<span id="cb988-2"><a href="動的線形モデル.html#cb988-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>)</span>
<span id="cb988-3"><a href="動的線形モデル.html#cb988-3" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">755</span>)</span>
<span id="cb988-4"><a href="動的線形モデル.html#cb988-4" tabindex="-1"></a>NileFilt1 <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, mod1)</span>
<span id="cb988-5"><a href="動的線形モデル.html#cb988-5" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(NileFilt1<span class="sc">$</span>m), <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb988-6"><a href="動的線形モデル.html#cb988-6" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">7550</span>)</span>
<span id="cb988-7"><a href="動的線形モデル.html#cb988-7" tabindex="-1"></a>NileFilt2 <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, mod2)</span>
<span id="cb988-8"><a href="動的線形モデル.html#cb988-8" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(NileFilt2<span class="sc">$</span>m), <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb988-9"><a href="動的線形モデル.html#cb988-9" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;filtered,  W/V =&quot;</span>,</span>
<span id="cb988-10"><a href="動的線形モデル.html#cb988-10" tabindex="-1"></a>                       <span class="fu">format</span>(<span class="fu">c</span>(<span class="fu">W</span>(mod1) <span class="sc">/</span> <span class="fu">V</span>(mod1),</span>
<span id="cb988-11"><a href="動的線形モデル.html#cb988-11" tabindex="-1"></a>                                <span class="fu">W</span>(mod2) <span class="sc">/</span> <span class="fu">V</span>(mod2)))))</span>
<span id="cb988-12"><a href="動的線形モデル.html#cb988-12" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> leg,</span>
<span id="cb988-13"><a href="動的線形モデル.html#cb988-13" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb988-14"><a href="動的線形モデル.html#cb988-14" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotdash&quot;</span>),</span>
<span id="cb988-15"><a href="動的線形モデル.html#cb988-15" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_Filter2-1.png" width="75%" /></p>
<ul>
<li>スムージング (平滑化)
<ul>
<li>最新時点までの全観測値を使い, 過去の全時点の状態を推定(し直す)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="動的線形モデル.html#cb989-1" tabindex="-1"></a>NileSmooth <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(NileFilt)</span>
<span id="cb989-2"><a href="動的線形モデル.html#cb989-2" tabindex="-1"></a><span class="fu">str</span>(NileSmooth, <span class="dv">1</span>)</span>
<span id="cb989-3"><a href="動的線形モデル.html#cb989-3" tabindex="-1"></a><span class="do">## List of 3</span></span>
<span id="cb989-4"><a href="動的線形モデル.html#cb989-4" tabindex="-1"></a><span class="do">##  $ s  : Time-Series [1:101] from 1870 to 1970: 1111 1111 1111 1105 1113 ...</span></span>
<span id="cb989-5"><a href="動的線形モデル.html#cb989-5" tabindex="-1"></a><span class="do">##  $ U.S:List of 101</span></span>
<span id="cb989-6"><a href="動的線形モデル.html#cb989-6" tabindex="-1"></a><span class="do">##  $ D.S: num [1:101, 1] 74.1 63.5 56.9 53.1 50.9 ...</span></span>
<span id="cb989-7"><a href="動的線形モデル.html#cb989-7" tabindex="-1"></a><span class="fu">attach</span>(NileSmooth)</span>
<span id="cb989-8"><a href="動的線形モデル.html#cb989-8" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.S[[n <span class="sc">+</span> <span class="dv">1</span>]], D.S[n <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb989-9"><a href="動的線形モデル.html#cb989-9" tabindex="-1"></a><span class="do">## [1] 4031.035</span></span>
<span id="cb989-10"><a href="動的線形モデル.html#cb989-10" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.C[[n <span class="sc">+</span> <span class="dv">1</span>]], D.C[n <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb989-11"><a href="動的線形モデル.html#cb989-11" tabindex="-1"></a><span class="do">## [1] 4031.035</span></span>
<span id="cb989-12"><a href="動的線形モデル.html#cb989-12" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.S[[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>]], D.S[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb989-13"><a href="動的線形モデル.html#cb989-13" tabindex="-1"></a><span class="do">## [1] 2325.985</span></span>
<span id="cb989-14"><a href="動的線形モデル.html#cb989-14" tabindex="-1"></a><span class="fu">drop</span>(<span class="fu">dlmSvd2var</span>(U.C[[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>]], D.C[n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>,]))</span>
<span id="cb989-15"><a href="動的線形モデル.html#cb989-15" tabindex="-1"></a><span class="do">## [1] 4031.035</span></span>
<span id="cb989-16"><a href="動的線形モデル.html#cb989-16" tabindex="-1"></a>hwid <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, <span class="at">lower =</span> <span class="cn">FALSE</span>) <span class="sc">*</span></span>
<span id="cb989-17"><a href="動的線形モデル.html#cb989-17" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">unlist</span>(<span class="fu">dlmSvd2var</span>(U.S, D.S)))</span>
<span id="cb989-18"><a href="動的線形モデル.html#cb989-18" tabindex="-1"></a>smooth <span class="ot">&lt;-</span> <span class="fu">cbind</span>(s, <span class="fu">as.vector</span>(s) <span class="sc">+</span> hwid <span class="sc">%o%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb989-19"><a href="動的線形モデル.html#cb989-19" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dropFirst</span>(smooth), <span class="at">plot.type =</span> <span class="st">&quot;s&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb989-20"><a href="動的線形モデル.html#cb989-20" tabindex="-1"></a>     <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb989-21"><a href="動的線形モデル.html#cb989-21" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(Nile))</span>
<span id="cb989-22"><a href="動的線形モデル.html#cb989-22" tabindex="-1"></a><span class="fu">lines</span>(Nile, <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb989-23"><a href="動的線形モデル.html#cb989-23" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">2</span>)),</span>
<span id="cb989-24"><a href="動的線形モデル.html#cb989-24" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb989-25"><a href="動的線形モデル.html#cb989-25" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;smoothed level&quot;</span>,</span>
<span id="cb989-26"><a href="動的線形モデル.html#cb989-26" tabindex="-1"></a>       <span class="st">&quot;95% probability limits&quot;</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_Smoothing-1.png" width="75%" /></p>
<ul>
<li>予測</li>
</ul>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="動的線形モデル.html#cb990-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">window</span>(<span class="fu">cbind</span>(Nile, NileFilt1<span class="sc">$</span>f, NileFilt2<span class="sc">$</span>f),</span>
<span id="cb990-2"><a href="動的線形モデル.html#cb990-2" tabindex="-1"></a>            <span class="at">start =</span> <span class="dv">1880</span>, <span class="at">end =</span> <span class="dv">1920</span>)</span>
<span id="cb990-3"><a href="動的線形モデル.html#cb990-3" tabindex="-1"></a><span class="fu">plot</span>(a[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>,</span>
<span id="cb990-4"><a href="動的線形モデル.html#cb990-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>)</span>
<span id="cb990-5"><a href="動的線形モデル.html#cb990-5" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">2</span>], <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb990-6"><a href="動的線形モデル.html#cb990-6" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">3</span>], <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb990-7"><a href="動的線形モデル.html#cb990-7" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;one-step-ahead forecast,  W/V =&quot;</span>,</span>
<span id="cb990-8"><a href="動的線形モデル.html#cb990-8" tabindex="-1"></a>                       <span class="fu">format</span>(<span class="fu">c</span>(<span class="fu">W</span>(mod1) <span class="sc">/</span> <span class="fu">V</span>(mod1),</span>
<span id="cb990-9"><a href="動的線形モデル.html#cb990-9" tabindex="-1"></a>                                <span class="fu">W</span>(mod2) <span class="sc">/</span> <span class="fu">V</span>(mod2)))))</span>
<span id="cb990-10"><a href="動的線形モデル.html#cb990-10" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> leg,</span>
<span id="cb990-11"><a href="動的線形モデル.html#cb990-11" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb990-12"><a href="動的線形モデル.html#cb990-12" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotdash&quot;</span>),</span>
<span id="cb990-13"><a href="動的線形モデル.html#cb990-13" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_forecast-1.png" width="75%" /></p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="動的線形モデル.html#cb991-1" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> <span class="dv">15100</span>, <span class="at">dW =</span> <span class="dv">1468</span>)</span>
<span id="cb991-2"><a href="動的線形モデル.html#cb991-2" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">matrix</span>(mod0<span class="sc">$</span>W, <span class="at">nc =</span> <span class="dv">1</span>, <span class="at">nr =</span> <span class="fu">length</span>(Nile)),</span>
<span id="cb991-3"><a href="動的線形モデル.html#cb991-3" tabindex="-1"></a>        <span class="at">start =</span> <span class="fu">start</span>(Nile))</span>
<span id="cb991-4"><a href="動的線形モデル.html#cb991-4" tabindex="-1"></a><span class="fu">window</span>(X, <span class="dv">1898</span>, <span class="dv">1899</span>) <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">*</span> mod0<span class="sc">$</span>W</span>
<span id="cb991-5"><a href="動的線形モデル.html#cb991-5" tabindex="-1"></a>modDam <span class="ot">&lt;-</span> mod0</span>
<span id="cb991-6"><a href="動的線形モデル.html#cb991-6" tabindex="-1"></a>modDam<span class="sc">$</span>X <span class="ot">&lt;-</span> X</span>
<span id="cb991-7"><a href="動的線形モデル.html#cb991-7" tabindex="-1"></a>modDam<span class="sc">$</span>JW <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb991-8"><a href="動的線形モデル.html#cb991-8" tabindex="-1"></a>damFilt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, modDam)</span>
<span id="cb991-9"><a href="動的線形モデル.html#cb991-9" tabindex="-1"></a>mod0Filt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(Nile, mod0)</span>
<span id="cb991-10"><a href="動的線形モデル.html#cb991-10" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">window</span>(<span class="fu">cbind</span>(Nile, mod0Filt<span class="sc">$</span>f, damFilt<span class="sc">$</span>f),</span>
<span id="cb991-11"><a href="動的線形モデル.html#cb991-11" tabindex="-1"></a>            <span class="at">start =</span> <span class="dv">1880</span>, <span class="at">end =</span> <span class="dv">1920</span>)</span>
<span id="cb991-12"><a href="動的線形モデル.html#cb991-12" tabindex="-1"></a><span class="fu">plot</span>(a[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>,</span>
<span id="cb991-13"><a href="動的線形モデル.html#cb991-13" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Level&quot;</span>)</span>
<span id="cb991-14"><a href="動的線形モデル.html#cb991-14" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">2</span>], <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb991-15"><a href="動的線形モデル.html#cb991-15" tabindex="-1"></a><span class="fu">lines</span>(a[, <span class="dv">3</span>], <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb991-16"><a href="動的線形モデル.html#cb991-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1898</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb991-17"><a href="動的線形モデル.html#cb991-17" tabindex="-1"></a>leg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;one-step-ahead forecast -&quot;</span>,</span>
<span id="cb991-18"><a href="動的線形モデル.html#cb991-18" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="st">&quot;mod0&quot;</span>, <span class="st">&quot;modDam&quot;</span>)))</span>
<span id="cb991-19"><a href="動的線形モデル.html#cb991-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> leg,</span>
<span id="cb991-20"><a href="動的線形モデル.html#cb991-20" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb991-21"><a href="動的線形モデル.html#cb991-21" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;longdash&quot;</span>, <span class="st">&quot;dotdash&quot;</span>),</span>
<span id="cb991-22"><a href="動的線形モデル.html#cb991-22" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_forecast2-1.png" width="75%" /></p>
<ul>
<li>モデル診断</li>
</ul>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="動的線形モデル.html#cb992-1" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(damFilt, <span class="at">sd =</span> <span class="cn">FALSE</span>))</span>
<span id="cb992-2"><a href="動的線形モデル.html#cb992-2" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(damFilt, <span class="at">sd =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_diag-1.png" width="75%" /></p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="動的線形モデル.html#cb993-1" tabindex="-1"></a><span class="fu">tsdiag</span>(damFilt)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/Nile_diag-2.png" width="75%" /></p>
</div>
<div id="local-level-plus-seasonal-componentモデル" class="section level3 unnumbered hasAnchor">
<h3>local level plus seasonal componentモデル<a href="動的線形モデル.html#local-level-plus-seasonal-componentモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データ2: 英国における耐久消費財の消費支出 (四半期ベース), 1957Q1–1967Q4, <em>Time Series Data Library</em>: <a href="https://robjhyndman.com/tsdl/" class="uri">https://robjhyndman.com/tsdl/</a>)</p>
<ul>
<li>出所: Petris, etal (2009), p.64–</li>
</ul>
<pre><code>- qconsum.dat
  - quarterly consumer expenditure
  - durable goods
  - all other goods and services
  - investment
  - inventory investment
  - imports of goods and services
  - gross domestic product
  - personal disposable income
- Source: (Hyndman (n.d.)</code></pre>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="動的線形モデル.html#cb995-1" tabindex="-1"></a>expd <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">read.table</span>(<span class="st">&quot;qconsum.dat&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>,</span>
<span id="cb995-2"><a href="動的線形モデル.html#cb995-2" tabindex="-1"></a>                      <span class="at">colClasses =</span> <span class="st">&quot;numeric&quot;</span>)[, <span class="dv">1</span>],</span>
<span id="cb995-3"><a href="動的線形モデル.html#cb995-3" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1957</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb995-4"><a href="動的線形モデル.html#cb995-4" tabindex="-1"></a>expd.dlm <span class="ot">&lt;-</span> <span class="fu">dlm</span>(<span class="at">m0 =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="at">C0 =</span> <span class="fl">1e8</span> <span class="sc">*</span> <span class="fu">diag</span>(<span class="dv">4</span>),</span>
<span id="cb995-5"><a href="動的線形モデル.html#cb995-5" tabindex="-1"></a>                <span class="at">FF =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nr =</span> <span class="dv">1</span>),</span>
<span id="cb995-6"><a href="動的線形モデル.html#cb995-6" tabindex="-1"></a>                <span class="at">V =</span> <span class="fl">1e-3</span>,</span>
<span id="cb995-7"><a href="動的線形モデル.html#cb995-7" tabindex="-1"></a>                <span class="at">GG =</span> <span class="fu">bdiag</span>(<span class="fu">matrix</span>(<span class="dv">1</span>),</span>
<span id="cb995-8"><a href="動的線形モデル.html#cb995-8" tabindex="-1"></a>                <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb995-9"><a href="動的線形モデル.html#cb995-9" tabindex="-1"></a>                       <span class="at">nr =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb995-10"><a href="動的線形モデル.html#cb995-10" tabindex="-1"></a>                <span class="at">W =</span> <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fl">771.35</span>, <span class="fl">86.48</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nr =</span> <span class="dv">4</span>))</span>
<span id="cb995-11"><a href="動的線形モデル.html#cb995-11" tabindex="-1"></a><span class="fu">plot</span>(expd, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Expenditures&quot;</span>, <span class="at">type =</span> <span class="st">&#39;o&#39;</span>,</span>
<span id="cb995-12"><a href="動的線形モデル.html#cb995-12" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb995-13"><a href="動的線形モデル.html#cb995-13" tabindex="-1"></a><span class="do">### Filter</span></span>
<span id="cb995-14"><a href="動的線形モデル.html#cb995-14" tabindex="-1"></a>expdFilt <span class="ot">&lt;-</span> <span class="fu">dlmFilter</span>(expd, expd.dlm)</span>
<span id="cb995-15"><a href="動的線形モデル.html#cb995-15" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(expdFilt<span class="sc">$</span>m[, <span class="dv">1</span>]), <span class="at">lty =</span> <span class="st">&quot;dotdash&quot;</span>)</span>
<span id="cb995-16"><a href="動的線形モデル.html#cb995-16" tabindex="-1"></a><span class="do">### Smooth</span></span>
<span id="cb995-17"><a href="動的線形モデル.html#cb995-17" tabindex="-1"></a>expdSmooth <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(expdFilt)</span>
<span id="cb995-18"><a href="動的線形モデル.html#cb995-18" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">dropFirst</span>(expdSmooth<span class="sc">$</span>s[,<span class="dv">1</span>]), <span class="at">lty =</span> <span class="st">&quot;longdash&quot;</span>)</span>
<span id="cb995-19"><a href="動的線形モデル.html#cb995-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkgrey&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="dv">2</span>)),</span>
<span id="cb995-20"><a href="動的線形モデル.html#cb995-20" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="st">&quot;solid&quot;</span>, <span class="st">&quot;dotdash&quot;</span>, <span class="st">&quot;longdash&quot;</span>),</span>
<span id="cb995-21"><a href="動的線形モデル.html#cb995-21" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb995-22"><a href="動的線形モデル.html#cb995-22" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;filtered level&quot;</span>, <span class="st">&quot;smoothed level&quot;</span>))</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/qconsum-1.png" width="75%" /></p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="動的線形モデル.html#cb996-1" tabindex="-1"></a><span class="do">### Seasonal component</span></span>
<span id="cb996-2"><a href="動的線形モデル.html#cb996-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">dropFirst</span>(expdSmooth<span class="sc">$</span>s[, <span class="dv">3</span>]), <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb996-3"><a href="動的線形モデル.html#cb996-3" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Expenditure - Seasonal component&quot;</span>)</span>
<span id="cb996-4"><a href="動的線形モデル.html#cb996-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/qconsum-2.png" width="75%" />
<!-- 注(9/3/22): plotとlineはchunkまたがるとエラーになる!? --></p>
<ul>
<li>予測</li>
</ul>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="動的線形モデル.html#cb997-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb997-2"><a href="動的線形モデル.html#cb997-2" tabindex="-1"></a>expdFore <span class="ot">&lt;-</span> <span class="fu">dlmForecast</span>(expdFilt, <span class="at">nAhead =</span> <span class="dv">12</span>, <span class="at">sampleNew =</span> <span class="dv">10</span>)</span>
<span id="cb997-3"><a href="動的線形モデル.html#cb997-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">window</span>(expd, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1964</span>, <span class="dv">1</span>)), <span class="at">type =</span> <span class="st">&#39;o&#39;</span>,</span>
<span id="cb997-4"><a href="動的線形モデル.html#cb997-4" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1964</span>, <span class="dv">1971</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">350</span>, <span class="dv">850</span>),</span>
<span id="cb997-5"><a href="動的線形モデル.html#cb997-5" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Expenditures&quot;</span>)</span>
<span id="cb997-6"><a href="動的線形モデル.html#cb997-6" tabindex="-1"></a><span class="fu">names</span>(expdFore)</span>
<span id="cb997-7"><a href="動的線形モデル.html#cb997-7" tabindex="-1"></a><span class="do">## [1] &quot;a&quot;         &quot;R&quot;         &quot;f&quot;         &quot;Q&quot;         &quot;newStates&quot; &quot;newObs&quot;</span></span>
<span id="cb997-8"><a href="動的線形モデル.html#cb997-8" tabindex="-1"></a><span class="fu">attach</span>(expdFore)</span>
<span id="cb997-9"><a href="動的線形モデル.html#cb997-9" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(newObs, <span class="cf">function</span>(x)</span>
<span id="cb997-10"><a href="動的線形モデル.html#cb997-10" tabindex="-1"></a>                 <span class="fu">lines</span>(x, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>,</span>
<span id="cb997-11"><a href="動的線形モデル.html#cb997-11" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">pch =</span> <span class="dv">4</span>)))</span>
<span id="cb997-12"><a href="動的線形モデル.html#cb997-12" tabindex="-1"></a><span class="fu">lines</span>(f, <span class="at">type =</span> <span class="st">&#39;o&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb997-13"><a href="動的線形モデル.html#cb997-13" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fu">time</span>(f)[<span class="dv">1</span>], <span class="fu">time</span>(expd)[<span class="fu">length</span>(expd)])),</span>
<span id="cb997-14"><a href="動的線形モデル.html#cb997-14" tabindex="-1"></a>       <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="130%E2%88%92dlm_files/figure-html/qconsum_forecast-1.png" width="75%" /></p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="動的線形モデル.html#cb998-1" tabindex="-1"></a><span class="fu">detach</span>()</span></code></pre></div>
<ul>
<li>その他
<ul>
<li>未知パラメータの推定(特に, <span class="math inline">\(V,W\)</span>)は, dlmMLE()関数により最尤推定が可能</li>
<li>代替法. ベイズ推定</li>
<li>詳細は, Petris, et al. (2009), Ch.4を参照のこと</li>
</ul></li>
</ul>
<div id="参考文献" class="section level4 unnumbered hasAnchor">
<h4>参考文献<a href="動的線形モデル.html#参考文献" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Giovanni Petris (2010). An R Package for Dynamic Linear Models. <em>Journal of Statistical Software</em>, 36(12), 1-16. <a href="http://www.jstatsoft.org/v36/i12/">http://www.jstatsoft.org/v36/i12/</a>.
<!--  - http://definetti.uark.edu/~gpetris/dlm/ (← 12/24/21時点, アクセス不可) --></p>

</div>
</div>
</div>
<div id="パッケージstatespacer" class="section level2 hasAnchor" number="14.2">
<h2><span class="header-section-number">14.2</span> パッケージ<strong>statespacer</strong><a href="動的線形モデル.html#パッケージstatespacer" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>出所: <a href="https://dylanb95.github.io/statespacer/articles/intro.html">Introduction to statespacer</a></li>
</ul>
<p>パッケージ<strong>statespacer</strong>について:</p>
<ul>
<li>状態空間モデルにおける以下の成分をカバー：
<ul>
<li>The Local Level</li>
<li>The Local Level + Slope</li>
<li>Smoothing Splines</li>
<li>Trigonometric Seasonality, BSM</li>
<li>(Business) Cycles</li>
<li>Explanatory Variables</li>
<li>Explanatory Variables with time-varying coefficients</li>
<li>Explanatory Variables in the Local Level</li>
<li>Explanatory Variables in the Local Level + Slope</li>
<li>ARIMA</li>
<li>SARIMA</li>
<li>独自に指定した成分</li>
</ul></li>
<li>これらの成分は, 一変量モデルにも多変量モデルにも使用可能. 成分を組み合わせることも可能.</li>
<li>各ユーザーは, 各成分の分散-共分散行列の形式をコントロールすることで, 成分を確率的ではなく非確率的に指定可能.</li>
<li>多変量の場合, 分散-共分散行列にランク制約を課すことで, 共通のレベルや傾きなど, 成分中の共通性が推定されるようにすることも可能.</li>
</ul>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="動的線形モデル.html#cb999-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;statespacer&quot;</span>)</span>
<span id="cb999-2"><a href="動的線形モデル.html#cb999-2" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb999-3"><a href="動的線形モデル.html#cb999-3" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;DylanB95/statespacer&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="動的線形モデル.html#cb1000-1" tabindex="-1"></a><span class="co"># Load statespacer</span></span>
<span id="cb1000-2"><a href="動的線形モデル.html#cb1000-2" tabindex="-1"></a><span class="fu">library</span>(statespacer)</span></code></pre></div>
<div id="local-levelモデル-1" class="section level3 unnumbered hasAnchor">
<h3>local levelモデル<a href="動的線形モデル.html#local-levelモデル-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ナイル川データセットに対して, local levelモデルを適用.
- local levelモデル. 観測変数 <span class="math inline">\(y_t\)</span> に対して,
<span class="math display">\[
y_t = \mu_t + \epsilon_t,\ \epsilon_t \sim 𝑁(0,\sigma^2_\epsilon) \\
\mu_{t+1}  = \mu_t + \eta_t,\ \eta_t \sim 𝑁(0,\sigma^2_\eta)
\]</span>
ここで, <span class="math inline">\(\mu_t\)</span>は時点<span class="math inline">\(t\)</span>における (未知の) 水準 (level), <span class="math inline">\(\epsilon_t,\eta_t\)</span>は攪乱項.
このモデルは, 二つの未知パラメータ<span class="math inline">\(\sigma^2_\epsilon,\sigma^2_\eta\)</span> (攪乱項の分散) を持ち, これらは最尤法により求められる. 状態変数 <span class="math inline">\(\mu_t\)</span> はKalman filterにより推定される.</p>
<ul>
<li>ナイル川データセットの読み込み</li>
</ul>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="動的線形モデル.html#cb1001-1" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb1001-2"><a href="動的線形モデル.html#cb1001-2" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb1001-3"><a href="動的線形モデル.html#cb1001-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Nile)</span></code></pre></div>
<ul>
<li>local levelモデルの適合</li>
</ul>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="動的線形モデル.html#cb1002-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">statespacer</span>(<span class="at">y =</span> y,</span>
<span id="cb1002-2"><a href="動的線形モデル.html#cb1002-2" tabindex="-1"></a>                   <span class="at">local_level_ind =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1002-3"><a href="動的線形モデル.html#cb1002-3" tabindex="-1"></a>                   <span class="at">initial =</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">var</span>(y)),</span>
<span id="cb1002-4"><a href="動的線形モデル.html#cb1002-4" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1002-5"><a href="動的線形モデル.html#cb1002-5" tabindex="-1"></a><span class="do">## Parameter scaling:[1] 1 1</span></span>
<span id="cb1002-6"><a href="動的線形モデル.html#cb1002-6" tabindex="-1"></a><span class="do">## initial  value 6.623273 </span></span>
<span id="cb1002-7"><a href="動的線形モデル.html#cb1002-7" tabindex="-1"></a><span class="do">## iter  10 value 6.334646</span></span>
<span id="cb1002-8"><a href="動的線形モデル.html#cb1002-8" tabindex="-1"></a><span class="do">## final  value 6.334646 </span></span>
<span id="cb1002-9"><a href="動的線形モデル.html#cb1002-9" tabindex="-1"></a><span class="do">## converged</span></span></code></pre></div>
<!-- 
初期パラメーターの数が足りないため, 警告メッセージが表示された. この関数は, 指定されたパラメーターを必要な回数だけ複製するだけなので, これは問題ない. この方法では, 必要なパラメータの数を気にする必要はない. また, 初期パラメータを多く指定することもでき, その場合は最初の数個だけが使われる. これは, ランダムな初期パラメータが欲しい場合に特に有効. 単にinitial = rnorm(1000)と指定するだけで, 十分なパラメータが与えられたかどうかを心配する必要はない.
-->
<ul>
<li>攪乱項の分散<span class="math inline">\(\sigma^2_\epsilon,\sigma^2_\eta\)</span>の推定値の確認.</li>
</ul>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="動的線形モデル.html#cb1003-1" tabindex="-1"></a><span class="fu">c</span>(fit<span class="sc">$</span>system_matrices<span class="sc">$</span>H<span class="sc">$</span>H, fit<span class="sc">$</span>system_matrices<span class="sc">$</span>Q<span class="sc">$</span>level)</span>
<span id="cb1003-2"><a href="動的線形モデル.html#cb1003-2" tabindex="-1"></a><span class="do">## [1] 15100.252  1468.724</span></span></code></pre></div>
<ul>
<li>推定されたレベル</li>
</ul>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="動的線形モデル.html#cb1004-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>function_call<span class="sc">$</span>y, <span class="at">type =</span> <span class="st">&#39;p&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">1400</span>), </span>
<span id="cb1004-2"><a href="動的線形モデル.html#cb1004-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">ylab =</span> <span class="cn">NA</span>, </span>
<span id="cb1004-3"><a href="動的線形モデル.html#cb1004-3" tabindex="-1"></a>     <span class="at">sub =</span> <span class="st">&quot;The filtered level with 90% confidence intervals, </span></span>
<span id="cb1004-4"><a href="動的線形モデル.html#cb1004-4" tabindex="-1"></a><span class="st">            and the observed data points&quot;</span></span>
<span id="cb1004-5"><a href="動的線形モデル.html#cb1004-5" tabindex="-1"></a>)</span>
<span id="cb1004-6"><a href="動的線形モデル.html#cb1004-6" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>filtered<span class="sc">$</span>level, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>)</span>
<span id="cb1004-7"><a href="動的線形モデル.html#cb1004-7" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>filtered<span class="sc">$</span>level <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.95</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(fit<span class="sc">$</span>filtered<span class="sc">$</span>P[<span class="dv">1</span>,<span class="dv">1</span>,]), </span>
<span id="cb1004-8"><a href="動的線形モデル.html#cb1004-8" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span></span>
<span id="cb1004-9"><a href="動的線形モデル.html#cb1004-9" tabindex="-1"></a>)</span>
<span id="cb1004-10"><a href="動的線形モデル.html#cb1004-10" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>filtered<span class="sc">$</span>level <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.95</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(fit<span class="sc">$</span>filtered<span class="sc">$</span>P[<span class="dv">1</span>,<span class="dv">1</span>,]), </span>
<span id="cb1004-11"><a href="動的線形モデル.html#cb1004-11" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span></span>
<span id="cb1004-12"><a href="動的線形モデル.html#cb1004-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-7-1.png" width="75%" /></p>
<ul>
<li>平滑化されたレベル</li>
</ul>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="動的線形モデル.html#cb1005-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>function_call<span class="sc">$</span>y, <span class="at">type =</span> <span class="st">&#39;p&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">1400</span>), </span>
<span id="cb1005-2"><a href="動的線形モデル.html#cb1005-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="cn">NA</span>, <span class="at">ylab =</span> <span class="cn">NA</span>, </span>
<span id="cb1005-3"><a href="動的線形モデル.html#cb1005-3" tabindex="-1"></a>     <span class="at">sub =</span> <span class="st">&quot;The smoothed level with 90% confidence intervals, and the observed data points&quot;</span>)</span>
<span id="cb1005-4"><a href="動的線形モデル.html#cb1005-4" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>smoothed<span class="sc">$</span>level, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>)</span>
<span id="cb1005-5"><a href="動的線形モデル.html#cb1005-5" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>smoothed<span class="sc">$</span>level <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.95</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(fit<span class="sc">$</span>smoothed<span class="sc">$</span>V[<span class="dv">1</span>,<span class="dv">1</span>,]),</span>
<span id="cb1005-6"><a href="動的線形モデル.html#cb1005-6" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span>)</span>
<span id="cb1005-7"><a href="動的線形モデル.html#cb1005-7" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1871</span><span class="sc">:</span><span class="dv">1970</span>, fit<span class="sc">$</span>smoothed<span class="sc">$</span>level <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.95</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(fit<span class="sc">$</span>smoothed<span class="sc">$</span>V[<span class="dv">1</span>,<span class="dv">1</span>,]),</span>
<span id="cb1005-8"><a href="動的線形モデル.html#cb1005-8" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span>)</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-8-1.png" width="75%" /></p>
<p>statespacer()によって返されるオブジェクトには, 他にも多くの便利なアイテム有り. これらの詳細については、vignette(“dictionary”, “statespacer”)を参照.
statespacerパッケージの詳細については, <a href="https://DylanB95.github.io/statespacer/" class="uri">https://DylanB95.github.io/statespacer/</a> の他のチュートリアルを参照するか, browseVignettes(“statespacer”)を参照せよ.</p>
<div id="参考文献-1" class="section level4 unnumbered hasAnchor">
<h4>参考文献<a href="動的線形モデル.html#参考文献-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Durbin, James, and Siem Jan Koopman. 2012. <em>Time Series Analysis by State Space Methods</em>. Oxford university press.</p>
</div>
</div>
<div id="季節性への対応説明変数の追加従属変数が複数ある場合への対応" class="section level3 unnumbered hasAnchor">
<h3>季節性への対応・説明変数の追加・従属変数が複数ある場合への対応<a href="動的線形モデル.html#季節性への対応説明変数の追加従属変数が複数ある場合への対応" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>出所: <a href="https://dylanb95.github.io/statespacer/articles/seatbelt.html">statespacer applied to UK Road Deaths</a></p></li>
<li><p>データセット: 英国自動車交通事故者数 (UK Road Deaths). 1969年1月–1984年12月までの英国自動車交通事故者数に関する月次データ.</p></li>
</ul>
<pre><code>- Seatbelts
  - DriversKilled: 死亡した自動車ドライバー
  - drivers: 英国における自動車運転者の死者・重傷者の月次合計 (データセットUKDriverDeathsの内容)
  - front: 死亡または重傷を負った前席の同乗者
  - rear: 死亡または重傷の後席の同乗者
  - kms: 走行距離
  - PetrolPrice: ガソリン価格
  - VanKilled: バン (軽貨物車) の運転者数
  - law: シートベルト着用義務化 (1983年1月31日) 以降は1, それ以前は0</code></pre>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="動的線形モデル.html#cb1007-1" tabindex="-1"></a><span class="co"># Load statespacerlibrary(statespacer)# Load the dataset</span></span>
<span id="cb1007-2"><a href="動的線形モデル.html#cb1007-2" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb1007-3"><a href="動的線形モデル.html#cb1007-3" tabindex="-1"></a>Data <span class="ot">&lt;-</span> Seatbelts</span>
<span id="cb1007-4"><a href="動的線形モデル.html#cb1007-4" tabindex="-1"></a></span>
<span id="cb1007-5"><a href="動的線形モデル.html#cb1007-5" tabindex="-1"></a><span class="co"># Data preparation</span></span>
<span id="cb1007-6"><a href="動的線形モデル.html#cb1007-6" tabindex="-1"></a><span class="co"># The log of &quot;drivers&quot;, &quot;front&quot;, and &quot;rear&quot; will be used as dependent variables</span></span>
<span id="cb1007-7"><a href="動的線形モデル.html#cb1007-7" tabindex="-1"></a><span class="co"># The log of &quot;PetrolPrice&quot; and &quot;kms&quot; will be used as explanatory variables</span></span>
<span id="cb1007-8"><a href="動的線形モデル.html#cb1007-8" tabindex="-1"></a>Data[, <span class="fu">c</span>(<span class="st">&quot;drivers&quot;</span>, <span class="st">&quot;front&quot;</span>, <span class="st">&quot;rear&quot;</span>, <span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;kms&quot;</span>)] <span class="ot">&lt;-</span> <span class="fu">log</span>(Data[, <span class="fu">c</span>(<span class="st">&quot;drivers&quot;</span>, <span class="st">&quot;front&quot;</span>, <span class="st">&quot;rear&quot;</span>, <span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;kms&quot;</span>)])</span></code></pre></div>
<p><strong>確定的水準と季節性を持つ1変量モデル</strong></p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="動的線形モデル.html#cb1008-1" tabindex="-1"></a><span class="co"># Dependent variable</span></span>
<span id="cb1008-2"><a href="動的線形モデル.html#cb1008-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Data[, <span class="st">&quot;drivers&quot;</span>])</span>
<span id="cb1008-3"><a href="動的線形モデル.html#cb1008-3" tabindex="-1"></a></span>
<span id="cb1008-4"><a href="動的線形モデル.html#cb1008-4" tabindex="-1"></a><span class="co"># Period of the seasonal component</span></span>
<span id="cb1008-5"><a href="動的線形モデル.html#cb1008-5" tabindex="-1"></a>BSM_vec <span class="ot">&lt;-</span> <span class="dv">12</span> </span>
<span id="cb1008-6"><a href="動的線形モデル.html#cb1008-6" tabindex="-1"></a></span>
<span id="cb1008-7"><a href="動的線形モデル.html#cb1008-7" tabindex="-1"></a><span class="co"># Explanatory variables</span></span>
<span id="cb1008-8"><a href="動的線形モデル.html#cb1008-8" tabindex="-1"></a><span class="co"># Note: Must be a list of matrices! </span></span>
<span id="cb1008-9"><a href="動的線形モデル.html#cb1008-9" tabindex="-1"></a><span class="co">#       Each dependent gets its own matrix of explanatory variables.</span></span>
<span id="cb1008-10"><a href="動的線形モデル.html#cb1008-10" tabindex="-1"></a>addvar_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">as.matrix</span>(Data[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;law&quot;</span>)]))</span>
<span id="cb1008-11"><a href="動的線形モデル.html#cb1008-11" tabindex="-1"></a></span>
<span id="cb1008-12"><a href="動的線形モデル.html#cb1008-12" tabindex="-1"></a><span class="co"># Format of the variance - covariance matrix of the level component</span></span>
<span id="cb1008-13"><a href="動的線形モデル.html#cb1008-13" tabindex="-1"></a><span class="co"># By setting the elements of this matrix to 0, </span></span>
<span id="cb1008-14"><a href="動的線形モデル.html#cb1008-14" tabindex="-1"></a><span class="co"># the component becomes deterministic.</span></span>
<span id="cb1008-15"><a href="動的線形モデル.html#cb1008-15" tabindex="-1"></a>format_level <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>) </span>
<span id="cb1008-16"><a href="動的線形モデル.html#cb1008-16" tabindex="-1"></a></span>
<span id="cb1008-17"><a href="動的線形モデル.html#cb1008-17" tabindex="-1"></a><span class="co"># Format of the variance - covariance matrix of the seasonal component</span></span>
<span id="cb1008-18"><a href="動的線形モデル.html#cb1008-18" tabindex="-1"></a><span class="co"># Note: This format must be a list of matrices, because multiple </span></span>
<span id="cb1008-19"><a href="動的線形モデル.html#cb1008-19" tabindex="-1"></a><span class="co">#       seasonalities can be specified!</span></span>
<span id="cb1008-20"><a href="動的線形モデル.html#cb1008-20" tabindex="-1"></a>format_BSM_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>)) </span></code></pre></div>
<ul>
<li>モデル適合</li>
</ul>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="動的線形モデル.html#cb1009-1" tabindex="-1"></a><span class="co"># Fitting the model</span></span>
<span id="cb1009-2"><a href="動的線形モデル.html#cb1009-2" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">statespacer</span>(<span class="at">y =</span> y,</span>
<span id="cb1009-3"><a href="動的線形モデル.html#cb1009-3" tabindex="-1"></a>                   <span class="at">local_level_ind =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1009-4"><a href="動的線形モデル.html#cb1009-4" tabindex="-1"></a>                   <span class="at">BSM_vec =</span> BSM_vec,</span>
<span id="cb1009-5"><a href="動的線形モデル.html#cb1009-5" tabindex="-1"></a>                   <span class="at">addvar_list =</span> addvar_list,</span>
<span id="cb1009-6"><a href="動的線形モデル.html#cb1009-6" tabindex="-1"></a>                   <span class="at">format_level =</span> format_level, </span>
<span id="cb1009-7"><a href="動的線形モデル.html#cb1009-7" tabindex="-1"></a>                   <span class="at">format_BSM_list =</span> format_BSM_list,</span>
<span id="cb1009-8"><a href="動的線形モデル.html#cb1009-8" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>,</span>
<span id="cb1009-9"><a href="動的線形モデル.html#cb1009-9" tabindex="-1"></a>                   <span class="at">initial =</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">var</span>(y)),</span>
<span id="cb1009-10"><a href="動的線形モデル.html#cb1009-10" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1009-11"><a href="動的線形モデル.html#cb1009-11" tabindex="-1"></a><span class="do">## Parameter scaling:[1] 1</span></span>
<span id="cb1009-12"><a href="動的線形モデル.html#cb1009-12" tabindex="-1"></a><span class="do">## initial  value -0.443442 </span></span>
<span id="cb1009-13"><a href="動的線形モデル.html#cb1009-13" tabindex="-1"></a><span class="do">## final  value -0.735372 </span></span>
<span id="cb1009-14"><a href="動的線形モデル.html#cb1009-14" tabindex="-1"></a><span class="do">## converged</span></span></code></pre></div>
<ul>
<li>パラメータ推定値</li>
</ul>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="動的線形モデル.html#cb1010-1" tabindex="-1"></a><span class="co"># The estimated variance of the observation disturbance</span></span>
<span id="cb1010-2"><a href="動的線形モデル.html#cb1010-2" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>H<span class="sc">$</span>H</span>
<span id="cb1010-3"><a href="動的線形モデル.html#cb1010-3" tabindex="-1"></a><span class="do">##             [,1]</span></span>
<span id="cb1010-4"><a href="動的線形モデル.html#cb1010-4" tabindex="-1"></a><span class="do">## [1,] 0.007402017</span></span>
<span id="cb1010-5"><a href="動的線形モデル.html#cb1010-5" tabindex="-1"></a></span>
<span id="cb1010-6"><a href="動的線形モデル.html#cb1010-6" tabindex="-1"></a><span class="co"># Smoothed estimate of the coefficient of log &quot;PetrolPrice&quot;</span></span>
<span id="cb1010-7"><a href="動的線形モデル.html#cb1010-7" tabindex="-1"></a>fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb1010-8"><a href="動的線形モデル.html#cb1010-8" tabindex="-1"></a><span class="do">## [1] -0.4521301</span></span>
<span id="cb1010-9"><a href="動的線形モデル.html#cb1010-9" tabindex="-1"></a></span>
<span id="cb1010-10"><a href="動的線形モデル.html#cb1010-10" tabindex="-1"></a><span class="co"># Smoothed estimate of the coefficient of the &quot;law&quot; dummy</span></span>
<span id="cb1010-11"><a href="動的線形モデル.html#cb1010-11" tabindex="-1"></a>fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb1010-12"><a href="動的線形モデル.html#cb1010-12" tabindex="-1"></a><span class="do">## [1] -0.1971395</span></span>
<span id="cb1010-13"><a href="動的線形モデル.html#cb1010-13" tabindex="-1"></a></span>
<span id="cb1010-14"><a href="動的線形モデル.html#cb1010-14" tabindex="-1"></a><span class="co"># Plot the data next to the smoothed level + explanatory variables components</span></span>
<span id="cb1010-15"><a href="動的線形モデル.html#cb1010-15" tabindex="-1"></a><span class="fu">plot</span>(Data[, <span class="fu">c</span>(<span class="st">&quot;drivers&quot;</span>)], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">6.95</span>, <span class="fl">8.1</span>),</span>
<span id="cb1010-16"><a href="動的線形モデル.html#cb1010-16" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;logarithm of drivers&quot;</span>)</span>
<span id="cb1010-17"><a href="動的線形モデル.html#cb1010-17" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">seq</span>(<span class="fu">tsp</span>(Data)[<span class="dv">1</span>], <span class="fu">tsp</span>(Data)[<span class="dv">2</span>], <span class="dv">1</span> <span class="sc">/</span> <span class="fu">tsp</span>(Data)[<span class="dv">3</span>]), </span>
<span id="cb1010-18"><a href="動的線形モデル.html#cb1010-18" tabindex="-1"></a>      fit<span class="sc">$</span>smoothed<span class="sc">$</span>level <span class="sc">+</span> fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1010-19"><a href="動的線形モデル.html#cb1010-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">1978</span>, <span class="fl">8.09</span>, <span class="fu">c</span>(<span class="st">&quot;log(drivers)&quot;</span>, <span class="st">&quot;level + regression effects&quot;</span>), </span>
<span id="cb1010-20"><a href="動的線形モデル.html#cb1010-20" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-12-1.png" width="75%" /></p>
<p><strong>確率的水準+確率的季節性モデル (stochastic level and seasonal model)</strong></p>
<ul>
<li>モデルの特定および適合</li>
</ul>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="動的線形モデル.html#cb1011-1" tabindex="-1"></a><span class="co"># By setting the entries in the format to 1, the component becomes stochastic</span></span>
<span id="cb1011-2"><a href="動的線形モデル.html#cb1011-2" tabindex="-1"></a>format_level <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>)</span>
<span id="cb1011-3"><a href="動的線形モデル.html#cb1011-3" tabindex="-1"></a>format_BSM_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">1</span>))</span>
<span id="cb1011-4"><a href="動的線形モデル.html#cb1011-4" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">statespacer</span>(<span class="at">y =</span> y,</span>
<span id="cb1011-5"><a href="動的線形モデル.html#cb1011-5" tabindex="-1"></a>                   <span class="at">local_level_ind =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1011-6"><a href="動的線形モデル.html#cb1011-6" tabindex="-1"></a>                   <span class="at">BSM_vec =</span> BSM_vec,</span>
<span id="cb1011-7"><a href="動的線形モデル.html#cb1011-7" tabindex="-1"></a>                   <span class="at">addvar_list =</span> addvar_list,</span>
<span id="cb1011-8"><a href="動的線形モデル.html#cb1011-8" tabindex="-1"></a>                   <span class="at">format_level =</span> format_level,</span>
<span id="cb1011-9"><a href="動的線形モデル.html#cb1011-9" tabindex="-1"></a>                   <span class="at">format_BSM_list =</span> format_BSM_list,</span>
<span id="cb1011-10"><a href="動的線形モデル.html#cb1011-10" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>,</span>
<span id="cb1011-11"><a href="動的線形モデル.html#cb1011-11" tabindex="-1"></a>                   <span class="at">initial =</span> <span class="fu">log</span>(<span class="fu">var</span>(y)),</span>
<span id="cb1011-12"><a href="動的線形モデル.html#cb1011-12" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1011-13"><a href="動的線形モデル.html#cb1011-13" tabindex="-1"></a><span class="do">## Parameter scaling:[1] 1 1 1</span></span>
<span id="cb1011-14"><a href="動的線形モデル.html#cb1011-14" tabindex="-1"></a><span class="do">## initial  value -0.172423 </span></span>
<span id="cb1011-15"><a href="動的線形モデル.html#cb1011-15" tabindex="-1"></a><span class="do">## iter  10 value -0.893962</span></span>
<span id="cb1011-16"><a href="動的線形モデル.html#cb1011-16" tabindex="-1"></a><span class="do">## iter  20 value -0.915493</span></span>
<span id="cb1011-17"><a href="動的線形モデル.html#cb1011-17" tabindex="-1"></a><span class="do">## iter  30 value -0.915515</span></span>
<span id="cb1011-18"><a href="動的線形モデル.html#cb1011-18" tabindex="-1"></a><span class="do">## final  value -0.915517 </span></span>
<span id="cb1011-19"><a href="動的線形モデル.html#cb1011-19" tabindex="-1"></a><span class="do">## converged</span></span></code></pre></div>
<ul>
<li>パラメータ推定値</li>
</ul>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="動的線形モデル.html#cb1012-1" tabindex="-1"></a><span class="co"># The estimated variance of the observation disturbance</span></span>
<span id="cb1012-2"><a href="動的線形モデル.html#cb1012-2" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>H<span class="sc">$</span>H</span>
<span id="cb1012-3"><a href="動的線形モデル.html#cb1012-3" tabindex="-1"></a><span class="do">##             [,1]</span></span>
<span id="cb1012-4"><a href="動的線形モデル.html#cb1012-4" tabindex="-1"></a><span class="do">## [1,] 0.003786182</span></span>
<span id="cb1012-5"><a href="動的線形モデル.html#cb1012-5" tabindex="-1"></a></span>
<span id="cb1012-6"><a href="動的線形モデル.html#cb1012-6" tabindex="-1"></a><span class="co"># The estimated variance of the level disturbance</span></span>
<span id="cb1012-7"><a href="動的線形モデル.html#cb1012-7" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>Q<span class="sc">$</span>level</span>
<span id="cb1012-8"><a href="動的線形モデル.html#cb1012-8" tabindex="-1"></a><span class="do">##              [,1]</span></span>
<span id="cb1012-9"><a href="動的線形モデル.html#cb1012-9" tabindex="-1"></a><span class="do">## [1,] 0.0002676898</span></span>
<span id="cb1012-10"><a href="動的線形モデル.html#cb1012-10" tabindex="-1"></a></span>
<span id="cb1012-11"><a href="動的線形モデル.html#cb1012-11" tabindex="-1"></a><span class="co"># The estimated variance of the seasonal disturbance</span></span>
<span id="cb1012-12"><a href="動的線形モデル.html#cb1012-12" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>Q<span class="sc">$</span>BSM12</span>
<span id="cb1012-13"><a href="動的線形モデル.html#cb1012-13" tabindex="-1"></a><span class="do">##              [,1]</span></span>
<span id="cb1012-14"><a href="動的線形モデル.html#cb1012-14" tabindex="-1"></a><span class="do">## [1,] 1.161433e-06</span></span>
<span id="cb1012-15"><a href="動的線形モデル.html#cb1012-15" tabindex="-1"></a></span>
<span id="cb1012-16"><a href="動的線形モデル.html#cb1012-16" tabindex="-1"></a><span class="co"># Smoothed estimate of the coefficient of log &quot;PetrolPrice&quot;</span></span>
<span id="cb1012-17"><a href="動的線形モデル.html#cb1012-17" tabindex="-1"></a>fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb1012-18"><a href="動的線形モデル.html#cb1012-18" tabindex="-1"></a><span class="do">## [1] -0.2913941</span></span>
<span id="cb1012-19"><a href="動的線形モデル.html#cb1012-19" tabindex="-1"></a></span>
<span id="cb1012-20"><a href="動的線形モデル.html#cb1012-20" tabindex="-1"></a><span class="co"># Smoothed estimate of the coefficient of the &quot;law&quot; dummy</span></span>
<span id="cb1012-21"><a href="動的線形モデル.html#cb1012-21" tabindex="-1"></a>fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb1012-22"><a href="動的線形モデル.html#cb1012-22" tabindex="-1"></a><span class="do">## [1] -0.2377374</span></span></code></pre></div>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="動的線形モデル.html#cb1013-1" tabindex="-1"></a><span class="co"># Plot the data next to the smoothed level + explanatory variables components</span></span>
<span id="cb1013-2"><a href="動的線形モデル.html#cb1013-2" tabindex="-1"></a><span class="fu">plot</span>(Data[, <span class="fu">c</span>(<span class="st">&quot;drivers&quot;</span>)], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">6.95</span>, <span class="fl">8.1</span>),</span>
<span id="cb1013-3"><a href="動的線形モデル.html#cb1013-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;logarithm of drivers&quot;</span>)</span>
<span id="cb1013-4"><a href="動的線形モデル.html#cb1013-4" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">seq</span>(<span class="fu">tsp</span>(Data)[<span class="dv">1</span>], <span class="fu">tsp</span>(Data)[<span class="dv">2</span>], <span class="dv">1</span> <span class="sc">/</span> <span class="fu">tsp</span>(Data)[<span class="dv">3</span>]), </span>
<span id="cb1013-5"><a href="動的線形モデル.html#cb1013-5" tabindex="-1"></a>      fit<span class="sc">$</span>smoothed<span class="sc">$</span>level <span class="sc">+</span> fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1013-6"><a href="動的線形モデル.html#cb1013-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">1978</span>, <span class="fl">8.09</span>, <span class="fu">c</span>(<span class="st">&quot;log(drivers)&quot;</span>, <span class="st">&quot;level + regression effects&quot;</span>), </span>
<span id="cb1013-7"><a href="動的線形モデル.html#cb1013-7" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-15-1.png" width="75%" /></p>
<!--
確率的季節性をプロットしてみると、時間と共にほとんど変化していないことがわかる。季節成分を決定論的に設定し、レベルを確率論的に設定することは価値があるかもしれない。これは練習問題として残しておこう。両方のモデルのAICを比較し、どちらがより良いスコアかを見てください！
-->
<p>確率的季節性は, 時間と共にほとんど変化せず. 季節成分を確定的に, レベルのみを確率論的に設定する価値あり? (AICを比較し, どちらがベターか確認せよ).</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="動的線形モデル.html#cb1014-1" tabindex="-1"></a><span class="co"># Plot the stochastic seasonal</span></span>
<span id="cb1014-2"><a href="動的線形モデル.html#cb1014-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="fu">tsp</span>(Data)[<span class="dv">1</span>], <span class="fu">tsp</span>(Data)[<span class="dv">2</span>], <span class="dv">1</span> <span class="sc">/</span> <span class="fu">tsp</span>(Data)[<span class="dv">3</span>]), </span>
<span id="cb1014-3"><a href="動的線形モデル.html#cb1014-3" tabindex="-1"></a>     fit<span class="sc">$</span>smoothed<span class="sc">$</span>BSM12,</span>
<span id="cb1014-4"><a href="動的線形モデル.html#cb1014-4" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.3</span>),</span>
<span id="cb1014-5"><a href="動的線形モデル.html#cb1014-5" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;stochastic seasonal&quot;</span>)</span>
<span id="cb1014-6"><a href="動的線形モデル.html#cb1014-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-16-1.png" width="75%" /></p>
<ul>
<li>非規則性成分</li>
</ul>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="動的線形モデル.html#cb1015-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="fu">tsp</span>(Data)[<span class="dv">1</span>], <span class="fu">tsp</span>(Data)[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">/</span><span class="fu">tsp</span>(Data)[<span class="dv">3</span>]), </span>
<span id="cb1015-2"><a href="動的線形モデル.html#cb1015-2" tabindex="-1"></a>     fit<span class="sc">$</span>smoothed<span class="sc">$</span>epsilon,</span>
<span id="cb1015-3"><a href="動的線形モデル.html#cb1015-3" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>, <span class="fl">0.15</span>),</span>
<span id="cb1015-4"><a href="動的線形モデル.html#cb1015-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;irregular component&quot;</span>)</span>
<span id="cb1015-5"><a href="動的線形モデル.html#cb1015-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-17-1.png" width="75%" /></p>
<p><strong>前部座席・後部座席の同乗者の2変量モデル</strong></p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="動的線形モデル.html#cb1016-1" tabindex="-1"></a><span class="co"># Dependent variable</span></span>
<span id="cb1016-2"><a href="動的線形モデル.html#cb1016-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Data[, <span class="fu">c</span>(<span class="st">&quot;front&quot;</span>, <span class="st">&quot;rear&quot;</span>)])</span>
<span id="cb1016-3"><a href="動的線形モデル.html#cb1016-3" tabindex="-1"></a></span>
<span id="cb1016-4"><a href="動的線形モデル.html#cb1016-4" tabindex="-1"></a><span class="co"># Explanatory variables</span></span>
<span id="cb1016-5"><a href="動的線形モデル.html#cb1016-5" tabindex="-1"></a><span class="co"># Note: Must be a list of matrices! </span></span>
<span id="cb1016-6"><a href="動的線形モデル.html#cb1016-6" tabindex="-1"></a><span class="co">#       Each dependent gets its own matrix of explanatory variables.</span></span>
<span id="cb1016-7"><a href="動的線形モデル.html#cb1016-7" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Data[, <span class="fu">c</span>(<span class="st">&quot;PetrolPrice&quot;</span>, <span class="st">&quot;kms&quot;</span>, <span class="st">&quot;law&quot;</span>)])</span>
<span id="cb1016-8"><a href="動的線形モデル.html#cb1016-8" tabindex="-1"></a>addvar_list <span class="ot">&lt;-</span> <span class="fu">list</span>(X, X)</span>
<span id="cb1016-9"><a href="動的線形モデル.html#cb1016-9" tabindex="-1"></a></span>
<span id="cb1016-10"><a href="動的線形モデル.html#cb1016-10" tabindex="-1"></a><span class="co"># Format of the variance - covariance matrix of the level component</span></span>
<span id="cb1016-11"><a href="動的線形モデル.html#cb1016-11" tabindex="-1"></a><span class="co"># Note: Only the lower triangular part of the format is used.</span></span>
<span id="cb1016-12"><a href="動的線形モデル.html#cb1016-12" tabindex="-1"></a><span class="co">#       The format specifies which elements in the matrices L and D should be </span></span>
<span id="cb1016-13"><a href="動的線形モデル.html#cb1016-13" tabindex="-1"></a><span class="co">#       non-zero, where L and D are the matrices of the Cholesky LDL decomposition.</span></span>
<span id="cb1016-14"><a href="動的線形モデル.html#cb1016-14" tabindex="-1"></a><span class="co">#       The diagonal is used to specify which elements of the Diagonal matrix</span></span>
<span id="cb1016-15"><a href="動的線形モデル.html#cb1016-15" tabindex="-1"></a><span class="co">#       should be non-zero. The lower triangular part excluding the diagonal </span></span>
<span id="cb1016-16"><a href="動的線形モデル.html#cb1016-16" tabindex="-1"></a><span class="co">#       specifies which elements in the Loading matrix should be non-zero.</span></span>
<span id="cb1016-17"><a href="動的線形モデル.html#cb1016-17" tabindex="-1"></a>format_level <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1016-18"><a href="動的線形モデル.html#cb1016-18" tabindex="-1"></a></span>
<span id="cb1016-19"><a href="動的線形モデル.html#cb1016-19" tabindex="-1"></a><span class="co"># Format of the variance - covariance matrix of the seasonal component</span></span>
<span id="cb1016-20"><a href="動的線形モデル.html#cb1016-20" tabindex="-1"></a><span class="co"># Note: This format must be a list of matrices, because multiple seasonalities</span></span>
<span id="cb1016-21"><a href="動的線形モデル.html#cb1016-21" tabindex="-1"></a><span class="co">#       can be specified!</span></span>
<span id="cb1016-22"><a href="動的線形モデル.html#cb1016-22" tabindex="-1"></a>format_BSM_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb1016-23"><a href="動的線形モデル.html#cb1016-23" tabindex="-1"></a></span>
<span id="cb1016-24"><a href="動的線形モデル.html#cb1016-24" tabindex="-1"></a><span class="co"># Format of the variance - covariance matrix of the observation disturbances</span></span>
<span id="cb1016-25"><a href="動的線形モデル.html#cb1016-25" tabindex="-1"></a>H_format <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span></code></pre></div>
<ul>
<li>モデル適合</li>
</ul>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="動的線形モデル.html#cb1017-1" tabindex="-1"></a><span class="co"># Fitting the model</span></span>
<span id="cb1017-2"><a href="動的線形モデル.html#cb1017-2" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">statespacer</span>(<span class="at">y =</span> y,</span>
<span id="cb1017-3"><a href="動的線形モデル.html#cb1017-3" tabindex="-1"></a>                   <span class="at">H_format =</span> H_format,</span>
<span id="cb1017-4"><a href="動的線形モデル.html#cb1017-4" tabindex="-1"></a>                   <span class="at">local_level_ind =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1017-5"><a href="動的線形モデル.html#cb1017-5" tabindex="-1"></a>                   <span class="at">BSM_vec =</span> BSM_vec,</span>
<span id="cb1017-6"><a href="動的線形モデル.html#cb1017-6" tabindex="-1"></a>                   <span class="at">addvar_list =</span> addvar_list,</span>
<span id="cb1017-7"><a href="動的線形モデル.html#cb1017-7" tabindex="-1"></a>                   <span class="at">format_level =</span> format_level, </span>
<span id="cb1017-8"><a href="動的線形モデル.html#cb1017-8" tabindex="-1"></a>                   <span class="at">format_BSM_list =</span> format_BSM_list,</span>
<span id="cb1017-9"><a href="動的線形モデル.html#cb1017-9" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>,</span>
<span id="cb1017-10"><a href="動的線形モデル.html#cb1017-10" tabindex="-1"></a>                   <span class="at">initial =</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">diag</span>(<span class="fu">var</span>(y))),</span>
<span id="cb1017-11"><a href="動的線形モデル.html#cb1017-11" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1017-12"><a href="動的線形モデル.html#cb1017-12" tabindex="-1"></a><span class="do">## Parameter scaling:[1] 1 1 1 1 1 1</span></span>
<span id="cb1017-13"><a href="動的線形モデル.html#cb1017-13" tabindex="-1"></a><span class="do">## initial  value 0.389588 </span></span>
<span id="cb1017-14"><a href="動的線形モデル.html#cb1017-14" tabindex="-1"></a><span class="do">## iter  10 value -1.583531</span></span>
<span id="cb1017-15"><a href="動的線形モデル.html#cb1017-15" tabindex="-1"></a><span class="do">## iter  20 value -1.676130</span></span>
<span id="cb1017-16"><a href="動的線形モデル.html#cb1017-16" tabindex="-1"></a><span class="do">## iter  30 value -1.676530</span></span>
<span id="cb1017-17"><a href="動的線形モデル.html#cb1017-17" tabindex="-1"></a><span class="do">## final  value -1.676537 </span></span>
<span id="cb1017-18"><a href="動的線形モデル.html#cb1017-18" tabindex="-1"></a><span class="do">## converged</span></span></code></pre></div>
<p>(実行時間が多少かかる.)</p>
<ul>
<li>推定結果</li>
</ul>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="動的線形モデル.html#cb1018-1" tabindex="-1"></a><span class="co"># The estimated variance - covariance matrix of the observation disturbance</span></span>
<span id="cb1018-2"><a href="動的線形モデル.html#cb1018-2" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>H<span class="sc">$</span>H</span>
<span id="cb1018-3"><a href="動的線形モデル.html#cb1018-3" tabindex="-1"></a><span class="do">##             [,1]        [,2]</span></span>
<span id="cb1018-4"><a href="動的線形モデル.html#cb1018-4" tabindex="-1"></a><span class="do">## [1,] 0.005402169 0.004449533</span></span>
<span id="cb1018-5"><a href="動的線形モデル.html#cb1018-5" tabindex="-1"></a><span class="do">## [2,] 0.004449533 0.008566858</span></span>
<span id="cb1018-6"><a href="動的線形モデル.html#cb1018-6" tabindex="-1"></a></span>
<span id="cb1018-7"><a href="動的線形モデル.html#cb1018-7" tabindex="-1"></a><span class="co"># The estimated variance - covariance matrix of the level disturbance</span></span>
<span id="cb1018-8"><a href="動的線形モデル.html#cb1018-8" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>Q<span class="sc">$</span>level</span>
<span id="cb1018-9"><a href="動的線形モデル.html#cb1018-9" tabindex="-1"></a><span class="do">##              [,1]         [,2]</span></span>
<span id="cb1018-10"><a href="動的線形モデル.html#cb1018-10" tabindex="-1"></a><span class="do">## [1,] 0.0002556381 0.0002247037</span></span>
<span id="cb1018-11"><a href="動的線形モデル.html#cb1018-11" tabindex="-1"></a><span class="do">## [2,] 0.0002247037 0.0002319556</span></span>
<span id="cb1018-12"><a href="動的線形モデル.html#cb1018-12" tabindex="-1"></a></span>
<span id="cb1018-13"><a href="動的線形モデル.html#cb1018-13" tabindex="-1"></a><span class="co"># Coefficients + T-stats</span></span>
<span id="cb1018-14"><a href="動的線形モデル.html#cb1018-14" tabindex="-1"></a>coeff <span class="ot">&lt;-</span> <span class="fu">cbind</span>(  <span class="fu">c</span>(<span class="st">&quot;front PetrolPrice&quot;</span>, <span class="st">&quot;front kms&quot;</span>, <span class="st">&quot;front law&quot;</span>, </span>
<span id="cb1018-15"><a href="動的線形モデル.html#cb1018-15" tabindex="-1"></a>    <span class="st">&quot;rear PetrolPrice&quot;</span>, <span class="st">&quot;rear kms&quot;</span>, <span class="st">&quot;rear law&quot;</span>),</span>
<span id="cb1018-16"><a href="動的線形モデル.html#cb1018-16" tabindex="-1"></a>  fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff[<span class="dv">1</span>,],</span>
<span id="cb1018-17"><a href="動的線形モデル.html#cb1018-17" tabindex="-1"></a>  fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff[<span class="dv">1</span>,] <span class="sc">/</span> fit<span class="sc">$</span>smoothed<span class="sc">$</span>addvar_coeff_se[<span class="dv">1</span>,])</span>
<span id="cb1018-18"><a href="動的線形モデル.html#cb1018-18" tabindex="-1"></a><span class="fu">colnames</span>(coeff) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Variable&quot;</span>, <span class="st">&quot;Coefficient&quot;</span>, <span class="st">&quot;T-Stat&quot;</span>)</span>
<span id="cb1018-19"><a href="動的線形モデル.html#cb1018-19" tabindex="-1"></a>coeff</span>
<span id="cb1018-20"><a href="動的線形モデル.html#cb1018-20" tabindex="-1"></a><span class="do">##      Variable            Coefficient            T-Stat              </span></span>
<span id="cb1018-21"><a href="動的線形モデル.html#cb1018-21" tabindex="-1"></a><span class="do">## [1,] &quot;front PetrolPrice&quot; &quot;-0.30761498952755&quot;    &quot;-2.898564300443&quot;   </span></span>
<span id="cb1018-22"><a href="動的線形モデル.html#cb1018-22" tabindex="-1"></a><span class="do">## [2,] &quot;front kms&quot;         &quot;0.151804487016903&quot;    &quot;1.16776317642797&quot;  </span></span>
<span id="cb1018-23"><a href="動的線形モデル.html#cb1018-23" tabindex="-1"></a><span class="do">## [3,] &quot;front law&quot;         &quot;-0.337045864410277&quot;   &quot;-6.84659677395525&quot; </span></span>
<span id="cb1018-24"><a href="動的線形モデル.html#cb1018-24" tabindex="-1"></a><span class="do">## [4,] &quot;rear PetrolPrice&quot;  &quot;-0.0857573081006879&quot;  &quot;-0.763930782505291&quot;</span></span>
<span id="cb1018-25"><a href="動的線形モデル.html#cb1018-25" tabindex="-1"></a><span class="do">## [5,] &quot;rear kms&quot;          &quot;0.550388846597698&quot;    &quot;3.79267978722466&quot;  </span></span>
<span id="cb1018-26"><a href="動的線形モデル.html#cb1018-26" tabindex="-1"></a><span class="do">## [6,] &quot;rear law&quot;          &quot;0.000887654967915423&quot; &quot;0.0171338265272815&quot;</span></span></code></pre></div>
<ul>
<li>前部座席に関する水準のプロット</li>
</ul>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="動的線形モデル.html#cb1019-1" tabindex="-1"></a><span class="co"># plot of level for &quot;front&quot;</span></span>
<span id="cb1019-2"><a href="動的線形モデル.html#cb1019-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="fu">tsp</span>(Data)[<span class="dv">1</span>], <span class="fu">tsp</span>(Data)[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">/</span><span class="fu">tsp</span>(Data)[<span class="dv">3</span>]), </span>
<span id="cb1019-3"><a href="動的線形モデル.html#cb1019-3" tabindex="-1"></a>     fit<span class="sc">$</span>smoothed<span class="sc">$</span>level[, <span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb1019-4"><a href="動的線形モデル.html#cb1019-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;level of front passengers&quot;</span>)</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-21-1.png" width="75%" /></p>
<ul>
<li>後部座席に関する水準のプロット</li>
</ul>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="動的線形モデル.html#cb1020-1" tabindex="-1"></a><span class="co"># plot of level for &quot;rear&quot;</span></span>
<span id="cb1020-2"><a href="動的線形モデル.html#cb1020-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="fu">tsp</span>(Data)[<span class="dv">1</span>], <span class="fu">tsp</span>(Data)[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">/</span><span class="fu">tsp</span>(Data)[<span class="dv">3</span>]), </span>
<span id="cb1020-3"><a href="動的線形モデル.html#cb1020-3" tabindex="-1"></a>     fit<span class="sc">$</span>smoothed<span class="sc">$</span>level[, <span class="dv">2</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb1020-4"><a href="動的線形モデル.html#cb1020-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;level of rear passengers&quot;</span>)</span></code></pre></div>
<p><img src="132-dlm-2_files/figure-html/unnamed-chunk-22-1.png" width="75%" /></p>
<p>二つの水準の動きは似ており, 相関関係は1に近い.</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="動的線形モデル.html#cb1021-1" tabindex="-1"></a>fit<span class="sc">$</span>system_matrices<span class="sc">$</span>Q_correlation_matrix<span class="sc">$</span>level</span>
<span id="cb1021-2"><a href="動的線形モデル.html#cb1021-2" tabindex="-1"></a><span class="do">##           [,1]      [,2]</span></span>
<span id="cb1021-3"><a href="動的線形モデル.html#cb1021-3" tabindex="-1"></a><span class="do">## [1,] 1.0000000 0.9227734</span></span>
<span id="cb1021-4"><a href="動的線形モデル.html#cb1021-4" tabindex="-1"></a><span class="do">## [2,] 0.9227734 1.0000000</span></span></code></pre></div>
<p>format_levelを以下のように設定することで, レベル成分の分散-共分散行列のランクを1に制限を加えることも可能:</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="動的線形モデル.html#cb1022-1" tabindex="-1"></a>format_level <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1022-2"><a href="動的線形モデル.html#cb1022-2" tabindex="-1"></a>format_level[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>この新しいモデル・スペシフィケーションにてモデルを推定してみるとどうなるか.
なお, “rear”同乗者については”law”ダミーを削除し, “front”同乗者についてはダミーを残すと良いかもしれない.</p>
<!--
この新しい仕様でモデルを推定するのは自由である！また、"後部 "乗客については "法律 "ダミーを削除し、"前部 "乗客についてはダミーを残すことを提案する。
-->
<div id="参考文献-2" class="section level4 unnumbered hasAnchor">
<h4>参考文献<a href="動的線形モデル.html#参考文献-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Commandeur, Jacques JF, and Siem Jan Koopman. 2007. <em>An Introduction to State Space Time Series Analysis</em>. Oxford University Press.</p>

</div>
</div>
</div>
<div id="パッケージbssm" class="section level2 hasAnchor" number="14.3">
<h2><span class="header-section-number">14.3</span> パッケージ<strong>bssm</strong><a href="動的線形モデル.html#パッケージbssm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>出所:</p>
<ul>
<li>(Package ‘bssm’)[<a href="https://cran.r-project.org/web/packages/bssm/bssm.pdf" class="uri">https://cran.r-project.org/web/packages/bssm/bssm.pdf</a>]</li>
<li>(bssm: Bayesian Inference of Non-linear and Non-Gaussian State Space Models in R)[<a href="https://cran.r-project.org/web/packages/bssm/vignettes/bssm.html" class="uri">https://cran.r-project.org/web/packages/bssm/vignettes/bssm.html</a>]</li>
</ul>
<p>パッケージ<strong>bssm</strong>について:
Bayesian Inference of Non-Linear and Non-Gaussian State Space Models (非線形・非ガウス状態空間モデルのベイズ推論)</p>
<ul>
<li>非ガウス and/or 非 線形の観測方程式と状態方程式を持つ一般的な状態空間モデルのベイズ推論を行う</li>
<li>外生共変量を含む基本構造時系列モデル(BSM) (Harvey 1989), 単純な確率ボラティリティ・モデル, 離散化拡散過程モデルなどの一般的な時系列モデルに対して, ベイジアンの設定における予測その他の推論を簡単かつ効率的に実行</li>
</ul>
<!--
- 本パッケージのベースには、状態空間モデルのベイズ推論のための、計算効率が高く並列計算可能な新しいアプローチ (Vihola, Helske, and Franks 2020) がある. 核となるアイデアは, ハイパーパラメータ（潜在状態変数を除く未知変数）の近似的な周辺事後分布をターゲットとする高速な近似マルコフ連鎖モンテカルロ（MCMC）を使用することであり, このMCMCは, ハイパーパラメータと隠れ状態の結合事後分布から漸近的に正確なサンプルを提供する重要度サンプリングタイプの重み付けフェーズで使用される. これに加えて, 2段階手続き, 標準的な擬似周辺MCMC, いわゆる遅延受け入れ擬似周辺MCMC (delayed acceptance pseudo-marginal MCMC) もサポートされる。
-->
<!--
```
bssmパッケージ
次のいずれかのモデルを仮定: 
- 指数分布族状態空間モデル
  状態方程式は線形ガウシアン. 条件付き観測分布の密度関数は, ガウシアン, ポアソン, 二項, 負の二項, ガンマ
- 基本的な確率ボラティリティ・モデル
- ガウスノイズ項を持つ一般的な非線形モデル
- 連続確率微分方程式のダイナミクスを持つモデル 

反応系列の欠損値は, SSM理論に従って許容され, 自動的に予測することができる, 
しかし, モデルのシステム行列内の欠損値は不可

本パッケージは, モデルを構築するための複数の関数を含む：
- bsm_lg: 基本的な一変量構造時系列モデル(BSM)
- ar1: ノイズ付きの1変量AR(1)過程
- ssm_ulg/ssm_mlg: 一変量/多変量観測値を持つ任意の線形ガウスモデル
- 上記モデルの非ガウス版（オブザベーションが非ガウス）は, 関数 bsm_ng, ar1_ng, ssm_ung および ssm_mng を用いて構築することが可能
- 一変量確率ボラティリティ・モデル: 関数 svm を使って定義可能
- 非線形モデル: C++コードスニペットと関数 ssm_nlg によりモデルを定義する必要
- 拡散モデル: ssm_sde関数を用いて定義可能 

モデルを構築した後, run_mcmc関数でモデルを推定することが可能.
パッケージには, 古典的な線形ガウスモデル以外のモデルのためのMCMCサンプリングと逐次モンテカルロ法が含まれる. 

run_mcmcの出力は, as.data.frame, as_draws, expand_sample, summaryメソッド, fittedメソッド, predictメソッドを用いて, 潜在状態とハイパーパラメータの事後標本を抽出することにより分析することが可能. いくつかのMCMC診断チェックはcheck_diagnostics関数で利用可能で, その一部はrun_cmc出力のprintメソッドでも提供. ggplot2とbayesplotの機能は, 事後描画やその要約統計量を可視化するために使用することができ, さらにposteriorとcodaパッケージの助けを借りて診断チェックを実行すること可能 
```
-->
<p>具体的には, bssmパッケージでは, 次のモデルを仮定することができる:</p>
<ul>
<li>指数分布族状態空間モデル (状態方程式は線形ガウス. 条件付き観測分布の密度関数は, 正規, ポアソン, 二項, 負の二項, ガンマ分布)</li>
<li>基本的な確率ボラティリティ・モデル</li>
<li>ガウスノイズ項を持つ一般的な非線形モデル</li>
<li>連続確率微分方程式のダイナミクスを持つモデル
パッケージ内で, モデルを構築するための各種関数が用意されている:</li>
<li>bsm_lg: 基本的な一変量構造時系列モデル(BSM)</li>
<li>ar1: ノイズ付きの1変量AR(1)過程</li>
<li>ssm_ulg/ssm_mlg: 一変量/多変量観測値を持つ任意の線形ガウスモデル</li>
<li>これらの非ガウス版として, 関数 bsm_ng, ar1_ng, ssm_ung/ssm_mng
等.</li>
</ul>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="動的線形モデル.html#cb1023-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;bssm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="動的線形モデル.html#cb1024-1" tabindex="-1"></a><span class="co"># Load bssm</span></span>
<span id="cb1024-2"><a href="動的線形モデル.html#cb1024-2" tabindex="-1"></a><span class="fu">library</span>(bssm)</span></code></pre></div>
<div id="local-levelモデル-2" class="section level3 unnumbered hasAnchor">
<h3>local levelモデル<a href="動的線形モデル.html#local-levelモデル-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ナイル川データセットNileに対して, local levelモデルを適合.</p>
<pre><code>関数bsm_lg(): Basic Structural (Time Series) Model
- local level, またはlocal trend成分および季節性成分を持つ基本構造時系列モデル (Basic Structural Time Series Model) を構築する.
- usage: 
  bsm_lg(y, sd_y, sd_level, sd_slope, sd_seasonal, beta, xreg = NULL, period, a1 = NULL, P1 = NULL, D = NULL, C = NULL)
- 引数
  - y: 観測値のvector, またはtsオブジェクト
  - sd_y: 観測方程式のノイズの標準偏差
  - sd_level: レベル方程式のノイズの標準偏差
  - sd_slope: 勾配方程式のノイズの標準偏差
  - sd_seasonal： 季節性方程式のノイズの標準偏差
  - beta: 回帰係数の事前分布
  - xreg: yの長さと同一の行数を持つ共変量行列
  - period: 季節性パターンの長さ (2&lt;period&lt;入力時系列の長さ). デフォルトは frequency(y). 
  - a1: 初期状態（水準, 勾配, 季節性）の事前平均. デフォルトは0
  - P1: 初期状態（水準, 勾配, 季節性）の事前共分散行列. 対角成分に100が並ぶ対角行列
  - D: 観測方程式の切片項. 時変切片の場合はスカラー
  - C: 状態方程式の切片項. m x n, または, m x 1の行列として与えられる．</code></pre>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="動的線形モデル.html#cb1026-1" tabindex="-1"></a><span class="co"># Create a local level model (latent random walk + noise) to the Nile</span></span>
<span id="cb1026-2"><a href="動的線形モデル.html#cb1026-2" tabindex="-1"></a><span class="co"># dataset using the bsm_lg function:</span></span>
<span id="cb1026-3"><a href="動的線形モデル.html#cb1026-3" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">bsm_lg</span>(Nile, </span>
<span id="cb1026-4"><a href="動的線形モデル.html#cb1026-4" tabindex="-1"></a>                <span class="at">sd_y =</span> <span class="fu">tnormal</span>(<span class="at">init =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">100</span>, <span class="at">min =</span> <span class="dv">0</span>),</span>
<span id="cb1026-5"><a href="動的線形モデル.html#cb1026-5" tabindex="-1"></a>                <span class="at">sd_level =</span> <span class="fu">tnormal</span>(<span class="at">init =</span> <span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">100</span>, <span class="at">min =</span> <span class="dv">0</span>),</span>
<span id="cb1026-6"><a href="動的線形モデル.html#cb1026-6" tabindex="-1"></a>                <span class="at">a1 =</span> <span class="dv">1000</span>, <span class="at">P1 =</span> <span class="dv">500</span><span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>- tnormal: truncated normal distribution (切断正規分布)
  - init: パラメータ初期値. モデル成分を初期化し, MCMCの初期値として使用
  - min: truncated normal priorの下限値
  - max: truncated normal priorの上限値
  - sd: truncateする前の正規分布の標準偏差
  - mean: 正規priorの平均.</code></pre>
<pre><code>関数run_mcmc(): Bayesian Inference of State Space Models
- Vihola(2012)によるRobust Adaptive Metropolisアルゴリズムを用いたSSMのためのAdaptive MCMCシミュレーション. いくつかの異なるMCMCサンプリングスキームを実装.
- 主な引数 (詳しくはマニュアルを参照)
  - model: bssm_modelクラスのモデル
  - iter: MCMC繰り返し計算の回数
  - output_type: &quot;full&quot;(デフォルト. 事後分布からの事後サンプルを返す), &quot;theta&quot; (未知パラメータthetaの周辺事後分布から), &quot;summary&quot; (状態とthetaの事後サンプルの平均と分散推定値を返す)
  ...
- 線形ガウスモデルの場合, オプション &quot;summary&quot;は、状態を直接シミュレーションするのではなく、高速カルマン平滑化を使って状態の事後平均と事後分散を計算
</code></pre>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="動的線形モデル.html#cb1029-1" tabindex="-1"></a><span class="co"># the priors for the unknown paramters sd_y and sd_level were defined</span></span>
<span id="cb1029-2"><a href="動的線形モデル.html#cb1029-2" tabindex="-1"></a><span class="co"># as trunctated normal distributions, see ?bssm_prior for details</span></span>
<span id="cb1029-3"><a href="動的線形モデル.html#cb1029-3" tabindex="-1"></a><span class="co"># Run the MCMC for 2000 iterations (notice the small number of iterations to</span></span>
<span id="cb1029-4"><a href="動的線形モデル.html#cb1029-4" tabindex="-1"></a><span class="co"># comply with the CRAN&#39;s check requirements)</span></span>
<span id="cb1029-5"><a href="動的線形モデル.html#cb1029-5" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">run_mcmc</span>(model, <span class="at">iter =</span> <span class="dv">2000</span>)</span>
<span id="cb1029-6"><a href="動的線形モデル.html#cb1029-6" tabindex="-1"></a></span>
<span id="cb1029-7"><a href="動的線形モデル.html#cb1029-7" tabindex="-1"></a><span class="co"># Some diagnostics checks:</span></span>
<span id="cb1029-8"><a href="動的線形モデル.html#cb1029-8" tabindex="-1"></a><span class="fu">check_diagnostics</span>(fit)</span>
<span id="cb1029-9"><a href="動的線形モデル.html#cb1029-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1029-10"><a href="動的線形モデル.html#cb1029-10" tabindex="-1"></a><span class="do">## Acceptance rate after the burn-in period:  0.234</span></span>
<span id="cb1029-11"><a href="動的線形モデル.html#cb1029-11" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1029-12"><a href="動的線形モデル.html#cb1029-12" tabindex="-1"></a><span class="do">## Run time (wall-clock):</span></span>
<span id="cb1029-13"><a href="動的線形モデル.html#cb1029-13" tabindex="-1"></a><span class="do">## 0.03 seconds.</span></span>
<span id="cb1029-14"><a href="動的線形モデル.html#cb1029-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1029-15"><a href="動的線形モデル.html#cb1029-15" tabindex="-1"></a><span class="do">## Smallest bulk-ESS: 68 (level[90])</span></span>
<span id="cb1029-16"><a href="動的線形モデル.html#cb1029-16" tabindex="-1"></a><span class="do">## Smallest tail-ESS: 22 (level[91])</span></span>
<span id="cb1029-17"><a href="動的線形モデル.html#cb1029-17" tabindex="-1"></a><span class="do">## Largest Rhat: 1.045 (level[58])</span></span></code></pre></div>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="動的線形モデル.html#cb1030-1" tabindex="-1"></a><span class="co"># print some summary information:</span></span>
<span id="cb1030-2"><a href="動的線形モデル.html#cb1030-2" tabindex="-1"></a>fit</span>
<span id="cb1030-3"><a href="動的線形モデル.html#cb1030-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-4"><a href="動的線形モデル.html#cb1030-4" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb1030-5"><a href="動的線形モデル.html#cb1030-5" tabindex="-1"></a><span class="do">## run_mcmc.lineargaussian(model = model, iter = 2000)</span></span>
<span id="cb1030-6"><a href="動的線形モデル.html#cb1030-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-7"><a href="動的線形モデル.html#cb1030-7" tabindex="-1"></a><span class="do">## Iterations = 1001:2000</span></span>
<span id="cb1030-8"><a href="動的線形モデル.html#cb1030-8" tabindex="-1"></a><span class="do">## Thinning interval = 1</span></span>
<span id="cb1030-9"><a href="動的線形モデル.html#cb1030-9" tabindex="-1"></a><span class="do">## Length of the final jump chain = 235</span></span>
<span id="cb1030-10"><a href="動的線形モデル.html#cb1030-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-11"><a href="動的線形モデル.html#cb1030-11" tabindex="-1"></a><span class="do">## Acceptance rate after the burn-in period:  0.234</span></span>
<span id="cb1030-12"><a href="動的線形モデル.html#cb1030-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-13"><a href="動的線形モデル.html#cb1030-13" tabindex="-1"></a><span class="do">## Summary for theta:</span></span>
<span id="cb1030-14"><a href="動的線形モデル.html#cb1030-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-15"><a href="動的線形モデル.html#cb1030-15" tabindex="-1"></a><span class="do">##  variable      Mean       SE       SD     2.5%     97.5% ESS</span></span>
<span id="cb1030-16"><a href="動的線形モデル.html#cb1030-16" tabindex="-1"></a><span class="do">##  sd_level  44.36092 1.795784 16.97667 17.43660  77.52529  89</span></span>
<span id="cb1030-17"><a href="動的線形モデル.html#cb1030-17" tabindex="-1"></a><span class="do">##      sd_y 122.13758 1.114178 12.71891 98.71335 145.00349 130</span></span>
<span id="cb1030-18"><a href="動的線形モデル.html#cb1030-18" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-19"><a href="動的線形モデル.html#cb1030-19" tabindex="-1"></a><span class="do">## Summary for alpha_101:</span></span>
<span id="cb1030-20"><a href="動的線形モデル.html#cb1030-20" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-21"><a href="動的線形モデル.html#cb1030-21" tabindex="-1"></a><span class="do">##  variable time     Mean       SE       SD     2.5%    97.5% ESS</span></span>
<span id="cb1030-22"><a href="動的線形モデル.html#cb1030-22" tabindex="-1"></a><span class="do">##     level 1971 775.6908 7.828845 84.59991 613.8982 926.1021 117</span></span>
<span id="cb1030-23"><a href="動的線形モデル.html#cb1030-23" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1030-24"><a href="動的線形モデル.html#cb1030-24" tabindex="-1"></a><span class="do">## Run time:</span></span>
<span id="cb1030-25"><a href="動的線形モデル.html#cb1030-25" tabindex="-1"></a><span class="do">##    user  system elapsed </span></span>
<span id="cb1030-26"><a href="動的線形モデル.html#cb1030-26" tabindex="-1"></a><span class="do">##   0.030   0.001   0.030</span></span>
<span id="cb1030-27"><a href="動的線形モデル.html#cb1030-27" tabindex="-1"></a></span>
<span id="cb1030-28"><a href="動的線形モデル.html#cb1030-28" tabindex="-1"></a><span class="co"># traceplots:</span></span>
<span id="cb1030-29"><a href="動的線形モデル.html#cb1030-29" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code></pre></div>
<p><img src="134-dlm-3_files/figure-html/unnamed-chunk-6-1.png" width="75%" /></p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="動的線形モデル.html#cb1031-1" tabindex="-1"></a></span>
<span id="cb1031-2"><a href="動的線形モデル.html#cb1031-2" tabindex="-1"></a><span class="co"># extract the summary statistics for state variable</span></span>
<span id="cb1031-3"><a href="動的線形モデル.html#cb1031-3" tabindex="-1"></a>sumr <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit, <span class="at">variable =</span> <span class="st">&quot;states&quot;</span>)</span>
<span id="cb1031-4"><a href="動的線形モデル.html#cb1031-4" tabindex="-1"></a></span>
<span id="cb1031-5"><a href="動的線形モデル.html#cb1031-5" tabindex="-1"></a><span class="co"># visualize</span></span>
<span id="cb1031-6"><a href="動的線形モデル.html#cb1031-6" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1031-7"><a href="動的線形モデル.html#cb1031-7" tabindex="-1"></a><span class="fu">ggplot</span>(sumr, <span class="fu">aes</span>(time, Mean)) <span class="sc">+</span></span>
<span id="cb1031-8"><a href="動的線形モデル.html#cb1031-8" tabindex="-1"></a> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>),<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb1031-9"><a href="動的線形モデル.html#cb1031-9" tabindex="-1"></a> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1031-10"><a href="動的線形モデル.html#cb1031-10" tabindex="-1"></a> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="134-dlm-3_files/figure-html/unnamed-chunk-6-2.png" width="75%" /></p>
<!-- パッケージ**bssm**は, 非線形・非ガウシアンのケースも対応可能. -->
</div>
<div id="確率的季節性成分を持つドリフト有りランダムウォークモデル" class="section level3 unnumbered hasAnchor">
<h3>確率的季節性成分を持つドリフト有りランダムウォーク・モデル<a href="動的線形モデル.html#確率的季節性成分を持つドリフト有りランダムウォークモデル" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>データセット: UKgas</li>
</ul>
<pre><code>- UKgas: 
  - 英国の四半期ガス消費量
  - 1960年第1四半期--1986年第4四半期 (単位：百万トルム)</code></pre>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="動的線形モデル.html#cb1033-1" tabindex="-1"></a>UKgas</span>
<span id="cb1033-2"><a href="動的線形モデル.html#cb1033-2" tabindex="-1"></a><span class="do">##        Qtr1   Qtr2   Qtr3   Qtr4</span></span>
<span id="cb1033-3"><a href="動的線形モデル.html#cb1033-3" tabindex="-1"></a><span class="do">## 1960  160.1  129.7   84.8  120.1</span></span>
<span id="cb1033-4"><a href="動的線形モデル.html#cb1033-4" tabindex="-1"></a><span class="do">## 1961  160.1  124.9   84.8  116.9</span></span>
<span id="cb1033-5"><a href="動的線形モデル.html#cb1033-5" tabindex="-1"></a><span class="do">## 1962  169.7  140.9   89.7  123.3</span></span>
<span id="cb1033-6"><a href="動的線形モデル.html#cb1033-6" tabindex="-1"></a><span class="do">## 1963  187.3  144.1   92.9  120.1</span></span>
<span id="cb1033-7"><a href="動的線形モデル.html#cb1033-7" tabindex="-1"></a><span class="do">## 1964  176.1  147.3   89.7  123.3</span></span>
<span id="cb1033-8"><a href="動的線形モデル.html#cb1033-8" tabindex="-1"></a><span class="do">## 1965  185.7  155.3   99.3  131.3</span></span>
<span id="cb1033-9"><a href="動的線形モデル.html#cb1033-9" tabindex="-1"></a><span class="do">## 1966  200.1  161.7  102.5  136.1</span></span>
<span id="cb1033-10"><a href="動的線形モデル.html#cb1033-10" tabindex="-1"></a><span class="do">## 1967  204.9  176.1  112.1  140.9</span></span>
<span id="cb1033-11"><a href="動的線形モデル.html#cb1033-11" tabindex="-1"></a><span class="do">## 1968  227.3  195.3  115.3  142.5</span></span>
<span id="cb1033-12"><a href="動的線形モデル.html#cb1033-12" tabindex="-1"></a><span class="do">## 1969  244.9  214.5  118.5  153.7</span></span>
<span id="cb1033-13"><a href="動的線形モデル.html#cb1033-13" tabindex="-1"></a><span class="do">## 1970  244.9  216.1  188.9  142.5</span></span>
<span id="cb1033-14"><a href="動的線形モデル.html#cb1033-14" tabindex="-1"></a><span class="do">## 1971  301.0  196.9  136.1  267.3</span></span>
<span id="cb1033-15"><a href="動的線形モデル.html#cb1033-15" tabindex="-1"></a><span class="do">## 1972  317.0  230.5  152.1  336.2</span></span>
<span id="cb1033-16"><a href="動的線形モデル.html#cb1033-16" tabindex="-1"></a><span class="do">## 1973  371.4  240.1  158.5  355.4</span></span>
<span id="cb1033-17"><a href="動的線形モデル.html#cb1033-17" tabindex="-1"></a><span class="do">## 1974  449.9  286.6  179.3  403.4</span></span>
<span id="cb1033-18"><a href="動的線形モデル.html#cb1033-18" tabindex="-1"></a><span class="do">## 1975  491.5  321.8  177.7  409.8</span></span>
<span id="cb1033-19"><a href="動的線形モデル.html#cb1033-19" tabindex="-1"></a><span class="do">## 1976  593.9  329.8  176.1  483.5</span></span>
<span id="cb1033-20"><a href="動的線形モデル.html#cb1033-20" tabindex="-1"></a><span class="do">## 1977  584.3  395.4  187.3  485.1</span></span>
<span id="cb1033-21"><a href="動的線形モデル.html#cb1033-21" tabindex="-1"></a><span class="do">## 1978  669.2  421.0  216.1  509.1</span></span>
<span id="cb1033-22"><a href="動的線形モデル.html#cb1033-22" tabindex="-1"></a><span class="do">## 1979  827.7  467.5  209.7  542.7</span></span>
<span id="cb1033-23"><a href="動的線形モデル.html#cb1033-23" tabindex="-1"></a><span class="do">## 1980  840.5  414.6  217.7  670.8</span></span>
<span id="cb1033-24"><a href="動的線形モデル.html#cb1033-24" tabindex="-1"></a><span class="do">## 1981  848.5  437.0  209.7  701.2</span></span>
<span id="cb1033-25"><a href="動的線形モデル.html#cb1033-25" tabindex="-1"></a><span class="do">## 1982  925.3  443.4  214.5  683.6</span></span>
<span id="cb1033-26"><a href="動的線形モデル.html#cb1033-26" tabindex="-1"></a><span class="do">## 1983  917.3  515.5  224.1  694.8</span></span>
<span id="cb1033-27"><a href="動的線形モデル.html#cb1033-27" tabindex="-1"></a><span class="do">## 1984  989.4  477.1  233.7  730.0</span></span>
<span id="cb1033-28"><a href="動的線形モデル.html#cb1033-28" tabindex="-1"></a><span class="do">## 1985 1087.0  534.7  281.8  787.6</span></span>
<span id="cb1033-29"><a href="動的線形モデル.html#cb1033-29" tabindex="-1"></a><span class="do">## 1986 1163.9  613.1  347.4  782.8</span></span></code></pre></div>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="動的線形モデル.html#cb1034-1" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">halfnormal</span>(<span class="fl">0.1</span>, <span class="dv">1</span>)</span>
<span id="cb1034-2"><a href="動的線形モデル.html#cb1034-2" tabindex="-1"></a>UKgas_model <span class="ot">&lt;-</span> <span class="fu">bsm_lg</span>(<span class="fu">log10</span>(UKgas), </span>
<span id="cb1034-3"><a href="動的線形モデル.html#cb1034-3" tabindex="-1"></a>                      <span class="at">sd_y =</span> prior, </span>
<span id="cb1034-4"><a href="動的線形モデル.html#cb1034-4" tabindex="-1"></a>                      <span class="at">sd_level =</span> prior,</span>
<span id="cb1034-5"><a href="動的線形モデル.html#cb1034-5" tabindex="-1"></a>                      <span class="at">sd_slope =</span> prior, </span>
<span id="cb1034-6"><a href="動的線形モデル.html#cb1034-6" tabindex="-1"></a>                      <span class="at">sd_seasonal =</span>  prior)</span>
<span id="cb1034-7"><a href="動的線形モデル.html#cb1034-7" tabindex="-1"></a></span>
<span id="cb1034-8"><a href="動的線形モデル.html#cb1034-8" tabindex="-1"></a>mcmc_bsm <span class="ot">&lt;-</span> <span class="fu">run_mcmc</span>(UKgas_model, <span class="at">iter =</span> <span class="fl">4e4</span>, <span class="at">seed =</span> <span class="dv">1</span>)</span>
<span id="cb1034-9"><a href="動的線形モデル.html#cb1034-9" tabindex="-1"></a>mcmc_bsm</span>
<span id="cb1034-10"><a href="動的線形モデル.html#cb1034-10" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-11"><a href="動的線形モデル.html#cb1034-11" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb1034-12"><a href="動的線形モデル.html#cb1034-12" tabindex="-1"></a><span class="do">## run_mcmc.lineargaussian(model = UKgas_model, iter = 40000, seed = 1)</span></span>
<span id="cb1034-13"><a href="動的線形モデル.html#cb1034-13" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-14"><a href="動的線形モデル.html#cb1034-14" tabindex="-1"></a><span class="do">## Iterations = 20001:40000</span></span>
<span id="cb1034-15"><a href="動的線形モデル.html#cb1034-15" tabindex="-1"></a><span class="do">## Thinning interval = 1</span></span>
<span id="cb1034-16"><a href="動的線形モデル.html#cb1034-16" tabindex="-1"></a><span class="do">## Length of the final jump chain = 4666</span></span>
<span id="cb1034-17"><a href="動的線形モデル.html#cb1034-17" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-18"><a href="動的線形モデル.html#cb1034-18" tabindex="-1"></a><span class="do">## Acceptance rate after the burn-in period:  0.233</span></span>
<span id="cb1034-19"><a href="動的線形モデル.html#cb1034-19" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-20"><a href="動的線形モデル.html#cb1034-20" tabindex="-1"></a><span class="do">## Summary for theta:</span></span>
<span id="cb1034-21"><a href="動的線形モデル.html#cb1034-21" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-22"><a href="動的線形モデル.html#cb1034-22" tabindex="-1"></a><span class="do">##     variable        Mean           SE          SD         2.5%       97.5% ESS</span></span>
<span id="cb1034-23"><a href="動的線形モデル.html#cb1034-23" tabindex="-1"></a><span class="do">##     sd_level 0.005003611 1.755466e-04 0.003289163 0.0001617486 0.012013391 351</span></span>
<span id="cb1034-24"><a href="動的線形モデル.html#cb1034-24" tabindex="-1"></a><span class="do">##  sd_seasonal 0.026093324 1.219744e-04 0.003684879 0.0189052091 0.033431632 913</span></span>
<span id="cb1034-25"><a href="動的線形モデル.html#cb1034-25" tabindex="-1"></a><span class="do">##     sd_slope 0.001200382 2.345435e-05 0.000523736 0.0002079971 0.002309162 499</span></span>
<span id="cb1034-26"><a href="動的線形モデル.html#cb1034-26" tabindex="-1"></a><span class="do">##         sd_y 0.016314018 2.894970e-04 0.005538082 0.0043639303 0.026345063 366</span></span>
<span id="cb1034-27"><a href="動的線形モデル.html#cb1034-27" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-28"><a href="動的線形モデル.html#cb1034-28" tabindex="-1"></a><span class="do">## Summary for alpha_109:</span></span>
<span id="cb1034-29"><a href="動的線形モデル.html#cb1034-29" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-30"><a href="動的線形モデル.html#cb1034-30" tabindex="-1"></a><span class="do">##    variable time        Mean           SE         SD         2.5%       97.5%</span></span>
<span id="cb1034-31"><a href="動的線形モデル.html#cb1034-31" tabindex="-1"></a><span class="do">##       level 1987  2.84506115 3.656806e-04 0.01700774  2.811472331  2.87822366</span></span>
<span id="cb1034-32"><a href="動的線形モデル.html#cb1034-32" tabindex="-1"></a><span class="do">##  seasonal_1 1987  0.26737674 7.132008e-04 0.03544500  0.194987187  0.33908649</span></span>
<span id="cb1034-33"><a href="動的線形モデル.html#cb1034-33" tabindex="-1"></a><span class="do">##  seasonal_2 1987  0.06192612 4.155558e-04 0.01797639  0.028077857  0.09923766</span></span>
<span id="cb1034-34"><a href="動的線形モデル.html#cb1034-34" tabindex="-1"></a><span class="do">##  seasonal_3 1987 -0.29493927 3.003881e-04 0.01559836 -0.326940852 -0.26553733</span></span>
<span id="cb1034-35"><a href="動的線形モデル.html#cb1034-35" tabindex="-1"></a><span class="do">##       slope 1987  0.00974463 8.195493e-05 0.00395237  0.002323525  0.01816920</span></span>
<span id="cb1034-36"><a href="動的線形モデル.html#cb1034-36" tabindex="-1"></a><span class="do">##   ESS</span></span>
<span id="cb1034-37"><a href="動的線形モデル.html#cb1034-37" tabindex="-1"></a><span class="do">##  2163</span></span>
<span id="cb1034-38"><a href="動的線形モデル.html#cb1034-38" tabindex="-1"></a><span class="do">##  2470</span></span>
<span id="cb1034-39"><a href="動的線形モデル.html#cb1034-39" tabindex="-1"></a><span class="do">##  1871</span></span>
<span id="cb1034-40"><a href="動的線形モデル.html#cb1034-40" tabindex="-1"></a><span class="do">##  2696</span></span>
<span id="cb1034-41"><a href="動的線形モデル.html#cb1034-41" tabindex="-1"></a><span class="do">##  2326</span></span>
<span id="cb1034-42"><a href="動的線形モデル.html#cb1034-42" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1034-43"><a href="動的線形モデル.html#cb1034-43" tabindex="-1"></a><span class="do">## Run time:</span></span>
<span id="cb1034-44"><a href="動的線形モデル.html#cb1034-44" tabindex="-1"></a><span class="do">##    user  system elapsed </span></span>
<span id="cb1034-45"><a href="動的線形モデル.html#cb1034-45" tabindex="-1"></a><span class="do">##   5.778   0.016   5.810</span></span></code></pre></div>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="動的線形モデル.html#cb1035-1" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="動的線形モデル.html#cb1036-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcmc_bsm, <span class="at">variable =</span> <span class="st">&quot;theta&quot;</span>)</span>
<span id="cb1036-2"><a href="動的線形モデル.html#cb1036-2" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span> </span>
<span id="cb1036-3"><a href="動的線形モデル.html#cb1036-3" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="st">&quot;#92f0a8&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1036-4"><a href="動的線形モデル.html#cb1036-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1036-5"><a href="動的線形モデル.html#cb1036-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="134-dlm-3_files/figure-html/unnamed-chunk-10-1.png" width="75%" /></p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="動的線形モデル.html#cb1037-1" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>))</span>
<span id="cb1037-2"><a href="動的線形モデル.html#cb1037-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcmc_bsm, <span class="at">variable =</span> <span class="st">&quot;states&quot;</span>)</span>
<span id="cb1037-3"><a href="動的線形モデル.html#cb1037-3" tabindex="-1"></a>level_fit <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb1037-4"><a href="動的線形モデル.html#cb1037-4" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">&quot;level&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb1037-5"><a href="動的線形モデル.html#cb1037-5" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">|&gt;</span></span>
<span id="cb1037-6"><a href="動的線形モデル.html#cb1037-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">consumption =</span> <span class="fu">mean</span>(value), </span>
<span id="cb1037-7"><a href="動的線形モデル.html#cb1037-7" tabindex="-1"></a>    <span class="at">lwr =</span> <span class="fu">quantile</span>(value, <span class="fl">0.025</span>), </span>
<span id="cb1037-8"><a href="動的線形モデル.html#cb1037-8" tabindex="-1"></a>    <span class="at">upr =</span> <span class="fu">quantile</span>(value, <span class="fl">0.975</span>))</span>
<span id="cb1037-9"><a href="動的線形モデル.html#cb1037-9" tabindex="-1"></a></span>
<span id="cb1037-10"><a href="動的線形モデル.html#cb1037-10" tabindex="-1"></a><span class="fu">ggplot</span>(level_fit, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> consumption)) <span class="sc">+</span> </span>
<span id="cb1037-11"><a href="動的線形モデル.html#cb1037-11" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr), </span>
<span id="cb1037-12"><a href="動的線形モデル.html#cb1037-12" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#92f0a8&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb1037-13"><a href="動的線形モデル.html#cb1037-13" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">&quot;#92f0a8&quot;</span>) <span class="sc">+</span></span>
<span id="cb1037-14"><a href="動的線形モデル.html#cb1037-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(</span>
<span id="cb1037-15"><a href="動的線形モデル.html#cb1037-15" tabindex="-1"></a>    <span class="at">consumption =</span> <span class="fu">log10</span>(UKgas), </span>
<span id="cb1037-16"><a href="動的線形モデル.html#cb1037-16" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">time</span>(UKgas)), </span>
<span id="cb1037-17"><a href="動的線形モデル.html#cb1037-17" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb1037-18"><a href="動的線形モデル.html#cb1037-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="134-dlm-3_files/figure-html/unnamed-chunk-11-1.png" width="75%" /></p>
<div id="参考文献-3" class="section level4 unnumbered hasAnchor">
<h4>参考文献<a href="動的線形モデル.html#参考文献-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Helske, Jouni, and Matti Vihola. 2021. “Bssm: Bayesian Inference of Non-Linear and Non-Gaussian State Space Models in R.” R Journal. <a href="https://arxiv.org/abs/2101.08492">https://arxiv.org/abs/2101.08492</a>.</p>

</div>
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="スペクトル解析.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="バブル-生成崩壊-検出.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
